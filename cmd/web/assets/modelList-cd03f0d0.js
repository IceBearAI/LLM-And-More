import{d as ee,x as W,z as le,r as g,aC as E,aB as X,a8 as Y,U as T,k as U,l as G,m as l,W as u,j as e,n as a,_ as c,Z as H,F as re,Y as F,al as se,am as ue,av as S,Q as Ue,a3 as De,ac as Me,at as Ie,au as $e,o as Pe,aA as we,$ as A}from"./utils-fc8ebe1f.js";import{_ as Se}from"./BaseBreadcrumb.vue_vue_type_style_index_0_lang-02f17eb8.js";import{_ as Fe}from"./UiParentCard.vue_vue_type_script_setup_true_lang-bc14ee23.js";import{A as Be}from"./AlertBlock-c7626136.js";import{C as Ge}from"./ChipBoolean-45755643.js";import{C as qe}from"./ChipStatus-84a878a5.js";import{_ as M}from"./Explain.vue_vue_type_style_index_0_lang-2aca43e9.js";import{c as Le,a5 as x,ae as Ae,_ as ie,V as J,ac as Qe,ah as ze}from"./index-b84f97ad.js";import{V as te}from"./VSwitch-a8718d97.js";import{V as Re}from"./VTextarea-e2668a01.js";import{V as Ee,a as We,b as Ye,c as je}from"./VExpansionPanel-f119d106.js";import{V as me,a as K}from"./VRadioGroup-d5988ff5.js";import{V as pe}from"./VForm-cdbc2f03.js";import{V as ne}from"./VCheckbox-93adff47.js";import{_ as He}from"./ConfirmByInput.vue_vue_type_style_index_0_lang-10388eaa.js";import{_ as Ke}from"./ConfirmByClick.vue_vue_type_style_index_0_lang-18c58b80.js";import{_ as Oe}from"./DialogLog.vue_vue_type_style_index_0_lang-29234ac1.js";import{V as w}from"./VCol-f5dbb3fc.js";import{V as de}from"./VRow-4fd670bb.js";import{I as Ze}from"./IconFileDescription-1533ee08.js";import{I as Je}from"./IconTerminal2-32a72461.js";import"./IconInfoCircle-d065b385.js";import"./VAlert-2b69a982.js";import"./Confirm-dfed4e97.js";import"./TextLog-57bd597b.js";var Xe=Le("messages","IconMessages",[["path",{d:"M21 14l-3 -3h-7a1 1 0 0 1 -1 -1v-6a1 1 0 0 1 1 -1h9a1 1 0 0 1 1 1v10",key:"svg-0"}],["path",{d:"M14 15v2a1 1 0 0 1 -1 1h-7l-3 3v-10a1 1 0 0 1 1 -1h2",key:"svg-1"}]]);const N=D=>(se("data-v-2969599f"),D=D(),ue(),D),el={class:"mx-auto mt-10",style:{width:"500px"}},ll=N(()=>u("label",{class:"required"},"模型名称",-1)),al=N(()=>u("label",{class:"required"},"最长上下文",-1)),ol={class:"required"},tl=N(()=>u("label",{class:"required"},"模型类型",-1)),nl=N(()=>u("label",null,"备注",-1)),dl=N(()=>u("label",null,"基础模型",-1)),rl=N(()=>u("label",null,"并行/实例数",-1)),sl=N(()=>u("label",null,"调度标签",-1)),ul=N(()=>u("label",null,"k8s集群",-1)),il=N(()=>u("label",null,"推理类型",-1)),ml=N(()=>u("label",null,"CPU数量",-1)),pl=N(()=>u("label",null,"GPU数量",-1)),fl=N(()=>u("label",null,"内存",-1)),cl=ee({__name:"PaneModel",emits:["submit"],setup(D,{expose:Q,emit:z}){const y=W({operateType:"add",disabledField:!1,maxTokens:5e5,formData:{id:"",modelName:"",maxTokens:0,isFineTuning:!1,enabled:!0,remark:"",parameters:0,providerName:"",modelType:null,baseModelName:null,replicas:0,label:null,k8sCluster:null,inferredType:"",cpu:0,gpu:0,memory:0}}),{formData:o}=le(y),n=z,q=g(),k=g(),V=W({modelName:[f=>E.isModelName({value:f,required:!0})],maxTokens:[f=>f!==""?f<1?"下限 1":f>y.maxTokens?"上限 "+X.commaString(y.maxTokens):!0:"请输入模型最长上下文"],providerName:[f=>f&&f.length>0?!0:"请选择供应"],modelType:[f=>!!f||"请选择模型类型"],replicas:[f=>E.validNumberInput(f,0,50,"",!0)],cpu:[f=>E.validNumberInput(f,0,100,"",!0)],gpu:[f=>E.validNumberInput(f,0,20,"",!0)],memory:[f=>E.validNumberInput(f,0,100,"",!0)]}),B=f=>{f!=="digitalhuman"&&(y.formData.replicas=0,y.formData.label=null,y.formData.k8sCluster=null,y.formData.inferredType="",y.formData.cpu=0,y.formData.gpu=0,y.formData.memory=0)},h=async(f={})=>{const[s,d]=await S.post({...f,showSuccess:!0,url:"/models",data:{...y.formData}});d&&(q.value.hide(),n("submit"))},v=async(f={})=>{const[s,d]=await S.put({...f,showSuccess:!0,url:`/models/${y.formData.id}`,data:{...y.formData}});d&&(q.value.hide(),n("submit"))},$=({valid:f,showLoading:s})=>{f&&(y.operateType=="add"?h({showLoading:s}):v({showLoading:s}))};return Q({show({title:f,infos:s={id:"",modelName:"",maxTokens:0,isFineTuning:!1,enabled:!0,remark:"",providerName:"",parameters:0,modelType:null,baseModelName:null,replicas:0,label:null,k8sCluster:null,inferredType:"",cpu:0,gpu:0,memory:0},operateType:d}){q.value.show({title:f,refForm:k}),y.formData=Y.pick(Y.cloneDeep(s),["id","modelName","maxTokens","isFineTuning","enabled","remark","providerName","parameters","modelType","baseModelName","replicas","label","k8sCluster","inferredType","cpu","gpu","memory"]),y.operateType=d,d=="add"?y.disabledField=!1:y.disabledField=!0}}),(f,s)=>{const d=T("Select"),r=T("Pane");return U(),G(r,{ref_key:"refPane",ref:q,class:"",onSubmit:$},{default:l(()=>[u("div",el,[e(pe,{ref_key:"refForm",ref:k,class:"my-form"},{default:l(()=>[e(x,{density:"compact",variant:"outlined",type:"text",placeholder:"只允许字母、数字、“-” 、“.” 和 “:” ","hide-details":"auto",clearable:"",rules:V.modelName,modelValue:a(o).modelName,"onUpdate:modelValue":s[0]||(s[0]=t=>a(o).modelName=t),disabled:y.disabledField},{prepend:l(()=>[ll]),_:1},8,["rules","modelValue","disabled"]),e(x,{density:"compact",variant:"outlined",type:"number",placeholder:"上限 "+a(X).commaString(y.maxTokens),"hide-details":"auto",rules:V.maxTokens,modelValue:a(o).maxTokens,"onUpdate:modelValue":s[1]||(s[1]=t=>a(o).maxTokens=t),modelModifiers:{number:!0}},{prepend:l(()=>[al]),_:1},8,["placeholder","rules","modelValue"]),e(d,{placeholder:"请选择供应商",rules:V.providerName,mapDictionary:{code:"model_provider_name"},modelValue:a(o).providerName,"onUpdate:modelValue":s[2]||(s[2]=t=>a(o).providerName=t),disabled:y.disabledField},{prepend:l(()=>[u("label",ol,[c("供应 "),e(M,null,{default:l(()=>[c("供应商指的是外部服务提供，自己有服务请选择Local")]),_:1})])]),_:1},8,["rules","modelValue","disabled"]),e(d,{placeholder:"请选择模型类型",rules:V.modelType,mapDictionary:{code:"model_type"},modelValue:a(o).modelType,"onUpdate:modelValue":[s[3]||(s[3]=t=>a(o).modelType=t),B],disabled:y.disabledField},{prepend:l(()=>[tl]),_:1},8,["rules","modelValue","disabled"]),e(te,{modelValue:a(o).enabled,"onUpdate:modelValue":s[4]||(s[4]=t=>a(o).enabled=t),color:"primary","hide-details":"auto"},{prepend:l(()=>[u("label",null,[c("启用 "),e(M,null,{default:l(()=>[c("模型是否可被使用，如果关闭则无法使用该模型")]),_:1})])]),_:1},8,["modelValue"]),e(Re,{modelValue:a(o).remark,"onUpdate:modelValue":s[5]||(s[5]=t=>a(o).remark=t),modelModifiers:{trim:!0},placeholder:"请输入"},{prepend:l(()=>[nl]),_:1},8,["modelValue"]),e(Ae,null,{default:l(()=>[e(Ee,null,{default:l(()=>[e(We,{elevation:"10"},{default:l(()=>[e(Ye,{class:"text-h6"},{default:l(()=>[c("高级")]),_:1}),e(je,{class:"mt-4",eager:""},{default:l(()=>[e(d,{placeholder:"请选择基础模型",modelValue:a(o).baseModelName,"onUpdate:modelValue":s[6]||(s[6]=t=>a(o).baseModelName=t),mapAPI:{url:"/channels/models",data:{providerName:"LocalAI",modelType:"text-generation",baseModelName:"null"},labelField:"modelName",valueField:"modelName"},"hide-details":!1},{prepend:l(()=>[dl]),_:1},8,["modelValue"]),e(te,{modelValue:a(o).isFineTuning,"onUpdate:modelValue":s[7]||(s[7]=t=>a(o).isFineTuning=t),disabled:y.disabledField,color:"primary"},{prepend:l(()=>[u("label",null,[c("微调 "),e(M,null,{default:l(()=>[c("是否是微调模型")]),_:1})])]),_:1},8,["modelValue","disabled"]),e(x,{density:"compact",variant:"outlined",type:"number",placeholder:"请输入参数量",modelValue:a(o).parameters,"onUpdate:modelValue":s[8]||(s[8]=t=>a(o).parameters=t),modelModifiers:{number:!0},style:{width:"60%"},disabled:y.disabledField},{prepend:l(()=>[u("label",null,[c("参数量(B) "),e(M,null,{default:l(()=>[c("单位是B，代理10亿")]),_:1})])]),_:1},8,["modelValue","disabled"]),a(o).modelType==="digitalhuman"?(U(),H(re,{key:0},[e(x,{type:"number",placeholder:"请输入并行/实例数",rules:V.replicas,modelValue:a(o).replicas,"onUpdate:modelValue":s[9]||(s[9]=t=>a(o).replicas=t),modelModifiers:{number:!0}},{prepend:l(()=>[rl]),_:1},8,["rules","modelValue"]),e(d,{placeholder:"请选择调度标签","hide-details":!1,mapDictionary:{code:"model_deploy_label"},modelValue:a(o).label,"onUpdate:modelValue":s[10]||(s[10]=t=>a(o).label=t)},{prepend:l(()=>[sl]),_:1},8,["modelValue"]),e(d,{placeholder:"请选择k8s集群","hide-details":!1,mapDictionary:{code:"k8s_cluster"},modelValue:a(o).k8sCluster,"onUpdate:modelValue":s[11]||(s[11]=t=>a(o).k8sCluster=t)},{prepend:l(()=>[ul]),_:1},8,["modelValue"]),e(me,{modelValue:a(o).inferredType,"onUpdate:modelValue":s[12]||(s[12]=t=>a(o).inferredType=t),inline:"",color:"primary"},{prepend:l(()=>[il]),default:l(()=>[e(K,{label:"CPU",value:"cpu"}),e(K,{label:"GPU",value:"gpu"})]),_:1},8,["modelValue"]),e(x,{type:"number",placeholder:"请输入使用CPU数量",rules:V.cpu,modelValue:a(o).cpu,"onUpdate:modelValue":s[13]||(s[13]=t=>a(o).cpu=t),modelModifiers:{number:!0}},{prepend:l(()=>[ml]),_:1},8,["rules","modelValue"]),e(x,{type:"number",placeholder:"请输入使用GPU数量",rules:V.gpu,modelValue:a(o).gpu,"onUpdate:modelValue":s[14]||(s[14]=t=>a(o).gpu=t),modelModifiers:{number:!0}},{prepend:l(()=>[pl]),_:1},8,["rules","modelValue"]),e(x,{type:"number",placeholder:"请输入内存",rules:V.memory,modelValue:a(o).memory,"onUpdate:modelValue":s[15]||(s[15]=t=>a(o).memory=t),modelModifiers:{number:!0}},{prepend:l(()=>[fl]),"append-inner":l(()=>[c("G")]),_:1},8,["rules","modelValue"])],64)):F("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},512)])]),_:1},512)}}});const _l=ie(cl,[["__scopeId","data-v-2969599f"]]),j=D=>(se("data-v-d19493a6"),D=D(),ue(),D),yl={class:"mx-auto mt-10",style:{width:"500px"}},bl=j(()=>u("label",{class:"required"},"模型名称",-1)),Vl={class:"required"},hl={class:"required"},gl=j(()=>u("label",{class:"required"},"推理类型",-1)),kl=j(()=>u("label",{class:"required"},"CPU数量",-1)),xl={class:"required"},vl=j(()=>u("label",null,"k8s集群",-1)),Tl=j(()=>u("label",null,null,-1)),Nl=ee({__name:"ArrangeModel",emits:["submit"],setup(D,{expose:Q,emit:z}){const y=/^\+?[1-9][0-9]*$/,o=W({operateType:"",maxTokens:5e5,id:"",modelName:"",isQuantify:!1,formData:{replicas:"",label:"",cpu:1,gpu:1,maxGpuMemory:"",quantization:"",vllm:"",inferredType:"cpu",k8sCluster:null}}),{formData:n,id:q}=le(o),k=z,V=g(),B=g(),h=(d,r,t,P,_=!1)=>d?d<r?`下限 ${r}`:d>t?`上限 ${t}`:_&&y.test(d)!=!0?"请输入正整数":!0:P||!0,v=W({replicas:[d=>h(d,1,8,"请输入实例数量",!0)],label:[d=>!!d||"请选择调度标签"],gpu:[d=>h(d,1,8,"请输入使用GPU数量",!0)],cpu:[d=>h(d,1,80,"请输入使用CPU数量",!0)],maxGpuMemory:[d=>h(d,1,80,"",!0)],quantization:[d=>!!d||"请选择精度"],isQuantify:[d=>d&&d!=!1?!0:"请开启量化"],vllm:[d=>d&&d!=!1?!0:"请开启VLLM"]}),$=async(d={})=>{o.formData.quantization=o.isQuantify?"float16":""},f=d=>{d==="cpu"?o.formData.gpu=1:o.formData.cpu=1},s=async({valid:d,showLoading:r})=>{if(d){const t={...o.formData};t.inferredType==="cpu"?(t.gpu=0,t.maxGpuMemory=0):t.cpu=0,t.maxGpuMemory=t.maxGpuMemory||0;const[P,_]=await S.post({...r,showSuccess:!0,url:`/api/models/${o.id}/deploy`,data:t});_&&(V.value.hide(),k("submit"))}};return Q({show({title:d,infos:r={id:"",modelName:""},operateType:t}){V.value.show({title:d,refForm:B}),o.formData=Y.pick(Y.cloneDeep(r),[]),o.formData.inferredType="cpu",o.formData.cpu=1,o.formData.gpu=1,o.operateType=t,o.modelName=r.modelName,o.id=r.id}}),(d,r)=>{const t=T("Select"),P=T("Pane");return U(),G(P,{ref_key:"refPane",ref:V,class:"",onSubmit:s},{default:l(()=>[u("div",yl,[e(pe,{ref_key:"refForm",ref:B,class:"my-form"},{default:l(()=>[e(x,{"hide-details":"auto",modelValue:o.modelName,"onUpdate:modelValue":r[0]||(r[0]=_=>o.modelName=_),disabled:!0},{prepend:l(()=>[bl]),_:1},8,["modelValue"]),e(x,{type:"number","hide-details":"auto",placeholder:"请输入使用实例数量",rules:v.replicas,modelValue:a(n).replicas,"onUpdate:modelValue":r[1]||(r[1]=_=>a(n).replicas=_),modelModifiers:{number:!0},onInput:r[2]||(r[2]=_=>h(a(n).replicas,1,8,"请输入实例数量",!0)),max:"8"},{prepend:l(()=>[u("label",Vl,[c("实例数 "),e(M,null,{default:l(()=>[c("启动实例数量")]),_:1})])]),_:1},8,["rules","modelValue"]),e(t,{"hide-details":"auto",placeholder:"请选择调度标签",rules:v.label,mapDictionary:{code:"model_deploy_label"},modelValue:a(n).label,"onUpdate:modelValue":r[3]||(r[3]=_=>a(n).label=_)},{prepend:l(()=>[u("label",hl,[c("调度标签 "),e(M,null,{default:l(()=>[c("设置实例调度的节点亲和性")]),_:1})])]),_:1},8,["rules","modelValue"]),e(me,{modelValue:a(n).inferredType,"onUpdate:modelValue":[r[4]||(r[4]=_=>a(n).inferredType=_),f],inline:"",color:"primary","hide-details":"auto"},{prepend:l(()=>[gl]),default:l(()=>[e(K,{label:"CPU",value:"cpu"}),e(K,{label:"GPU",value:"gpu"})]),_:1},8,["modelValue"]),a(n).inferredType==="cpu"?(U(),G(x,{key:0,type:"number",placeholder:"请输入使用CPU数量",rules:v.cpu,modelValue:a(n).cpu,"onUpdate:modelValue":r[5]||(r[5]=_=>a(n).cpu=_),modelModifiers:{number:!0},onInput:r[6]||(r[6]=_=>h(a(n).cpu,1,80,"请输入使用CPU数量",!0)),max:"80","hide-details":"auto"},{prepend:l(()=>[kl]),_:1},8,["rules","modelValue"])):F("",!0),a(n).inferredType==="gpu"?(U(),G(x,{key:1,type:"number",placeholder:"请输入使用GPU数量",rules:v.gpu,modelValue:a(n).gpu,"onUpdate:modelValue":r[7]||(r[7]=_=>a(n).gpu=_),modelModifiers:{number:!0},onInput:r[8]||(r[8]=_=>h(a(n).gpu,1,8,"请输入使用GPU数量",!0)),max:"8","hide-details":"auto"},{prepend:l(()=>[u("label",xl,[c("GPU数量 "),e(M,null,{default:l(()=>[c("单实例GPU数量")]),_:1})])]),_:1},8,["rules","modelValue"])):F("",!0),a(n).gpu>1?(U(),G(x,{key:2,type:"number",placeholder:"请输入GPU内存",rules:v.maxGpuMemory,modelValue:a(n).maxGpuMemory,"onUpdate:modelValue":r[9]||(r[9]=_=>a(n).maxGpuMemory=_),modelModifiers:{number:!0},onInput:r[10]||(r[10]=_=>h(a(n).maxGpuMemory,1,80,"",!0)),max:"80","hide-details":"auto"},{prepend:l(()=>[u("label",null,[c("GPU内存 "),e(M,null,{default:l(()=>[c("指定每个 GPU 用于存储模型权重的最大内存。这允许它为激活分配更多内存，因此您可以使用更长的上下文长度或更大的批量大小")]),_:1})])]),"append-inner":l(()=>[c(" GiB ")]),_:1},8,["rules","modelValue"])):F("",!0),e(t,{placeholder:"请选择k8s集群","hide-details":"auto",mapDictionary:{code:"k8s_cluster"},modelValue:a(n).k8sCluster,"onUpdate:modelValue":r[11]||(r[11]=_=>a(n).k8sCluster=_)},{prepend:l(()=>[vl]),_:1},8,["modelValue"]),e(ne,{label:"开启量化",modelValue:o.isQuantify,"onUpdate:modelValue":r[12]||(r[12]=_=>o.isQuantify=_),onChange:$,"hide-details":"auto",color:"primary"},{prepend:l(()=>[u("label",null,[c("量化 "),e(M,null,{default:l(()=>[c("对模型启动进行量化，节约显存提升推理速度")]),_:1})])]),_:1},8,["modelValue"]),Ue(e(t,{placeholder:"请选择精度",mapDictionary:{code:"model_deploy_quantization"},modelValue:a(n).quantization,"onUpdate:modelValue":r[13]||(r[13]=_=>a(n).quantization=_),style:{"margin-top":"-14px"},"hide-details":"auto"},{prepend:l(()=>[Tl]),_:1},8,["modelValue"]),[[De,o.isQuantify]]),e(ne,{style:{"margin-top":"-14px"},label:"开启VLLM",modelValue:a(n).vllm,"onUpdate:modelValue":r[14]||(r[14]=_=>a(n).vllm=_),"hide-details":"auto",color:"primary"},{prepend:l(()=>[u("label",null,[c("VLLM "),e(M,null,{default:l(()=>[c("如果想要高吞吐量批量处理，您可以尝试开启，开启后会占用gpu的所有显存容量")]),_:1})])]),_:1},8,["modelValue"])]),_:1},512)])]),_:1},512)}}});const Cl=ie(Nl,[["__scopeId","data-v-d19493a6"]]),Ul=["onClick"],Dl={key:0,style:{width:"80px"},class:"mx-auto mb-4"},Ml=u("span",{class:"text-body-2 text-lightText"},"部署中",-1),Il={key:1},$l=["onClick"],Pl={class:"text-primary font-weight-black"},wl=u("br",null,null,-1),Sl=u("br",null,null,-1),Fl=["innerHTML"],Bl={class:"d-flex align-center h-[50px]"},Gl=u("span",null,"日志",-1),ua=ee({__name:"modelList",setup(D){const{loadDictTree:Q,getLabels:z}=Me(),y=Ie(),o=$e(),n=W({style:{},formData:{modelName:"",enabled:null,providerName:null,modelType:null},selectedInfo:{id:"",modelName:"",containerNames:[]},tableInfos:{list:[],total:""},confirmByClickInfo:{html:"",action:"",row:{}}}),{style:q,formData:k}=le(n),V=g(),B=g(),h=g(),v=g(),$=g(),f=g(),s=g({title:"模型列表"}),d=g([{text:"模型管理",disabled:!1,href:"#"},{text:"模型列表",disabled:!0,href:"#"}]),r=g(),t=g(null),P=({id:i,modelName:p}={})=>{p?y.push("/model/chat-playground?modelName="+p+"&modelId="+i):y.push("/model/chat-playground")},_=({id:i,modelName:p})=>{y.push(`/model/model-list/detail?jobId=${i}&modelName=`+p)},fe=i=>{let p=[];for(let b of i.operation)b=="edit"?p.push({text:"编辑",color:"info",click(){he(i)}}):b=="delete"?p.push({text:"删除",color:"error",click(){ye(i)}}):b=="deploy"?p.push({text:"部署",color:"info",click(){B.value.show({title:"部署模型",infos:i})}}):b=="undeploy"&&p.push({text:"卸载",color:"info",click(){Y.assign(n.confirmByClickInfo,{html:"确认卸载模型 <span class='text-primary mx-1  font-weight-black'>"+i.modelName+"</span>吗？",action:"undeploy",row:i}),$.value.show({width:"350px"})}});return p},ce=(i={})=>{let{action:p,row:b}=n.confirmByClickInfo;p=="deploy"?ge(b,i):p=="undeploy"&&ke(b,i)},_e=async(i={})=>{await Q(["model_type"]);const[p,b]=await S.get({url:"/models",showLoading:v.value.el,data:{...n.formData,...i}});b?(n.tableInfos.list=b.list,n.tableInfos.total=b.total):(n.tableInfos.list=[],n.tableInfos.total=0),f.value.start()},I=()=>{v.value.query({page:1})},O=()=>{v.value.query()},ye=i=>{n.selectedInfo=i,h.value.show({width:"400px",confirmText:n.selectedInfo.modelName})},be=async(i={})=>{const[p,b]=await S.delete({...i,showSuccess:!0,url:`/api/models/${n.selectedInfo.id}`});b&&(h.value.hide(),I())},Ve=()=>{V.value.show({title:"添加模型",operateType:"add"})},he=i=>{V.value.show({title:"编辑模型",infos:i,operateType:"edit"})},ge=async(i,p)=>{let[b,R]=await S.post({...p,showSuccess:!0,url:`/api/models/${i.id}/deploy`});R&&($.value.hide(),O())},ke=async(i,p)=>{let[b,R]=await S.post({...p,showSuccess:!0,url:`/api/models/${i.id}/undeploy`});R&&($.value.hide(),O())},xe=async i=>{const p=i.containerNames||[];n.selectedInfo=i,t.value=p[0],r.value.show()},ae=async()=>{let[i,p]=await S.get({url:`/api/models/${n.selectedInfo.modelName}/container/${t.value}/logs`});if(p){const b=Object.keys(p).length===0?"":p;r.value.setContent(b)}},oe=i=>i.baseModelName||i.providerName!=="LocalAI"?!1:i.enabled&&i.modelType==="text-generation"||i.operation.indexOf("undeploy")!==-1;return Pe(()=>{let{modelName:i}=o.query;i&&(n.formData.modelName=i),I()}),(i,p)=>{const b=T("Select"),R=T("refresh-button"),ve=T("ButtonsInForm"),Z=T("el-tooltip"),C=T("el-table-column"),Te=T("router-link"),Ne=T("ButtonsInTable"),Ce=T("TableWithPager");return U(),H(re,null,[e(Se,{title:s.value.title,breadcrumbs:d.value},null,8,["title","breadcrumbs"]),e(de,null,{default:l(()=>[e(w,null,{default:l(()=>[e(Fe,null,{default:l(()=>[e(de,null,{default:l(()=>[e(w,{cols:"12",lg:"3",md:"4",sm:"6"},{default:l(()=>[e(x,{density:"compact",modelValue:a(k).modelName,"onUpdate:modelValue":p[0]||(p[0]=m=>a(k).modelName=m),label:"搜索模型名称","hide-details":"",clearable:"",variant:"outlined",color:"red",onKeyup:we(I,["enter"]),"onClick:clear":I},null,8,["modelValue","onKeyup"])]),_:1}),e(w,{cols:"12",lg:"2",md:"4",sm:"6"},{default:l(()=>[e(b,{onChange:I,label:"请选择状态",mapDictionary:{code:"local_enabled"},modelValue:a(k).enabled,"onUpdate:modelValue":p[1]||(p[1]=m=>a(k).enabled=m)},null,8,["modelValue"])]),_:1}),e(w,{cols:"12",lg:"2",md:"4",sm:"6"},{default:l(()=>[e(b,{onChange:I,label:"请选择模型类型",mapDictionary:{code:"model_type"},modelValue:a(k).modelType,"onUpdate:modelValue":p[2]||(p[2]=m=>a(k).modelType=m)},null,8,["modelValue"])]),_:1}),e(w,{cols:"12",lg:"2",md:"4",sm:"6"},{default:l(()=>[e(b,{onChange:I,label:"请选择供应",mapDictionary:{code:"model_provider_name"},modelValue:a(k).providerName,"onUpdate:modelValue":p[3]||(p[3]=m=>a(k).providerName=m)},null,8,["modelValue"])]),_:1}),e(w,{cols:"12",lg:"3",md:"4",sm:"6"},{default:l(()=>[e(ve,null,{default:l(()=>[e(J,{color:"primary",onClick:P},{default:l(()=>[c("聊天操场")]),_:1}),e(J,{color:"primary",onClick:Ve},{default:l(()=>[c("添加模型")]),_:1}),e(R,{ref_key:"refreshButtonRef",ref:f,onRefresh:O},null,512)]),_:1})]),_:1}),e(w,{cols:"12"},{default:l(()=>[e(Be,null,{default:l(()=>[c(" 修改之后将实时生效，请谨慎操作！ ")]),_:1})]),_:1}),e(w,{cols:"12"},{default:l(()=>[e(Ce,{onQuery:_e,ref_key:"refTableWithPager",ref:v,infos:n.tableInfos},{default:l(()=>[e(C,{label:"模型",width:"200px",fixed:"left"},{default:l(({row:m})=>[e(Z,{content:"查看详情",placement:"top"},{default:l(()=>[u("span",{class:"link",onClick:L=>_(m)},A(m.modelName),9,Ul)]),_:2},1024)]),_:1}),e(C,{label:"最长上下文",width:"110px"},{default:l(({row:m})=>[u("span",null,A(m.maxTokens),1)]),_:1}),e(C,{label:"模型类型",width:"110px"},{default:l(({row:m})=>[u("span",null,A(a(z)([["model_type",m.modelType]])),1)]),_:1}),e(C,{label:"是否启用","min-width":"100px"},{default:l(({row:m})=>[e(qe,{modelValue:m.enabled,"onUpdate:modelValue":L=>m.enabled=L},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(C,{label:"是否微调","min-width":"100px"},{default:l(({row:m})=>[e(Ge,{modelValue:m.isFineTuning,"onUpdate:modelValue":L=>m.isFineTuning=L},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(C,{label:"部署","min-width":"150px"},{default:l(({row:m})=>[m.deployStatus=="pending"?(U(),H("div",Dl,[e(Qe,{height:"24",striped:"",indeterminate:"",color:"#4eb879",rounded:"",class:"mx-auto"},{default:l(()=>[Ml]),_:1})])):F("",!0),m.enabled&&m.modelType==="text-generation"?(U(),H("div",Il,[e(J,{onClick:L=>P(m),"prepend-icon":"mdi-chat",size:"small",variant:"outlined",color:"info"},{prepend:l(()=>[e(a(Xe),{size:16})]),default:l(()=>[c(" 对话 ")]),_:2},1032,["onClick"])])):F("",!0)]),_:1}),e(C,{label:"终端信息","min-width":"90px"},{default:l(({row:m})=>[oe(m)?(U(),G(Z,{key:0,content:"点击查看",placement:"top"},{default:l(()=>[u("a",{class:"link",href:"javascript: void(0)",onClick:L=>xe(m)},[e(a(Ze),{class:"align-top",size:20})],8,$l)]),_:2},1024)):F("",!0)]),_:1}),e(C,{label:"webshell","min-width":"90px"},{default:l(({row:m})=>[oe(m)?(U(),G(Z,{key:0,content:"进入终端",placement:"top"},{default:l(()=>[e(Te,{class:"link",to:{path:"/model/terminal",query:{resourceType:"deployment",serviceName:m.modelName}},target:"_blank"},{default:l(()=>[e(a(Je),{class:"align-top",size:20})]),_:2},1032,["to"])]),_:2},1024)):F("",!0)]),_:1}),e(C,{label:"备注","min-width":"200px","show-overflow-tooltip":""},{default:l(({row:m})=>[c(A(m.remark),1)]),_:1}),e(C,{label:"更新时间","min-width":"200px"},{default:l(({row:m})=>[c(A(a(X).dateFormat(m.updatedAt,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),e(C,{label:"操作","min-width":"120px",fixed:"right"},{default:l(({row:m})=>[e(Ne,{buttons:fe(m)},null,8,["buttons"])]),_:1})]),_:1},8,["infos"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(_l,{ref_key:"refPaneModel",ref:V,onSubmit:I},null,512),e(Cl,{ref_key:"refArrangeModel",ref:B,onSubmit:I},null,512),e(He,{ref_key:"refConfirmDelete",ref:h,onSubmit:be},{text:l(()=>[c(" 您将要删除 "),u("span",Pl,A(n.selectedInfo.modelName),1),c(" 模型，删除之后，"),wl,c(" 若有使用该模型的应用场景都将取消授权。 "),Sl,c("确定要继续吗？ ")]),_:1},512),e(Ke,{ref_key:"refConfirmByClick",ref:$,onSubmit:ce},{text:l(()=>[u("div",{innerHTML:n.confirmByClickInfo.html},null,8,Fl)]),_:1},512),e(Oe,{ref_key:"refDialogLog",ref:r,interval:20,onRefresh:ae},{title:l(()=>[u("div",Bl,[Gl,e(ze,{class:"w-[350px] ml-5",modelValue:t.value,"onUpdate:modelValue":[p[4]||(p[4]=m=>t.value=m),ae],clearable:!1,"hide-details":"",items:n.selectedInfo.containerNames||[],label:"请选择容器"},null,8,["modelValue","items"])])]),_:1},512)],64)}}});export{ua as default};
