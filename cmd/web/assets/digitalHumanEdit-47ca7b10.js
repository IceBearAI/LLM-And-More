import{d as J,b7 as Q,i as X,x as I,z as G,o as O,U as $,k as u,Z as v,W as d,n as s,F as E,l as D,m as a,j as e,Y as K,be as W,a6 as ee,_ as m,$ as A,bg as z,a1 as ae,b8 as M,aD as te,r as N,D as le,a2 as R,am as oe,an as se}from"./utils-8a4540e3.js";import{_ as j}from"./UiParentCard.vue_vue_type_script_setup_true_lang-a50df5aa.js";import{_ as ne}from"./Explain.vue_vue_type_style_index_0_lang-addb7248.js";import{I as re,S as ie}from"./SpeakerSelector-9c62cfe9.js";import{_ as de}from"./TagCorner.vue_vue_type_style_index_0_lang-c57cbe5d.js";import{ac as ue,L as me,a4 as q,$ as ce,_ as Y,a3 as S}from"./index-b4ac7dfa.js";import{V as i}from"./VCol-b8625bbb.js";import{V as w}from"./VRow-a7542fa4.js";import{u as pe}from"./useScroll-87d0b5f6.js";import{_ as fe}from"./NavBack.vue_vue_type_script_setup_true_lang-ea36603e.js";import{V as _e}from"./VForm-b3ea2b89.js";import{V as ge}from"./VTextarea-2463a3df.js";import{V as ye}from"./VSwitch-3736c286.js";import{V as ve,a as he,b as Ve,c as ke}from"./VExpansionPanel-2587d006.js";import"./AiAudio.vue_vue_type_style_index_0_lang-5b0c997f.js";const be={class:"aspect-square"},xe=["src","poster"],Se={class:"d-flex align-center justify-center fill-height"},De={key:1,class:"h-full w-full bg-gray-100"},we={class:"box-list scrollbar-auto flex-1 pt-4 overflow-auto"},Ce=["onClick"],Te={class:"relative overflow-hidden"},Ie={class:"image-human overflow-hidden"},Ue=["src","alt"],He={class:"hv-center mt-2"},Ne={class:"line1"},Ge=J({__name:"DigitalHumanSelector",setup(h){Q();const V=X("provieDigitalHumanEdit"),f=I({list:[],formData:{name:""}}),{formData:C}=G(f),{selectedDigitalHuman:c}=G(V);function k(T){V.selectedDigitalHuman=T}const r=async()=>{await M.get({showLoading:!0,url:"/api/digitalhuman/person/list",data:{pageSize:20,page:1,...f.formData}}).then(([T,n])=>{n&&(f.list=n.list,f.list.length>0?k(f.list[0]):V.selectedDigitalHuman={name:"",cname:"",cover:"",video:"",mediaType:""})})};return O(()=>{r()}),(T,n)=>{const B=$("NoData");return u(),v("div",null,[d("div",be,[s(c).video?(u(),v(E,{key:0},[s(c).mediaType=="video"?(u(),v("video",{key:0,style:{width:"100%",height:"100%"},src:s(c).video,controls:"",poster:s(c).cover,class:"block"},null,8,xe)):s(c).mediaType=="image"?(u(),D(me,{key:1,src:s(c).video},{placeholder:a(()=>[d("div",Se,[e(ue,{color:"primary",indeterminate:"",width:2,size:42})])]),_:1},8,["src"])):K("",!0)],64)):(u(),v("div",De))]),e(w,{class:"mt-5"},{default:a(()=>[e(i,null,{default:a(()=>[e(q,{density:"compact",modelValue:s(C).name,"onUpdate:modelValue":n[0]||(n[0]=l=>s(C).name=l),label:"搜索角色名称","hide-details":"",clearable:"",variant:"outlined",color:"red",onKeyup:W(r,["enter"]),"onClick:clear":r},null,8,["modelValue","onKeyup"])]),_:1})]),_:1}),d("div",we,[f.list.length?(u(!0),v(E,{key:0},ee(f.list,(l,U)=>(u(),D(ce,{variant:"outlined",rounded:"sm",elevation:"0",class:"pa-2 bg-hover-secondary d-inline-block list-item ma-2 overflow-visible",pointer:""},{default:a(()=>{var b;return[d("div",{onClick:g=>k(l)},[d("div",Te,[e(de,{class:ae(s(z).mediaType[l.mediaType].className)},{default:a(()=>[m(A(s(z).mediaType[l.mediaType].text),1)]),_:2},1032,["class"]),d("div",Ie,[d("img",{src:l.cover,alt:l.cname},null,8,Ue)]),d("div",He,[d("div",Ne,A(l.cname),1)])]),l.name===((b=s(c))==null?void 0:b.name)?(u(),D(re,{key:0})):K("",!0)],8,Ce)]}),_:2},1024))),256)):(u(),D(B,{key:1},{default:a(()=>[m("暂无数据，请更换搜索条件")]),_:1}))])])}}});const $e=Y(Ge,[["__scopeId","data-v-472de3c9"]]),Ee=h=>(oe("data-v-f862b8b1"),h=h(),se(),h),Ke=Ee(()=>d("div",null,"请输入语音播放文本，文本内容小于500个字(包括标点符号)。",-1)),Me={class:"generate-text"},qe={class:"flex-1"},Be=J({__name:"digitalHumanEdit",setup(h){const{scrollRef:V,scrollToBottom:f}=pe(),C=te(),c=N(),k=N(),r=I({style:{},textKey:"",formData:{text:"",title:"",speakName:"",isGfpgan:!1,synthesisModel:null},selectedSpeaker:{speakName:"",speakCname:"",headImg:"",speakDemo:"",gender:"",ageGroup:"",subTitle:""},selectedDigitalHuman:{name:"",cname:"",cover:"",video:"",mediaType:""},listSpeaker:[]}),{style:T,formData:n,selectedSpeaker:B}=G(r);le("provieDigitalHumanEdit",r);const l=I({provider:null,lang:null,gender:null,ageGroup:null,speakStyle:null,area:null}),U=N(),b=I({title:[p=>!!p||"请输入标题"],text:[p=>!!p||"请输入语音播放文本",p=>p.length<=500||"文本内容不能超过500个字"]}),g=()=>{U.value.reload({lang:l.lang,provider:l.provider,gender:l.gender,ageGroup:l.ageGroup,speakStyle:l.speakStyle,area:l.area})},F=async()=>{if(r.textKey){const p={model:"gpt-4-turbo-preview",maxTokens:512,temperature:0,topP:0,messages:[{role:"system",content:"你是一个文案专家，请根据输入的关键词，生成一段优秀的营销文案"},{role:"user",content:r.textKey}]};let t=!1;await M.post({url:"/channels/chat/completions",timeout:300*1e3,data:p,showLoading:"btn#btnGenerateText",onDownloadProgress:y=>{const _=y.target,{responseText:o}=_,L=o.lastIndexOf(`
`,o.length-2);let P=o;L!==-1&&(P=o.substring(L));try{const x=JSON.parse(P);if(x.success){const H=x.data;H&&H.fullContent&&(r.formData.text=H.fullContent,f())}else t||(R.error(x.message||"AI生成文案异常"),t=!0),console.error("AI生成文案异常：",x)}catch{}}})}},Z=async()=>{const{valid:p}=await c.value.validate();if(p){r.formData.synthesisModel!=="wav2lip"&&(r.formData.isGfpgan=!1);const[t,y]=await M.post({url:"/api/digitalhuman/synthesis/create",showSuccess:!0,showLoading:"btn#btnSubmit",data:{...r.formData,dhpName:r.selectedDigitalHuman.name}});y&&C.push("/digital-human/video-list/list")}else{let t="请处理页面标错的地方后，再尝试提交";R.warning(t)}};return O(()=>{V.value=k.value.$el.querySelector("textarea")}),(p,t)=>{const y=$("AiBtn"),_=$("Select");return u(),v(E,null,[e(fe,{backUrl:"/digital-human/video-list/list"},{default:a(()=>[m("创建视频")]),_:1}),e(w,null,{default:a(()=>[e(i,{cols:"12",md:"6"},{default:a(()=>[e(j,{title1:"人物视频"},{default:a(()=>[e($e)]),_:1})]),_:1}),e(i,{cols:"12",md:"6"},{default:a(()=>[e(j,{title:"开始数字人合成"},{default:a(()=>[e(_e,{ref_key:"refForm",ref:c,class:"my-form"},{default:a(()=>[e(w,null,{default:a(()=>[e(i,{cols:"12"},{default:a(()=>[e(S,{class:"mb-2 required"},{default:a(()=>[m("标题"),e(ne,{class:"ml-2"},{default:a(()=>[m("用于列表展示和搜索，能够快速了解基本信息")]),_:1})]),_:1}),e(q,{density:"compact",variant:"outlined",placeholder:"请输入标题","hide-details":"auto",rules:b.title,modelValue:s(n).title,"onUpdate:modelValue":t[0]||(t[0]=o=>s(n).title=o)},null,8,["rules","modelValue"])]),_:1}),e(i,{cols:"12"},{default:a(()=>[e(S,{class:"mb-2 required",style:{"white-space":"inherit"}},{default:a(()=>[Ke]),_:1}),d("div",Me,[e(w,null,{default:a(()=>[e(i,{cols:"12",class:"flex space-x-2"},{default:a(()=>[d("div",qe,[e(q,{density:"compact",variant:"outlined",placeholder:"请输入关键字","hide-details":"auto",modelValue:r.textKey,"onUpdate:modelValue":t[1]||(t[1]=o=>r.textKey=o),onKeyup:W(F,["enter"]),clearable:""},null,8,["modelValue","onKeyup"])]),e(y,{id:"btnGenerateText",color:"secondary",height:"40",onClick:F,disabled:!r.textKey},{default:a(()=>[m("AI生成文案")]),_:1},8,["disabled"])]),_:1})]),_:1})]),e(ge,{ref_key:"refTextarea",ref:k,modelValue:s(n).text,"onUpdate:modelValue":t[2]||(t[2]=o=>s(n).text=o),modelModifiers:{trim:!0},rules:b.text,placeholder:"请输入语音播放文本",counter:"",rows:"5",maxlength:"500"},null,8,["modelValue","rules"])]),_:1}),e(i,{cols:"12"},{default:a(()=>[e(S,{class:"mb-2 required"},{default:a(()=>[m("模型选择")]),_:1}),e(_,{mapDictionary:{code:"digitalhuman_synthesis_model"},modelValue:s(n).synthesisModel,"onUpdate:modelValue":t[3]||(t[3]=o=>s(n).synthesisModel=o),defaultFirst:"",clearable:!1},null,8,["modelValue"])]),_:1}),s(n).synthesisModel==="wav2lip"?(u(),D(i,{key:0,cols:"12"},{default:a(()=>[e(S,{class:"mb-2 required"},{default:a(()=>[m("是否超分")]),_:1}),e(ye,{modelValue:s(n).isGfpgan,"onUpdate:modelValue":t[4]||(t[4]=o=>s(n).isGfpgan=o),color:"primary","hide-details":"auto"},null,8,["modelValue"])]),_:1})):K("",!0),e(i,{cols:"12"},{default:a(()=>[e(S,{class:"mb-2 required"},{default:a(()=>[m("请选择需要合成的发声人")]),_:1}),e(ve,{class:"mb-3"},{default:a(()=>[e(he,{elevation:"1"},{default:a(()=>[e(Ve,null,{default:a(()=>[m("高级搜索")]),_:1}),e(ke,{class:"mt-4",eager:""},{default:a(()=>[e(w,null,{default:a(()=>[e(i,{cols:"4"},{default:a(()=>[e(_,{mapDictionary:{code:"speak_provider"},label:"请选择供应",modelValue:l.provider,"onUpdate:modelValue":t[5]||(t[5]=o=>l.provider=o),onChange:g},null,8,["modelValue"])]),_:1}),e(i,{cols:"4"},{default:a(()=>[e(_,{mapDictionary:{code:"speak_lang"},label:"请选择语言",modelValue:l.lang,"onUpdate:modelValue":t[6]||(t[6]=o=>l.lang=o),onChange:g},null,8,["modelValue"])]),_:1}),e(i,{cols:"4"},{default:a(()=>[e(_,{mapDictionary:{code:"speak_gender"},label:"请选择性别",modelValue:l.gender,"onUpdate:modelValue":t[7]||(t[7]=o=>l.gender=o),onChange:g},null,8,["modelValue"])]),_:1}),e(i,{cols:"4"},{default:a(()=>[e(_,{mapDictionary:{code:"speak_age_group"},label:"请选择年龄段",modelValue:l.ageGroup,"onUpdate:modelValue":t[8]||(t[8]=o=>l.ageGroup=o),onChange:g},null,8,["modelValue"])]),_:1}),e(i,{cols:"4"},{default:a(()=>[e(_,{mapDictionary:{code:"speak_style"},label:"请选择说话风格",modelValue:l.speakStyle,"onUpdate:modelValue":t[9]||(t[9]=o=>l.speakStyle=o),onChange:g},null,8,["modelValue"])]),_:1}),e(i,{cols:"4"},{default:a(()=>[e(_,{mapDictionary:{code:"speak_area"},label:"请选择适应范围",modelValue:l.area,"onUpdate:modelValue":t[10]||(t[10]=o=>l.area=o),onChange:g},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(ie,{ref_key:"refSpeakerSelector",ref:U,modelValue:s(n).speakName,"onUpdate:modelValue":t[11]||(t[11]=o=>s(n).speakName=o)},null,8,["modelValue"])]),_:1}),e(i,{cols:"12",class:"hv-center"},{default:a(()=>[e(y,{id:"btnSubmit",color:"secondary",width:"200",height:"48",size:"large",onClick:Z},{default:a(()=>[m("开始合成")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})],64)}}});const aa=Y(Be,[["__scopeId","data-v-f862b8b1"]]);export{aa as default};
