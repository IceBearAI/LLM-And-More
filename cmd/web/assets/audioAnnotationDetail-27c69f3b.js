import{d as T,i as E,b8 as K,aE as z,r as Q,x as C,z as W,o as Y,U as h,S as Z,k as L,Z as w,j as a,m as t,_ as d,W as n,Q as $,$ as i,n as s,a4 as G,F as H,b9 as p,a9 as I,a2 as J}from"./utils-91854e55.js";import{_ as O}from"./NavBack.vue_vue_type_script_setup_true_lang-0ba665e2.js";import{_ as X}from"./UiParentCard.vue_vue_type_script_setup_true_lang-72749ad5.js";import{Y as aa,ad as S,K as ta,$ as ea,a3 as B,V as oa,a2 as na}from"./index-38e2b3cf.js";import{_ as sa}from"./AiAudio.vue_vue_type_style_index_0_lang-52a6c53d.js";import{V as b}from"./VRow-a4b8abae.js";import{V as u}from"./VCol-4c3995c3.js";import{V as M}from"./VTextarea-e715451f.js";import{V as la}from"./VForm-24c895bc.js";const da=n("label",null,"任务ID",-1),ia={class:"link"},ra=n("label",null,"任务名称",-1),ua={class:"v-box item-end"},ca={class:"pr-5"},ga={class:"link font-bold"},ma={class:"px-5"},pa={class:"link font-bold"},fa={class:"px-5"},_a={class:"link font-bold"},ha={class:"px-5"},ba={class:"link font-bold"},ya={class:"ml-1"},Da={class:"required"},ka={class:"required"},va={class:"flex justify-between mt-5"},Va=n("div",null,null,-1),Fa=T({__name:"audioAnnotationDetail",setup(xa){const{t:U}=aa(),F=E("provideAspectPage"),j=K(),A=z(),f=Q();let y=!1;const e=C({style:{},annotationId:"",displayData:{name:"",total:0,uncompleted:0,completed:0,abandoned:0,audioUrl:"",originalContent:"",originalLanguage:""},formData:{uuid:"",taggedContent:"",taggedLanguage:null}}),{formData:c,displayData:r}=W(e),D=C({taggedContent:[l=>!!l||"请输入信息"],taggedLanguage:[l=>!!l||"请选择"]}),k=async()=>{const[l,o]=await p.get({showLoading:!0,url:`/api/mgr/annotation/audio/task/${e.annotationId}/info`});o&&(e.displayData={...e.displayData,...o},e.displayData.uncompleted=o.total-o.completed-o.abandoned,na(document).scrollTop(0))},v=()=>{y&&F.methods.refreshListPage(),A.push("/sound-sample/audio-annotation/list")},V=async()=>{f.value.resetValidation(),e.formData={uuid:"",taggedContent:"",taggedLanguage:null};const[l,o]=await p.get({showLoading:!0,url:`/api/mgr/annotation/audio/task/${e.annotationId}/next`});o&&(e.displayData.originalContent=o.originalContent||"",e.displayData.originalLanguage=o.originalLanguage||null,e.displayData.audioUrl=o.audioUrl||"",I.assign(e.formData,I.pick(o,["uuid","taggedContent","taggedLanguage"])),e.formData.taggedContent||(e.formData.taggedContent=e.displayData.originalContent),e.formData.taggedLanguage||(e.formData.taggedLanguage=e.displayData.originalLanguage))},x=()=>{y=!0,e.displayData.uncompleted==1?v():(k(),V())},N=async()=>{const[l,o]=await p.put({showLoading:!0,showSuccess:!0,url:`/api/mgr/annotation/audio/task/${e.annotationId}/taskSegment/${e.formData.uuid}/abandon`});o&&x()},R=async()=>{let{valid:l,errors:o}=await f.value.validate();if(l){const[m,_]=await p.put({showLoading:!0,showSuccess:!0,url:`/api/mgr/annotation/audio/task/${e.annotationId}/taskSegment/${e.formData.uuid}/annotation`,data:e.formData});_&&x()}else{let m=U("pane.errorMsg");J.warning(m)}};return Y(()=>{let{annotationId:l}=j.query;e.annotationId=l,k(),V()}),(l,o)=>{const m=h("Select"),_=h("AiBtn"),q=h("ButtonsInForm"),P=Z("copy");return L(),w(H,null,[a(O,{backUrl:"backCallback",onBack:v},{default:t(()=>[d("音频标注")]),_:1}),a(X,{class:"mt-4"},{default:t(()=>[n("div",null,[a(b,{class:"my-form waterfall"},{default:t(()=>[a(u,{cols:"12",md:"6"},{default:t(()=>[a(u,null,{default:t(()=>[a(S,{"hide-details":""},{prepend:t(()=>[da]),default:t(()=>[$((L(),w("span",ia,[d(i(e.annotationId),1)])),[[P,e.annotationId]])]),_:1})]),_:1}),a(u,null,{default:t(()=>[a(S,{"hide-details":""},{prepend:t(()=>[ra]),default:t(()=>[d(" "+i(s(r).name),1)]),_:1})]),_:1})]),_:1}),a(u,{cols:"12",md:"6",class:"text-xl text-slate-500 flex justify-end"},{default:t(()=>[n("div",ua,[a(u,{class:"flex justify-end"},{default:t(()=>[n("div",ca,[d(" 标注进度："),$(n("span",null,[n("span",ga,i(s(r).completed+s(r).abandoned+1),1),d("/"+i(s(r).total),1)],512),[[G,e.displayData.total]])])]),_:1}),a(u,{class:"ml-auto flex flex-wrap divide-x"},{default:t(()=>[n("div",ma,[d(" 已完成："),n("span",pa,i(s(r).completed),1)]),n("div",fa,[d(" 未完成："),n("span",_a,i(s(r).uncompleted),1)]),n("div",ha,[d(" 丢弃："),n("span",ba,i(s(r).abandoned),1)])]),_:1})])]),_:1})]),_:1})]),a(ta,{class:"mb-5"}),a(b,null,{default:t(()=>[a(u,{cols:"12",md:"6"},{default:t(()=>[a(ea,{class:"h-full flex p-4 overflow-hidden min-h-[300px] max-h-[665px] text-[15px]",elevation:"3"},{default:t(()=>[a(b,null,{default:t(()=>[a(u,{cols:"12"},{default:t(()=>[a(B,{class:"mb-2 font-medium"},{default:t(()=>[d(i(l.$t("audioMark.audio")),1)]),_:1}),a(sa,{type:"complex",src:s(r).audioUrl},null,8,["src"])]),_:1}),a(u,{cols:"12"},{default:t(()=>[a(B,{class:"mb-2 font-medium"},{default:t(()=>[d(i(l.$t("audioMark.pane.originalContent"))+" ",1),n("span",ya,"("+i(l.$t("options.markLanguage."+s(r).originalLanguage))+")",1)]),_:1}),a(M,{modelValue:s(r).originalContent,"onUpdate:modelValue":o[0]||(o[0]=g=>s(r).originalContent=g),readonly:"","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),a(u,{cols:"12",md:"6"},{default:t(()=>[a(la,{ref_key:"refForm",ref:f,class:"my-form space-y-4"},{default:t(()=>[a(M,{modelValue:s(c).taggedContent,"onUpdate:modelValue":o[1]||(o[1]=g=>s(c).taggedContent=g),modelModifiers:{trim:!0},class:"block","hide-details":"auto",clearable:"","validate-on":"submit",placeholder:"请输入",rules:D.taggedContent},{prepend:t(()=>[n("label",Da,i(l.$t("audioMark.pane.taggedContent")),1)]),_:1},8,["modelValue","rules"]),a(m,{class:"block","hide-details":"auto","validate-on":"submit",mapDictionary:{code:"audio_tagged_lang",i18nKey:"markLanguage"},modelValue:s(c).taggedLanguage,"onUpdate:modelValue":o[2]||(o[2]=g=>s(c).taggedLanguage=g),rules:D.taggedLanguage},{prepend:t(()=>[n("label",ka,i(l.$t("audioMark.pane.taggedLanguage")),1)]),_:1},8,["modelValue","rules"])]),_:1},512)]),_:1})]),_:1}),n("div",va,[Va,a(q,null,{default:t(()=>[a(oa,{class:"w-[120px] btn-danger",plain:"",onClick:N,disabled:!s(c).uuid},{default:t(()=>[d("丢弃")]),_:1},8,["disabled"]),a(_,{color:"secondary",class:"w-[120px]",onClick:R,disabled:!s(c).uuid},{default:t(()=>[d("提交")]),_:1},8,["disabled"])]),_:1})])]),_:1})],64)}}});export{Fa as default};
