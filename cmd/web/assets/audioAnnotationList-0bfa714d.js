import{_ as oe}from"./BaseBreadcrumb.vue_vue_type_style_index_0_lang-6c45f033.js";import{_ as se}from"./UiParentCard.vue_vue_type_script_setup_true_lang-80e0344c.js";import{d as E,x as U,z as K,r as _,a9 as ie,U as h,k as Y,l as re,m as n,W as e,j as t,n as m,aj as de,ak as ue,_ as l,$ as r,b9 as V,bB as j,am as ce,an as me,i as pe,ad as _e,aE as fe,o as ge,S as he,Z as W,a1 as be,bg as Q,Q as xe,F as ye}from"./utils-5e900427.js";import{R as ve}from"./RangeSliderWithInput-09506962.js";import{h as ke,a4 as we,_ as Ve,V as Se,d as De}from"./index-81f01cfc.js";import{V as Re}from"./VForm-b09769b4.js";import{A as Ce}from"./AlertBlock-6ddab86e.js";import{_ as z}from"./ConfirmByInput.vue_vue_type_style_index_0_lang-41959266.js";import{_ as H}from"./ConfirmByClick.vue_vue_type_style_index_0_lang-58ada805.js";import{V as Pe}from"./VRow-1ab8c2e6.js";import{V as N}from"./VCol-8780c689.js";import{V as Te}from"./VSlider-7d8ee13e.js";import"./VAlert-f25c0183.js";import"./Confirm-298ef43f.js";const T=C=>(ce("data-v-e564907a"),C=C(),me(),C),Ie={class:"mx-auto mt-10",style:{width:"500px"}},Ae=T(()=>e("label",{class:"required"},"负责人",-1)),$e=T(()=>e("label",{class:"required"},"语言",-1)),qe=T(()=>e("label",{class:"required"},"数据序列",-1)),Be=T(()=>e("div",{class:"text-gray-400 text-sm mt-2 ml-[44px]"},"数据的随机10%会成为测试集，其余部分会作为训练集",-1)),Fe=T(()=>e("label",{class:"required"},"任务名称",-1)),Le=E({__name:"PaneAudioAnnotationTask",emits:["submit"],setup(C,{expose:A,emit:$}){const x=U({formData:{name:"",principal:null,dataSequence:[],language:null},rangeConfig:{min:0,max:0}}),{formData:f,rangeConfig:S}=K(x),P=$;_("");const y=_(),D=_(),k=_(),w=U({name:[d=>!!d||"请输入任务名称"],principal:[d=>!!d||"请输入负责人"],language:[d=>!!d||"请选择语言"],dataSequence:[()=>{let[d,u]=x.formData.dataSequence;return u>d?!0:"数据序列上限值需大于下限值"}]}),s=async d=>{const[u,g]=await V.get({url:"/api/mgr/annotation/audio/task/count",data:{language:d}});let{rangeConfig:v}=x;g?(j.scaleIn(k.value),v.max=g.total):(j.scaleIn(k.value),v.max=0),x.formData.dataSequence=[v.min,v.max]},R=async(d={})=>{const[u,g]=await V.post({...d,url:"/api/mgr/annotation/audio/task/create",data:{...x.formData}});g&&(y.value.hide(),P("submit"))},q=async({valid:d,showLoading:u})=>{d&&R({showLoading:u})};return A({show({title:d,infos:u={name:"",principal:null,dataSequence:[0,0],language:null},operateType:g}){y.value.show({title:d,refForm:D}),g=="add"&&(x.formData=ie.cloneDeep(u))}}),(d,u)=>{const g=h("remote-select"),v=h("Select"),B=h("Pane");return Y(),re(B,{ref_key:"refPane",ref:y,class:"",onSubmit:q},{default:n(()=>[e("div",Ie,[t(Re,{ref_key:"refForm",ref:D,class:"my-form"},{default:n(()=>[t(g,{modelValue:m(f).principal,"onUpdate:modelValue":u[0]||(u[0]=c=>m(f).principal=c),rules:w.principal,"no-filter":"",placeholder:"请输入负责人邮箱前缀",mapAPI:{url:"/api/accounts",data:{},labelField:"email",valueField:"email",search_keywordField:"email"},"menu-props":{eager:!0}},{prepend:n(()=>[Ae]),"list-item":n(({listItem:{props:c}})=>[t(ke,de(ue(c)),{title:n(()=>[l(r(`${c.rawData.nickname}(${c.rawData.email})`),1)]),_:2},1040)]),_:1},8,["modelValue","rules"]),t(v,{placeholder:"请选择语言",rules:w.language,mapDictionary:{code:"audio_tagged_lang",i18nKey:"markLanguage"},modelValue:m(f).language,"onUpdate:modelValue":u[1]||(u[1]=c=>m(f).language=c),onChange:s},{prepend:n(()=>[$e]),_:1},8,["rules","modelValue"]),e("div",{ref_key:"refRange",ref:k},[t(ve,{rules:w.dataSequence,modelValue:m(f).dataSequence,"onUpdate:modelValue":u[2]||(u[2]=c=>m(f).dataSequence=c),min:m(S).min,max:m(S).max},{prepend:n(()=>[qe]),_:1},8,["rules","modelValue","min","max"]),Be],512),t(we,{type:"text",placeholder:"请输入任务名称","hide-details":"auto",clearable:"",rules:w.name,modelValue:m(f).name,"onUpdate:modelValue":u[3]||(u[3]=c=>m(f).name=c)},{prepend:n(()=>[Fe]),_:1},8,["rules","modelValue"])]),_:1},512)])]),_:1},512)}}});const Ue=Ve(Le,[["__scopeId","data-v-e564907a"]]),Ye={class:"flex",style:{width:"600px"}},Me={class:"space-y-2"},je={class:"link font-bold"},We={class:"link font-bold"},Qe={class:"link font-bold"},ze={class:"space-y-2"},He={class:"link font-bold"},Ne={class:"link font-bold"},Ee=e("br",null,null,-1),Ke=e("span",{class:"text-primary font-weight-black"},"删除",-1),Ze=e("br",null,null,-1),Ge={class:"text-primary font-weight-black"},Je=e("br",null,null,-1),Oe=e("br",null,null,-1),Xe=e("span",{class:"text-primary font-weight-black"},"取消",-1),et=e("br",null,null,-1),tt={class:"text-primary font-weight-black"},at=e("br",null,null,-1),nt=e("div",{classs:"text-slate-500"},[l(" 此操作将新建基于该数据集的测试集和训练集，"),e("span",{class:"text-slate-700 font-bold"},"原数据集不会改变。"),l("数据集将会按照以下比例随机切分。 ")],-1),lt={class:"flex justify-between mt-5 mb-2"},ot={class:"text-primary"},st={class:"text-primary"},vt=E({__name:"audioAnnotationList",setup(C){const A=pe("provideAspectPage"),{getLabels:$}=_e(),x=fe(),f=_(),S=_(),P=_(),y=_(),D=_(),k=_(),w=_(),s=U({style:{},formData:{status:null,language:null},tableInfos:{list:[],total:""},selectedRow:{}}),{formData:R}=K(s),q=_({title:"音频标注列表"}),d=_([{text:"样本库",disabled:!1,href:"#"},{text:"音频标注列表",disabled:!0,href:"#"}]),u=o=>{x.push(`/sound-sample/audio-annotation/detail?annotationId=${o}`)},g=async()=>{const[o,i]=await V.put({showSuccess:!0,url:`/api/mgr/annotation/audio/task/${s.selectedRow.uuid}/split`,data:{testPercent:s.selectedRow.testPercent/100}});i&&(D.value.hide(),c())},v=async(o={})=>{await V.download({...o,url:`/api/mgr/annotation/audio/task/${s.selectedRow.uuid}/export`})&&k.value.hide()},B=o=>{let i=[],{status:p}=o;return["pending","processing"].includes(o.status)&&i.push({text:"标注",click(){u(o.uuid)}}),["completed"].includes(p)&&(i.push({text:"导出",click(){s.selectedRow=o,k.value.show({width:"500px",title:"导出选择"})}}),o.testTotal===0&&i.push({text:"切分",click(){s.selectedRow=o;let{testTotal:L,trainTotal:I}=o;s.selectedRow.testPercent=Math.floor(I*100/(I+L)),D.value.show({width:"400px"})}})),["processing"].includes(p)&&i.push({text:"取消",color:"error",click(){X(o)}}),["completed","cleaned","abandoned","pending"].includes(p)&&i.push({text:"删除",color:"error",click(){G(o)}}),i},c=async(o={})=>{const[i,p]=await V.get({url:"/api/mgr/annotation/audio/task/list",showLoading:y.value.el,data:{...s.formData,...o}});p?(s.tableInfos.list=p.list||[],s.tableInfos.total=p.total):(s.tableInfos.list=[],s.tableInfos.total=0),w.value.start()};A.methods.refreshListPage=()=>{c()};const F=()=>{y.value.query({page:1})},Z=()=>{y.value.query()},G=o=>{s.selectedRow=o,S.value.show({width:"600px",confirmText:s.selectedRow.uuid})},J=async(o={})=>{const[i,p]=await V.delete({...o,showSuccess:!0,url:`/api/mgr/annotation/audio/task/${s.selectedRow.uuid}/delete`});p&&(S.value.hide(),c())},O=o=>({pending:"undo",processing:"doing",completed:"done",abandoned:"status-gray",cleaned:"status-gray",canceled:"status-gray"})[o],X=o=>{s.selectedRow=o,P.value.show({width:"600px",confirmText:s.selectedRow.uuid})},ee=async(o={})=>{const[i,p]=await V.put({...o,showSuccess:!0,url:`/api/mgr/annotation/audio/task/${s.selectedRow.uuid}/cancel`});p&&(P.value.hide(),c())},te=()=>{f.value.show({title:"创建音频标注任务",operateType:"add"})};return ge(()=>{c()}),(o,i)=>{const p=h("Select"),L=h("refresh-button"),I=h("ButtonsInForm"),b=h("el-table-column"),M=h("el-popover"),ae=h("ButtonsInTable"),ne=h("TableWithPager"),le=he("copy");return Y(),W(ye,null,[t(oe,{title:q.value.title,breadcrumbs:d.value},null,8,["title","breadcrumbs"]),t(se,null,{default:n(()=>[t(Pe,null,{default:n(()=>[t(N,{cols:"12",class:"flex justify-between"},{default:n(()=>[e("div",Ye,[t(p,{onChange:F,label:"请选择标注状态",mapDictionary:{code:"local_mark_status"},modelValue:m(R).status,"onUpdate:modelValue":i[0]||(i[0]=a=>m(R).status=a)},null,8,["modelValue"]),t(p,{class:"ml-3",modelValue:m(R).language,"onUpdate:modelValue":i[1]||(i[1]=a=>m(R).language=a),label:o.$t("language"),mapDictionary:{code:"audio_tagged_lang",i18nKey:"markLanguage"},onChange:F},null,8,["modelValue","label"])]),t(I,null,{default:n(()=>[t(Se,{color:"primary",onClick:i[2]||(i[2]=a=>te())},{default:n(()=>[l("创建音频标注任务")]),_:1}),t(L,{ref_key:"refreshButtonRef",ref:w,onRefresh:Z},null,512)]),_:1})]),_:1}),t(N,{cols:"12"},{default:n(()=>[t(ne,{onQuery:c,ref_key:"refTableWithPager",ref:y,infos:s.tableInfos},{default:n(()=>[t(b,{label:"任务名称",prop:"name",width:"200px",fixed:"left"}),t(b,{label:"数据序列",prop:"dataSequence",width:"100px"}),t(b,{width:"120px"},{header:n(()=>[l("完成进度")]),default:n(({row:a})=>[t(M,{placement:"right"},{reference:n(()=>[l(r(a.completed)+" / "+r(a.total-a.completed-a.abandoned)+" / "+r(a.abandoned),1)]),default:n(()=>[e("div",Me,[e("div",null,[l(" 已完成："),e("span",je,r(a.completed),1)]),e("div",null,[l(" 未完成："),e("span",We,r(a.total-a.completed-a.abandoned),1)]),e("div",null,[l(" 丢弃："),e("span",Qe,r(a.abandoned),1)])])]),_:2},1024)]),_:1}),t(b,{label:"状态",width:"120px"},{default:n(({row:a})=>[t(De,{label:"",size:"small",class:be(O(a.status))},{default:n(()=>[l(r(m($)([["local_mark_status",a.status]])),1)]),_:2},1032,["class"])]),_:1}),t(b,{label:"完成时间","min-width":"180px"},{default:n(({row:a})=>[l(r(m(Q).dateFormat(a.completedAt,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),t(b,{label:"创建时间","min-width":"180px"},{default:n(({row:a})=>[l(r(m(Q).dateFormat(a.createdAt,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),t(b,{label:"训练集数量","min-width":"120px"},{default:n(({row:a})=>[t(M,{placement:"right"},{reference:n(()=>[l(r(a.testTotal)+" / "+r(a.trainTotal),1)]),default:n(()=>[e("div",ze,[e("div",null,[l(" 测试集数量："),e("span",He,r(a.testTotal),1)]),e("div",null,[l(" 训练集数量："),e("span",Ne,r(a.trainTotal),1)])])]),_:2},1024)]),_:1}),t(b,{label:"负责人",width:"200px"},{default:n(({row:a})=>[xe((Y(),W("span",null,[l(r(a.principal),1)])),[[le,a.principal]])]),_:1}),t(b,{label:"操作","min-width":"120px",fixed:"right"},{default:n(({row:a})=>[t(ae,{buttons:B(a)},null,8,["buttons"])]),_:1})]),_:1},8,["infos"])]),_:1})]),_:1})]),_:1}),t(Ue,{ref_key:"refPaneAudioAnnotationTask",ref:f,onSubmit:F},null,512),t(z,{ref_key:"refConfirmDelete",ref:S,onSubmit:J},{text:n(()=>[l(" 这是进行一项操作时必须了解的重要信息"),Ee,l(" 此操作将会"),Ke,l("在进行的标注任务"),Ze,l(" 数据集ID："),e("span",Ge,r(s.selectedRow.uuid),1),Je,l("你还要继续吗？ ")]),_:1},512),t(z,{ref_key:"refConfirmCancel",ref:P,onSubmit:ee},{text:n(()=>[l(" 这是进行一项操作时必须了解的重要信息"),Oe,l(" 此操作将会"),Xe,l("尚未开始的标注任务"),et,l(" 数据集ID："),e("span",tt,r(s.selectedRow.uuid),1),at,l("你还要继续吗？ ")]),_:1},512),t(H,{ref_key:"refConfirmSplit",ref:D,onSubmit:g},{text:n(()=>[nt,e("div",null,[e("div",lt,[e("div",null,[l(" 训练集 "),e("span",ot,r(s.selectedRow.testPercent)+"%",1)]),e("div",null,[l(" 测试集 "),e("span",st,r(100-s.selectedRow.testPercent)+"%",1)])]),t(Te,{color:"primary",step:"1",modelValue:s.selectedRow.testPercent,"onUpdate:modelValue":i[3]||(i[3]=a=>s.selectedRow.testPercent=a)},null,8,["modelValue"])])]),_:1},512),t(H,{ref_key:"refConfirmDownload",ref:k,onSubmit:v},{text:n(()=>[t(Ce,null,{default:n(()=>[l(" 该操作将直接生成训练数据集，导出的数据将会以jsonl的格式导出。 ")]),_:1})]),_:1},512)],64)}}});export{vt as default};
