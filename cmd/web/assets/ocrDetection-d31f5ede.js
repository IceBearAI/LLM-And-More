import{_ as A}from"./BaseBreadcrumb.vue_vue_type_style_index_0_lang-6c45f033.js";import{_ as E}from"./UiParentCard.vue_vue_type_script_setup_true_lang-80e0344c.js";import{_ as H}from"./ConfirmByClick.vue_vue_type_style_index_0_lang-58ada805.js";import{_ as Z}from"./DialogLog.vue_vue_type_style_index_0_lang-ab83ca7d.js";import{C as G}from"./CustomUpload-f9b62875.js";import{d as Y,x,r as c,U as u,k as n,l as g,m as l,W as b,j as e,_ as y,$ as R,Y as J,b9 as M,am as K,an as X,o as ee,Z as U,O as te,n as D,bi as O,bj as le,F as W,bg as oe}from"./utils-5e900427.js";import{ad as ae,d as ie,V as j,a4 as se,_ as ne,I as re}from"./index-81f01cfc.js";import{V as de}from"./VSwitch-b8e61b93.js";import{V as pe}from"./VForm-b09769b4.js";import{V as ce}from"./VRow-1ab8c2e6.js";import{V as $}from"./VCol-8780c689.js";import"./Confirm-298ef43f.js";import"./TextLog-9f48bacb.js";const I=V=>(K("data-v-a1e9b43f"),V=V(),X(),V),ue={class:"mx-auto mt-3",style:{width:"540px"}},me=I(()=>b("label",{class:"required"},"文件类型",-1)),fe=I(()=>b("label",{class:"required"},"文件上传",-1)),_e=I(()=>b("label",null,"生成可视化图片",-1)),ye=I(()=>b("label",null,"pdf页数",-1)),ge=Y({__name:"CreateDetectionPane",emits:["submit"],setup(V,{expose:S,emit:P}){const T={image:["image/jpeg","image/png"],pdf:["application/pdf"]},m=P,C=x({operateType:"add"}),t=x({fileType:null,file:null,viewImage:!0,pageNum:0}),p=c(),h=c(),k=x({fileType:[i=>!!i||"请选择文件类型"],file:[i=>!!i||"请上传样本文件"]}),B=i=>{t.file=i},F=()=>{t.file=null},N=async({valid:i,showLoading:a})=>{if(i){(t.fileType!=="pdf"||!t.pageNum)&&(t.pageNum=0);const[v,w]=await M.upload({timeout:30*60*1e3,showLoading:a,showSuccess:!0,url:"/ocr/recognition",data:t});w&&(p.value.hide(),m("submit"))}};return S({show({title:i,operateType:a,infos:v}){p.value.show({title:i,refForm:h}),C.operateType=a,C.operateType==="add"&&(t.file=null,t.fileType=null,t.viewImage=!0,t.pageNum=0)}}),(i,a)=>{const v=u("Select"),w=u("Pane");return n(),g(w,{ref_key:"refPane",ref:p,onSubmit:N},{default:l(()=>[b("div",ue,[e(pe,{ref_key:"refForm",ref:h,class:"my-form"},{default:l(()=>[e(v,{placeholder:"请选择文件类型",rules:k.fileType,mapDictionary:{code:"ocr_file_type"},modelValue:t.fileType,"onUpdate:modelValue":a[0]||(a[0]=r=>t.fileType=r),clearable:!1},{prepend:l(()=>[me]),_:1},8,["rules","modelValue"]),e(ae,{rules:k.file,modelValue:t.file,"onUpdate:modelValue":a[1]||(a[1]=r=>t.file=r),"hide-details":"auto"},{prepend:l(()=>[fe]),default:l(()=>[t.file?(n(),g(ie,{key:0,closable:"",color:"info","onClick:close":F},{default:l(()=>[y(R(t.file.name),1)]),_:1})):(n(),g(G,{key:1,"file-type":T[t.fileType],onBeforeUpload:B,"auto-upload":!1,"file-size":100,disabled:!t.fileType},{trigger:l(()=>[e(j,{color:"info",variant:"outlined",disabled:!t.fileType},{default:l(()=>[y("选择文件")]),_:1},8,["disabled"])]),_:1},8,["file-type","disabled"]))]),_:1},8,["rules","modelValue"]),e(de,{modelValue:t.viewImage,"onUpdate:modelValue":a[2]||(a[2]=r=>t.viewImage=r),color:"primary","hide-details":"auto"},{prepend:l(()=>[_e]),_:1},8,["modelValue"]),t.fileType==="pdf"?(n(),g(se,{key:0,type:"number",placeholder:"请输入pdf页数","hide-details":"auto",modelValue:t.pageNum,"onUpdate:modelValue":a[3]||(a[3]=r=>t.pageNum=r),modelModifiers:{number:!0}},{prepend:l(()=>[ye]),_:1},8,["modelValue"])):J("",!0)]),_:1},512)])]),_:1},512)}}});const be=ne(ge,[["__scopeId","data-v-a1e9b43f"]]),he=["src"],ve=["href"],we=["onClick"],Re=Y({__name:"ocrDetection",setup(V){const S=c({title:"OCR检测识别"}),P=c([{text:"OCR服务",disabled:!1,href:"#"},{text:"OCR检测识别",disabled:!0,href:"#"}]),T=x({fileType:null}),m=x({list:[],total:0}),C=c(),t=c(),p=c(),h=c(),k=x({id:""}),B=s=>{C.value.show({content:s,title:"文本内容"})},F=s=>{let f=[];return f.push({text:"删除",color:"error",click(){N(s)}}),f},N=s=>{k.id=s.id,h.value.show({width:"450px"})},i=async(s={})=>{const[f,_]=await M.delete({...s,showSuccess:!0,url:`/ocr/recognition/${k.id}`});_&&(h.value.hide(),w())},a=async(s={})=>{const[f,_]=await M.get({url:"/ocr/list",showLoading:p.value.el,data:{...T,...s}});_?(m.list=_.list||[],m.total=_.total):(m.list=[],m.total=0)},v=()=>{p.value.query({page:1})},w=()=>{p.value.query()},r=()=>{t.value.show({title:"创建",operateType:"add"})};return ee(()=>{w()}),(s,f)=>{const _=u("Select"),q=u("ButtonsInForm"),d=u("el-table-column"),z=u("el-image"),L=u("ButtonsInTable"),Q=u("TableWithPager");return n(),U(W,null,[e(A,{title:S.value.title,breadcrumbs:P.value},null,8,["title","breadcrumbs"]),e(E,null,{default:l(()=>[e(ce,null,{default:l(()=>[e($,{cols:"12",lg:"3",md:"4",sm:"6"},{default:l(()=>[e(_,{modelValue:T.fileType,"onUpdate:modelValue":f[0]||(f[0]=o=>T.fileType=o),mapDictionary:{code:"ocr_file_type"},label:"请选择文件类型","hide-details":"",onChange:v},null,8,["modelValue"])]),_:1}),e($,{cols:"12",lg:"3",md:"4",sm:"6"},{default:l(()=>[e(q,null,{default:l(()=>[e(j,{color:"primary",onClick:r},{default:l(()=>[y("创建")]),_:1})]),_:1})]),_:1}),e($,{cols:"12"},{default:l(()=>[e(Q,{onQuery:a,ref_key:"tableWithPagerRef",ref:p,infos:m},{default:l(()=>[e(d,{label:"文件","min-width":"150px"},{default:l(({row:o})=>[o.fileType==="image"?(n(),g(re,{key:0,size:"80",rounded:"md"},{default:l(()=>[b("img",{src:o.inputS3Url,alt:"图片",height:"80"},null,8,he)]),_:2},1024)):(n(),U("a",{key:1,class:"link",href:o.inputS3Url,target:"_blank"},[(n(),g(te(D(O).fileTypes[o.fileType].icon),{class:"align-top"}))],8,ve))]),_:1}),e(d,{label:"文件类型","min-width":"100px"},{default:l(({row:o})=>[y(R(D(O).fileTypes[o.fileType].text),1)]),_:1}),e(d,{label:"文本内容","min-width":"100px"},{default:l(({row:o})=>[b("a",{class:"link",href:"javascript: void(0)",onClick:xe=>B(o.text)},[e(D(le),{class:"align-top",size:20})],8,we)]),_:1}),e(d,{label:"可视化图片","min-width":"150px"},{default:l(({row:o})=>[o.viewImgs.length===0?(n(),U(W,{key:0},[y(" -- ")],64)):(n(),g(z,{key:1,style:{width:"80px",height:"80px"},src:o.viewImgs[0],"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":o.viewImgs,"initial-index":4,"preview-teleported":!0,fit:"cover"},null,8,["src","preview-src-list"]))]),_:1}),e(d,{label:"页数",prop:"pageNum","min-width":"80px"}),e(d,{label:"接口耗时",prop:"duration","min-width":"100px"}),e(d,{label:"操作人",prop:"operatorEmail","min-width":"150px","show-overflow-tooltip":""}),e(d,{label:"创建时间","min-width":"165px"},{default:l(({row:o})=>[y(R(D(oe).dateFormat(o.createdAt,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),e(d,{label:"操作",width:"80px",fixed:"right"},{default:l(({row:o})=>[e(L,{buttons:F(o),onlyOne:""},null,8,["buttons"])]),_:1})]),_:1},8,["infos"])]),_:1})]),_:1})]),_:1}),e(Z,{ref_key:"refDialogLog",ref:C},null,512),e(H,{ref_key:"refConfirmDelete",ref:h,onSubmit:i},{text:l(()=>[y("确认要删除这条ocr记录吗？")]),_:1},512),e(be,{ref_key:"createDetectionPaneRef",ref:t,onSubmit:v},null,512)],64)}}});export{Re as default};
