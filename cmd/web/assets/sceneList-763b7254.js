import{x as N,z as Y,r as v,aC as R,a8 as M,U as I,k as V,l as C,m as t,W as m,j as e,n as u,_ as n,al as O,am as Z,av as P,o as G,S as J,Z as g,aA as X,$ as c,F as j,a5 as ee,Y as te,Q as L,aB as ae}from"./utils-1e76329d.js";import{_ as le}from"./BaseBreadcrumb.vue_vue_type_style_index_0_lang-dcfac41f.js";import{_ as oe}from"./UiParentCard.vue_vue_type_script_setup_true_lang-df0964eb.js";import{A as se}from"./AlertBlock-b1c42139.js";import"./ChipBoolean-95ca316e.js";import{_ as B}from"./Explain.vue_vue_type_style_index_0_lang-23985bda.js";import{_ as ne,a5 as F,V as re,I as ie,i as de,f as ue,K as me}from"./index-9385247e.js";import{V as ce}from"./VForm-acd39db9.js";import{V as pe}from"./VTextarea-afb7bb72.js";import{_ as fe}from"./ConfirmByInput.vue_vue_type_style_index_0_lang-d77b4736.js";import{V as T}from"./VCol-1b05b78c.js";import{V as W}from"./VRow-7ad57f36.js";import{V as _e}from"./VSheet-607b9100.js";import"./IconInfoCircle-50c4da76.js";import"./VAlert-99829bac.js";import"./Confirm-f04a0e9f.js";const E=k=>(O("data-v-79c06046"),k=k(),Z(),k),be={class:"mx-auto mt-10",style:{width:"500px"}},he=E(()=>m("label",{class:"required"},"别名",-1)),ye={class:"required"},Ve={class:"required"},ve={class:"required"},xe=E(()=>m("label",null,"备注",-1)),we={__name:"PaneScene",emits:["submit"],setup(k,{expose:i,emit:A}){const d=N({operateType:"",disabledField:!1,maxTokens:4096,formData:{name:"",alias:"",quota:"",modelId:[],email:"",projectName:"",serviceName:"",modelId:"",remark:""}}),{formData:r}=Y(d),x=A,_=v(),D=v(),w=N({name:[l=>!!l||"请输入名称"],alias:[l=>!!l||"请输入别名"],modelId:[l=>l&&l.length>0?!0:"请选择模型"],quota:[l=>!!l||"请输入配额"],email:[l=>R.isEmail({value:l,required:!0})]}),q=async(l={})=>{const[s,p]=await P.post({...l,showSuccess:!0,url:"/api/channels",data:{...d.formData}});p&&(_.value.hide(),x("submit"))},$=async(l={})=>{const[s,p]=await P.put({...l,showSuccess:!0,url:`/api/channels/${d.formData.id}`,data:{...d.formData}});p&&(_.value.hide(),x("submit"))},h=({valid:l,showLoading:s})=>{l&&(d.operateType=="add"?q({showLoading:s}):$({showLoading:s}))};return i({show({title:l,infos:s={id:"",name:"",alias:"",quota:"",email:"",projectName:"",serviceName:"",remark:"",modelId:[]},operateType:p}){_.value.show({title:l,refForm:D}),d.formData=M.pick(M.cloneDeep(s),["id","name","alias","quota","email","projectName","serviceName","remark"]),d.operateType=p,p=="add"?d.disabledField=!1:(d.disabledField=!0,d.formData.modelId=s.model.list.map(S=>S.id))}}),(l,s)=>{const p=I("Select"),S=I("Pane");return V(),C(S,{ref_key:"refPane",ref:_,class:"",onSubmit:h},{default:t(()=>[m("div",be,[e(ce,{ref_key:"refForm",ref:D,class:"my-form"},{default:t(()=>[e(F,{density:"compact",variant:"outlined",type:"text",placeholder:"请输入别名","hide-details":"auto",rules:w.alias,modelValue:u(r).alias,"onUpdate:modelValue":s[0]||(s[0]=o=>u(r).alias=o),clearable:""},{prepend:t(()=>[he]),_:1},8,["rules","modelValue"]),e(F,{density:"compact",variant:"outlined",type:"number",placeholder:"请输入配额","hide-details":"auto",rules:w.quota,modelValue:u(r).quota,"onUpdate:modelValue":s[1]||(s[1]=o=>u(r).quota=o),modelModifiers:{number:!0},clearable:""},{prepend:t(()=>[m("label",ye,[n("配额 "),e(B,null,{default:t(()=>[n("每天最多请求的次数")]),_:1})])]),_:1},8,["rules","modelValue"]),e(p,{rules:w.modelId,modelValue:u(r).modelId,"onUpdate:modelValue":s[2]||(s[2]=o=>u(r).modelId=o),mapAPI:{url:"/api/channels/models",data:{pageSize:-1},labelField:"modelName",valueField:"id"},"hide-details":"auto",multiple:""},{prepend:t(()=>[m("label",Ve,[n("支持模型 "),e(B,null,{default:t(()=>[n("指该应用场景可以使用的模型")]),_:1})])]),_:1},8,["rules","modelValue"]),e(F,{density:"compact",variant:"outlined",type:"text",placeholder:"请输入负责人邮箱","hide-details":"auto",clearable:"",modelValue:u(r).email,"onUpdate:modelValue":s[3]||(s[3]=o=>u(r).email=o),rules:w.email},{prepend:t(()=>[m("label",ve,[n("邮箱 "),e(B,null,{default:t(()=>[n("该应用场景的负责人邮箱")]),_:1})])]),_:1},8,["modelValue","rules"]),e(pe,{modelValue:u(r).remark,"onUpdate:modelValue":s[4]||(s[4]=o=>u(r).remark=o),modelModifiers:{trim:!0},placeholder:"请输入"},{prepend:t(()=>[xe]),_:1},8,["modelValue"])]),_:1},512)])]),_:1},512)}}},Ie=ne(we,[["__scopeId","data-v-79c06046"]]),ke={style:{width:"300px"}},Se={pointer:""},De={class:"text-primary font-weight-black"},ge=m("br",null,null,-1),Te=m("br",null,null,-1),Qe={__name:"sceneList",setup(k){const i=N({style:{},formData:{name:""},selectedInfo:{},tableInfos:{list:[],total:""}}),{style:A,formData:d}=Y(i),r=v(),x=v(),_=v(),D=v({title:"场景列表"}),w=v([{text:"场景管理",disabled:!1,href:"#"},{text:"场景列表",disabled:!0,href:"#"}]),q=o=>{let b=[];return b.push({text:"删除",color:"error",click(){l(o)}}),b.push({text:"编辑",color:"info",click(){S(o)}}),b},$=async(o={})=>{const[b,y]=await P.get({url:"/api/channels",showLoading:_.value.el,data:{...i.formData,...o}});y?(i.tableInfos.list=y.list,i.tableInfos.total=y.total):(i.tableInfos.list=[],i.tableInfos.total=0)},h=()=>{_.value.query({page:1})},l=o=>{i.selectedInfo=o,x.value.show({width:"400px",confirmText:i.selectedInfo.alias})},s=async(o={})=>{const[b,y]=await P.delete({...o,showSuccess:!0,url:`/api/channels/${i.selectedInfo.id}`});y&&(x.value.hide(),h())},p=()=>{r.value.show({title:"添加场景",operateType:"add"})},S=o=>{r.value.show({title:"编辑场景",infos:o,operateType:"edit"})};return G(()=>{h()}),(o,b)=>{const y=I("ButtonsInForm"),f=I("el-table-column"),Q=I("ButtonsInTable"),z=I("TableWithPager"),K=J("copy");return V(),g(j,null,[e(le,{title:D.value.title,breadcrumbs:w.value},null,8,["title","breadcrumbs"]),e(W,null,{default:t(()=>[e(T,null,{default:t(()=>[e(oe,null,{default:t(()=>[e(W,null,{default:t(()=>[e(T,{cols:"12",class:"d-flex justify-space-between align-center"},{default:t(()=>[m("div",ke,[e(F,{density:"compact",modelValue:u(d).name,"onUpdate:modelValue":b[0]||(b[0]=a=>u(d).name=a),label:"搜索场景名称","hide-details":"",clearable:"",variant:"outlined",onKeyup:X(h,["enter"]),"onClick:clear":h},null,8,["modelValue","onKeyup"])]),e(y,null,{default:t(()=>[e(re,{color:"primary",onClick:p},{default:t(()=>[n("添加场景")]),_:1})]),_:1})]),_:1}),e(T,{cols:"12"},{default:t(()=>[e(se,null,{default:t(()=>[n(" 修改之后将实时生效，请谨慎操作！ ")]),_:1})]),_:1}),e(T,{cols:"12"},{default:t(()=>[e(z,{onQuery:$,ref_key:"refTableWithPager",ref:_,infos:i.tableInfos},{default:t(()=>[e(f,{label:"模型数量","min-width":"100px"},{default:t(({row:a})=>[m("span",Se,[n(c(a.model.num)+" ",1),a.model.num>0?(V(),C(me,{key:0,"open-on-hover":"",location:"end",activator:"parent"},{default:t(()=>[e(_e,{rounded:"md",width:"200",elevation:"10"},{default:t(()=>[e(ie,{class:"px-4"},{default:t(()=>[(V(!0),g(j,null,ee(a.model.list,(H,U)=>(V(),C(de,{key:U},{default:t(()=>[e(ue,{class:"text-subtitle-1 font-weight-regular"},{default:t(()=>[n(c(U+1)+". "+c(H.modelName),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)):te("",!0)])]),_:1}),e(f,{label:"别名",width:"150px"},{default:t(({row:a})=>[m("span",null,c(a.alias),1)]),_:1}),e(f,{label:"配额","min-width":"100px"},{default:t(({row:a})=>[n(c(a.quota),1)]),_:1}),e(f,{label:"ApiKey","min-width":"120px","show-overflow-tooltip":""},{default:t(({row:a})=>[L((V(),g("span",null,[n(c(a.apiKey),1)])),[[K,a.apiKey]])]),_:1}),e(f,{label:"备注","min-width":"200px"},{default:t(({row:a})=>[n(c(a.remark),1)]),_:1}),e(f,{label:"更新时间","min-width":"200px"},{default:t(({row:a})=>[n(c(u(ae).dateFormat(a.updatedAt,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),e(f,{label:"最后操作人","min-width":"200px","show-overflow-tooltip":""},{default:t(({row:a})=>[n(c(a.lastOperator),1)]),_:1}),e(f,{label:"负责人","min-width":"120px","show-overflow-tooltip":""},{default:t(({row:a})=>[L((V(),g("span",null,[n(c(a.email),1)])),[[K,a.email]])]),_:1}),e(f,{label:"操作","min-width":"120px",fixed:"right"},{default:t(({row:a})=>[e(Q,{buttons:q(a)},null,8,["buttons"])]),_:1})]),_:1},8,["infos"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(Ie,{ref_key:"refPaneScene",ref:r,onSubmit:h},null,512),e(fe,{ref_key:"refConfirmDelete",ref:x,onSubmit:s},{text:t(()=>[n(" 您将要删除 "),m("span",De,c(i.selectedInfo.alias),1),n(" 场景，删除之后，"),ge,n(" 若有使用该场景的应用场景都将取消授权。"),Te,n(" 确定要继续吗？ ")]),_:1},512)],64)}}};export{Qe as default};
