import{d as me,at as ge,r as m,U as H,k as c,l as b,m as e,j as t,W as n,$ as V,_ as i,n as s,aB as U,av as Q,x as W,z as be,w as Ve,a8 as de,V as ne,Q as pe,a3 as fe,a0 as E,Z as T,Y as R,F as j,aF as ke,al as _e,am as ve,ac as xe,o as we,aA as Ie,a5 as ie,aD as re,O as $e}from"./utils-5a8267ef.js";import{_ as De}from"./BaseBreadcrumb.vue_vue_type_style_index_0_lang-cf0aeddf.js";import{_ as te}from"./UiParentCard.vue_vue_type_script_setup_true_lang-3c4d2264.js";import{_ as Fe}from"./ConfirmByClick.vue_vue_type_style_index_0_lang-e4b43f61.js";import{c as Te,ae as D,J as ae,V as M,_ as he,af as ue,M as le,ac as Ce,a5 as J,a0 as Ue,at as Pe,K as Me,I as Se,i as Le,f as Ae,au as Ne}from"./index-bdfe8eaa.js";import{V as P}from"./VCol-9b7c01c8.js";import{V as oe}from"./VRow-522ff18f.js";import{_ as qe}from"./DialogLog.vue_vue_type_style_index_0_lang-05451b0f.js";import{_ as ze}from"./TagCorner.vue_vue_type_style_index_0_lang-ed62acf2.js";import{_ as X}from"./Explain.vue_vue_type_style_index_0_lang-5ba40fa4.js";import{_ as ee}from"./UploadFile.vue_vue_type_script_setup_true_lang-6c5ac9a3.js";import{V as ce}from"./VAlert-6bf79ec1.js";import{V as Ye}from"./VTextarea-e29a39b5.js";import{V as Be}from"./VForm-d4c8b802.js";import{I as Ee,a as Re,b as je}from"./IconEye-6f191ae8.js";import"./Confirm-f9ddfe55.js";import"./TextLog-eed03216.js";import"./IconInfoCircle-2525280f.js";import"./VFileInput-ae8a1d17.js";var He=Te("markdown","IconMarkdown",[["path",{d:"M3 5m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M7 15v-6l2 2l2 -2v6",key:"svg-1"}],["path",{d:"M14 13l2 2l2 -2m-2 2v-6",key:"svg-2"}]]);const Qe={style:{"aspect-ratio":"1"}},Ke=["src","poster"],Oe={class:"my-form"},Ze={class:"text-h3 my-2"},Je=n("label",null,"头像：",-1),We={class:"d-flex align-center"},Ge=["src"],Xe=n("label",null,"时长：",-1),et=n("label",null,"大小：",-1),tt=n("label",null,"创建时间：",-1),at=n("label",null,"更新时间：",-1),lt=n("label",null,"备注：",-1),ot=me({__name:"Detail",setup(k,{expose:L}){const A=ge(),C=m(),r=m(""),l=m({digitalHumanPerson:{},voiceSpeak:{}}),_=async()=>{let[w,v]=await Q.get({url:`/api/digitalhuman/synthesis/${r.value}/view`});v&&(l.value=v||{})},u=()=>{A.push("/digital-human/edit")};return L({show({title:w,uuid:v}){r.value=v,C.value.show({width:1e3,showActions:!1,title:w}),_()}}),(w,v)=>{const I=H("Pane");return c(),b(I,{ref_key:"refPane",ref:C},{default:e(()=>[t(oe,null,{default:e(()=>[t(P,{cols:"12",md:"6"},{default:e(()=>[t(te,null,{default:e(()=>[n("div",Qe,[n("video",{class:"w-100 h-100",src:(l.value.video,l.value.video),controls:"",poster:l.value.digitalHumanPerson.cover},null,8,Ke)])]),_:1})]),_:1}),t(P,{cols:"12",md:"6"},{default:e(()=>[t(te,null,{default:e(()=>[n("div",Oe,[n("h3",Ze,V(l.value.cname),1),t(D,{"hide-details":""},{prepend:e(()=>[Je]),default:e(()=>[n("div",We,[t(ae,{size:"80",class:"mr-2",rounded:"0"},{default:e(()=>[n("img",{src:l.value.cover,class:"w-100"},null,8,Ge)]),_:1})])]),_:1}),t(D,{"hide-details":""},{prepend:e(()=>[Xe]),default:e(()=>[i(" 15s ")]),_:1}),t(D,{"hide-details":""},{prepend:e(()=>[et]),default:e(()=>[i(" 1.0 ")]),_:1}),t(D,{"hide-details":""},{prepend:e(()=>[tt]),default:e(()=>[i(" "+V(s(U).dateFormat(l.value.createdAt,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),t(D,{"hide-details":""},{prepend:e(()=>[at]),default:e(()=>[i(" "+V(s(U).dateFormat(l.value.updatedAt,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),t(D,{"hide-details":""},{prepend:e(()=>[lt]),default:e(()=>[i(" "+V(l.value.remark),1)]),_:1}),t(M,{flat:"",color:"secondary",onClick:u},{default:e(()=>[i("去合成视频 >")]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},512)}}});const S=k=>(_e("data-v-92a2d7ce"),k=k(),ve(),k),st={class:"mx-auto mt-10",style:{width:"500px"}},dt=S(()=>n("label",{class:"required"},"预览图片",-1)),nt=S(()=>n("label",{class:"required"},"资源类型 ",-1)),it=["src"],rt={class:"required"},ut={key:1,style:{"margin-left":"24%",width:"75%"}},ct=S(()=>n("label",{class:"required"},"姓名 ",-1)),mt=S(()=>n("label",{class:"required"},"标识 ",-1)),pt=S(()=>n("label",{class:"required"},"性别 ",-1)),ft={class:"required"},_t={class:"required"},vt={class:"required"},ht=S(()=>n("label",null,"备注",-1)),yt={__name:"PaneModelEstimate",props:{modelName:String},emits:["submit"],setup(k,{expose:L,emit:A}){const C=k,r=W({operateType:"",maxTokens:4096,file:"",formData:{mediaType:"",coverFileId:"",videoFileId:"",name:"",cname:"",gender:null,resolution:"",remark:"",posture:"",pads:"0,0,0,0"},upLoading:!1}),{formData:l}=be(r),_=m(null),u=m(null),w=A,v=m(),I=m(),N=m(),G=/^[a-zA-Z0-9_\u4e00-\u9fa5-]+$/,x=W({coverFileId:[o=>!!o||"请上传预览图片"],videoFileId:[o=>o&&o.length>0?!0:r.formData.mediaType=="image"?"请上传图片":r.formData.mediaType=="video"?"请上传视频文件":"请上传"],resolution:[o=>!!o||"请选择分辨率"],posture:[o=>!!o||"请选择姿势"],mediaType:[o=>!!o||"请选择资源类型"],gender:[o=>!!o||"请选择性别"],name:[o=>o&&o.length>0?(o.length>1||o.length<=30)&&G.test(o)?!0:"请输入正确标识：中文、数字、字母、-、_":"请输入标识"],cname:[o=>o&&o.length>0&&o.length<30?!0:"请输入姓名"],pads:[o=>{if(o&&o.length>0){o=o.split(",");let a=/^(?!0)\d{1,4}$|^0$/,p=o.every(B=>a.test(B));return o.length==4&&p?!0:"请输入正整数边框充填值，比如:top,bottom,left,right"}else return"请输入边框充填"}]});Ve(()=>r.formData.mediaType,()=>{var o;ke.scaleIn((o=N.value)==null?void 0:o.$el)});const q=async(o={})=>{r.formData={...r.formData};const[a,p]=await Q.post({...o,showSuccess:!0,url:"/api/digitalhuman/person/create",data:{...r.formData,modelName:C.modelName}});p&&(v.value.hide(),w("submit"))},z=async(o={})=>{const[a,p]=await Q.put({...o,showSuccess:!0,url:`/api/digitalhuman/person/${r.formData.name}/update`,data:{...r.formData}});p&&(v.value.hide(),w("submit"))},O=({valid:o,showLoading:a})=>{o&&(r.operateType=="add"?q({showLoading:a}):z({showLoading:a}))},h=o=>{let{operateType:a}=r;if(a=="view")return!0;if(a=="edit")return!!["mediaType","name"].includes(o);if(a=="add")return!1};L({show({title:o,infos:a={coverFileId:"",videoFileId:"",name:"",cname:"",mediaType:null,gender:null,resolution:null,posture:null,remark:"",pads:"0,0,0,0"},operateType:p}){v.value.show({title:o,refForm:I,showActions:p!="view"}),r.formData=de.pick(de.cloneDeep(a),["mediaType","videoFileId","name","cname","gender","resolution","remark","posture","pads","coverFileId"]),console.log("infos",a.mediaType),r.operateType=p,p=="add"?(_.value=null,u.value=null,r.upLoading=!1):(_.value={s3Url:a.cover},u.value={s3Url:a.video})}});const Y=()=>{l.value.coverFileId="",_.value=null},Z=()=>{l.value.videoFileId="",u.value=null};return(o,a)=>{const p=H("Select"),B=H("Pane");return c(),b(B,{ref_key:"refPane",ref:v,class:"",onSubmit:O},{default:e(()=>[n("div",st,[t(Be,{ref_key:"refForm",ref:I,class:"my-form"},{default:e(()=>[t(D,{rules:x.coverFileId,modelValue:s(l).coverFileId,"onUpdate:modelValue":a[2]||(a[2]=d=>s(l).coverFileId=d),"hide-details":"auto",style:{position:"relative"},disabled:h("avatar")},{prepend:e(()=>[dt]),default:e(()=>[_.value&&_.value.s3Url?(c(),b(ce,{key:0,color:"borderColor",variant:"text",density:"compact",style:{flex:"none"}},ne({default:e(()=>[t(ae,{size:"80",rounded:"0"},{default:e(()=>[t(le,{transition:!1,src:_.value.s3Url,alt:"上传成功后的头像",cover:""},null,8,["src"])]),_:1})]),_:2},[h("avatar")?void 0:{name:"close",fn:e(()=>[t(ue,{class:"text-24 opacity-50 cursor-pointer",color:"textPrimary",onClick:Y},{default:e(()=>[i("mdi-close-circle")]),_:1})]),key:"0"}]),1024)):(c(),b(M,{key:1,color:"info",variant:"outlined","prepend-icon":"mdi-plus",stacked:""},{default:e(()=>[i("上传 "),t(ee,{accept:"image/*",modelValue:s(l).coverFileId,"onUpdate:modelValue":a[0]||(a[0]=d=>s(l).coverFileId=d),infos:_.value,"onUpdate:infos":a[1]||(a[1]=d=>_.value=d),style:{width:"114px",height:"102px",position:"absolute",top:"0",left:"-55%",opacity:"0"}},null,8,["modelValue","infos"])]),_:1}))]),_:1},8,["rules","modelValue","disabled"]),t(p,{density:"compact",variant:"outlined",placeholder:"请选择资源类型","hide-details":"auto",rules:x.mediaType,modelValue:s(l).mediaType,"onUpdate:modelValue":a[3]||(a[3]=d=>s(l).mediaType=d),clearable2:!1,mapDictionary:{code:"digitalhuman_media_type"},disabled:h("mediaType")},{prepend:e(()=>[nt]),_:1},8,["rules","modelValue","disabled"]),s(l).mediaType?pe((c(),b(D,{key:0,ref_key:"refVideoFileId",ref:N,rules:x.videoFileId,modelValue:s(l).videoFileId,"onUpdate:modelValue":a[9]||(a[9]=d=>s(l).videoFileId=d),"hide-details":"auto",style:{position:"relative",width:"100%"},disabled:h("video")},{prepend:e(()=>[n("label",rt,V(s(l).mediaType=="video"?"视频文件":"图片"),1)]),default:e(()=>[u.value&&u.value.s3Url?(c(),b(ce,{key:0,color:"borderColor",variant:"text",density:"compact",class:E(["flex-none max-h-[40vh]",{"w-full":s(l).mediaType=="video"}]),style1:"flex: none; width: 94%; max-height: 40vh"},ne({default:e(()=>[s(l).mediaType=="video"?(c(),T("video",{key:0,src:u.value.s3Url,controls:"",style:{height:"100%",width:"100%"}},null,8,it)):s(l).mediaType=="image"?(c(),b(ae,{key:1,size:"80",rounded:"0"},{default:e(()=>[t(le,{transition:!1,src:u.value.s3Url,alt:"上传成功后的图片",cover:""},null,8,["src"])]),_:1})):R("",!0)]),_:2},[h("video")?void 0:{name:"close",fn:e(()=>[t(ue,{class:"text-24 opacity-50 cursor-pointer",color:"textPrimary",onClick:Z},{default:e(()=>[i("mdi-close-circle")]),_:1})]),key:"0"}]),1032,["class"])):(c(),T(j,{key:1},[s(l).mediaType=="video"?(c(),b(M,{key:0,color:"info",variant:"outlined","prepend-icon":"mdi-tray-arrow-up ",disabled:r.upLoading},{default:e(()=>[i(V(r.upLoading?"上传中...":"上传视频")+" ",1),t(ee,{accept:"video/*",modelValue:s(l).videoFileId,"onUpdate:modelValue":a[4]||(a[4]=d=>s(l).videoFileId=d),infos:u.value,"onUpdate:infos":a[5]||(a[5]=d=>u.value=d),onLoading:a[6]||(a[6]=d=>r.upLoading=d),style:{width:"146px",position:"absolute",top:"0",left:"-31%",opacity:"0"}},null,8,["modelValue","infos"])]),_:1},8,["disabled"])):s(l).mediaType=="image"?(c(),b(M,{key:1,color:"info",variant:"outlined","prepend-icon":"mdi-plus",stacked:""},{default:e(()=>[i("上传 "),t(ee,{accept:"image/*",modelValue:s(l).videoFileId,"onUpdate:modelValue":a[7]||(a[7]=d=>s(l).videoFileId=d),infos:u.value,"onUpdate:infos":a[8]||(a[8]=d=>u.value=d),style:{width:"114px",height:"102px",position:"absolute",top:"0",left:"-55%",opacity:"0"}},null,8,["modelValue","infos"])]),_:1})):R("",!0)],64))]),_:1},8,["rules","modelValue","disabled"])),[[fe,s(l).mediaType]]):R("",!0),r.upLoading?(c(),T("div",ut,[t(Ce,{indeterminate:""})])):R("",!0),t(J,{type:"text",placeholder:"请输入姓名","hide-details":"auto",clearable:"",modelValue:s(l).cname,"onUpdate:modelValue":a[10]||(a[10]=d=>s(l).cname=d),rules:x.cname,disabled:h("cname")},{prepend:e(()=>[ct]),_:1},8,["modelValue","rules","disabled"]),t(J,{type:"text",placeholder:"请输入标识","hide-details":"auto",clearable:"",modelValue:s(l).name,"onUpdate:modelValue":a[11]||(a[11]=d=>s(l).name=d),rules:x.name,disabled:h("name")},{prepend:e(()=>[mt]),_:1},8,["modelValue","rules","disabled"]),t(p,{density:"compact",variant:"outlined",placeholder:"请选择性别","hide-details":"auto",rules:x.gender,modelValue:s(l).gender,"onUpdate:modelValue":a[12]||(a[12]=d=>s(l).gender=d),clearable:!1,mapDictionary:{code:"speak_gender"},disabled:h("gender")},{prepend:e(()=>[pt]),_:1},8,["rules","modelValue","disabled"]),t(p,{density:"compact",variant:"outlined",placeholder:"请选择姿势","hide-details":"auto",rules:x.posture,modelValue:s(l).posture,"onUpdate:modelValue":a[13]||(a[13]=d=>s(l).posture=d),clearable:!1,mapDictionary:{code:"digitalhuman_posture"},disabled:h("posture")},{prepend:e(()=>[n("label",ft,[i("姿势 "),t(X,null,{default:e(()=>[i("数字人形象的姿势 ")]),_:1})])]),_:1},8,["rules","modelValue","disabled"]),t(p,{density:"compact",variant:"outlined",placeholder:"请选择分辨","hide-details":"auto",rules:x.resolution,modelValue:s(l).resolution,"onUpdate:modelValue":a[14]||(a[14]=d=>s(l).resolution=d),clearable:!1,mapDictionary:{code:"digitalhuman_resolution"},disabled:h("resolution")},{prepend:e(()=>[n("label",_t,[i("分辨率 "),t(X,null,{default:e(()=>[i("上传视频的分辨率")]),_:1})])]),_:1},8,["rules","modelValue","disabled"]),t(J,{type:"text",placeholder:"请输入eg: top,bottom,left,right","hide-details":"auto",clearable:"",modelValue:s(l).pads,"onUpdate:modelValue":a[15]||(a[15]=d=>s(l).pads=d),rules:x.pads,disabled:h("pads")},{prepend:e(()=>[n("label",vt,[i("边框充填 "),t(X,null,{default:e(()=>[i("算法截取面部时的边框:上,下,左,右")]),_:1})])]),_:1},8,["modelValue","rules","disabled"]),t(Ye,{modelValue:s(l).remark,"onUpdate:modelValue":a[16]||(a[16]=d=>s(l).remark=d),modelModifiers:{trim:!0},placeholder:"请输入",disabled:h("remark")},{prepend:e(()=>[ht]),_:1},8,["modelValue","disabled"])]),_:1},512)])]),_:1},512)}}},gt=he(yt,[["__scopeId","data-v-92a2d7ce"]]),K=k=>(_e("data-v-444ef567"),k=k(),ve(),k),bt={class:"card-list-item text-textPrimary text-decoration-none",href:"javascript: void(0)"},Vt=["onClick"],kt={class:"text-subtitle-1 mt-1 text-medium-emphasis text-truncate",style:{height:"15px"}},xt={class:"d-flex align-center justify-space-between mt-2",style:{height:"32px"}},wt={class:"flex-1-1 d-flex justify-space-between text-medium-emphasis"},It=K(()=>n("span",{class:"font-weight-bold"},"这是进行一项操作时必须了解的重要信息",-1)),$t=K(()=>n("br",null,null,-1)),Dt=K(()=>n("span",{class:"text-primary"},"删除",-1)),Ft=K(()=>n("br",null,null,-1)),Tt={class:"text-primary"},Ct=K(()=>n("br",null,null,-1)),Ut=me({__name:"characterList",setup(k){const L=xe(),{loadDictTree:A,getLabels:C}=L,r=m({title:"人物形象列表"}),l=m([]),_=W({name:""}),u=m([]),w=m(0),v=m(),I=m(),N=m(!1),G=m(),x=m(),q=m(),z=W({name:""}),O=m(),h=async(y={})=>{await A(["speak_gender","digitalhuman_posture"]);const[$,F]=await Q.get({url:"/api/digitalhuman/person/list",showLoading:O.value.$el,data:{..._,...y}});F?(u.value=F.list||[],w.value=F.total):(u.value=[],w.value=0),N.value=!0},Y=()=>{v.value.query({page:1})},Z=()=>{v.value.query()},o=()=>[{text:"编辑",color:"info",icon:Re,key:"view"},{text:"下载",color:"success",icon:He,key:"download"},{text:"删除",color:"error",icon:je,key:"delete"}],a=y=>{window.open(y.video)},p=({id:y},$)=>{z.name=$.name,y==="view"?I.value.show({title:"形象编辑",operateType:"edit",infos:$}):y==="download"?a($):y==="delete"&&q.value.show({width:"400px"})},B=async(y={})=>{const[$,F]=await Q.delete({...y,showSuccess:!0,url:`/api/digitalhuman/person/${z.name}/delete`});F&&(q.value.hide(),Z())},d=()=>{I.value.show({title:"形象添加",operateType:"add"})},se=y=>{I.value.show({title:"形象详情",operateType:"view",infos:y})};return we(()=>{Z()}),(y,$)=>{const F=H("ButtonsInForm"),ye=H("NoData");return c(),T(j,null,[t(De,{title:r.value.title,breadcrumbs:l.value},null,8,["title","breadcrumbs"]),t(te,null,{default:e(()=>[t(oe,null,{default:e(()=>[t(P,{cols:"12",lg:"3",md:"4",sm:"6"},{default:e(()=>[t(J,{density:"compact",modelValue:_.name,"onUpdate:modelValue":$[0]||($[0]=f=>_.name=f),label:"请输入姓名","hide-details":"",clearable:"",variant:"outlined",onKeyup:Ie(Y,["enter"]),"onClick:clear":Y},null,8,["modelValue","onKeyup"])]),_:1}),t(P,{cols:"12",lg:"3",md:"4",sm:"6"},{default:e(()=>[t(F,null,{default:e(()=>[t(M,{color:"primary",onClick:d},{default:e(()=>[i("添加形象")]),_:1})]),_:1})]),_:1}),t(P,{cols:"12"},{default:e(()=>[t(oe,{ref_key:"listContentRef",ref:O,class:E(["min-h-[200px]",{"justify-center":u.value.length===0}])},{default:e(()=>[N.value?(c(),T(j,{key:0},[u.value.length>0?(c(!0),T(j,{key:0},ie(u.value,f=>(c(),b(P,{cols:"12",lg:"3",md:"4",sm:"6"},{default:e(()=>[t(Ue,{elevation:"10",rounded:"md"},{default:e(()=>[t(ze,{class:E(s(re).mediaType[f.mediaType].className)},{default:e(()=>[i(V(s(re).mediaType[f.mediaType].text),1)]),_:2},1032,["class"]),n("a",bt,[t(le,{src:f.cover,height:"180px",cover:"",class:"rounded-t-md align-end text-right",onClick:g=>se(f)},null,8,["src","onClick"]),t(Pe,{class:"pa-5"},{default:e(()=>[n("h5",{class:"text-h5 text-truncate",onClick:g=>se(f)},V(f.cname)+" （ "+V(s(C)([["speak_gender",f.gender],["digitalhuman_posture",f.posture]],g=>g.length?g.join("-"):"未知"))+"） ",9,Vt),n("p",kt,V(f.remark),1),n("div",xt,[n("div",wt,[n("span",null,V(s(U).dateFromNow(f.updatedAt).indexOf("后")==-1?s(U).dateFromNow(f.updatedAt):s(U).dateFromNow(f.updatedAt).substr(0,s(U).dateFromNow(f.updatedAt).length-1)+"前"),1)]),t(M,{class:"ml-6",size:"x-small",color:"inherit",icon:"",variant:"text"},{default:e(()=>[t(s(Ee),{width:"14","stroke-width":"1.5"}),t(Me,{activator:"parent"},{default:e(()=>[t(Se,{density:"compact","onClick:select":g=>p(g,f)},{default:e(()=>[(c(!0),T(j,null,ie(o(),g=>(c(),b(Le,{key:g.key,value:g.key,"hide-details":"","min-height":"38"},{prepend:e(()=>[(c(),b($e(g.icon),{size:16,class:E(["mr-2",[`text-${g.color}`]])},null,8,["class"]))]),default:e(()=>[t(Ae,{class:E([`text-${g.color}`])},{default:e(()=>[i(V(g.text),1)]),_:2},1032,["class"])]),_:2},1032,["value"]))),128))]),_:2},1032,["onClick:select"])]),_:2},1024)]),_:2},1024)])]),_:2},1024)])]),_:2},1024)]),_:2},1024))),256)):(c(),b(ye,{key:1}))],64)):R("",!0)]),_:1},8,["class"]),pe(t(Ne,{class:"mt-5",ref_key:"refPager",ref:v,"page-sizes":[12,20,40,60,120],total:w.value,onQuery:h},null,8,["total"]),[[fe,u.value.length>0]])]),_:1})]),_:1})]),_:1}),t(qe,{ref_key:"refDialogLog",ref:x},null,512),t(ot,{ref_key:"refDetail",ref:G},null,512),t(Fe,{ref_key:"refConfirmDelete",ref:q,onSubmit:B},{text:e(()=>[It,$t,i(" 此操作将会"),Dt,i("该形象"),Ft,i(" 形象姓名："),n("span",Tt,V(z.name),1),Ct,i(" 你还要继续吗？ ")]),_:1},512),t(gt,{ref_key:"refPaneModelEstimate",ref:I,onSubmit:Y},null,512)],64)}}});const Wt=he(Ut,[["__scopeId","data-v-444ef567"]]);export{Wt as default};
