import{d as J,au as Q,i as X,x as I,z as E,o as O,U as G,k as m,Z as y,W as d,n as s,F as K,l as C,m as a,j as e,Y as L,aA as W,a5 as ee,_ as p,$ as z,aD as R,a0 as ae,av as $,at as te,r as N,D as le,a1 as M,al as oe,am as se}from"./utils-fc8ebe1f.js";import{_ as j}from"./UiParentCard.vue_vue_type_script_setup_true_lang-bc14ee23.js";import{_ as ne}from"./Explain.vue_vue_type_style_index_0_lang-2aca43e9.js";import{I as re,S as ie}from"./SpeakerSelector-9465e19c.js";import{_ as de}from"./TagCorner.vue_vue_type_style_index_0_lang-fa24d583.js";import{ad as ue,M as ce,a5 as A,a0 as me,_ as Y,a4 as T}from"./index-b84f97ad.js";import{V as n}from"./VCol-f5dbb3fc.js";import{V as S}from"./VRow-4fd670bb.js";import{u as pe}from"./useScroll-6ef8887d.js";import{_ as fe}from"./NavBack.vue_vue_type_script_setup_true_lang-7a47f88d.js";import{V as _e}from"./VForm-cdbc2f03.js";import{V as ge}from"./VTextarea-e2668a01.js";import{V as ve}from"./VSwitch-a8718d97.js";import{V as ye,a as Ve,b as he,c as ke}from"./VExpansionPanel-f119d106.js";import"./IconInfoCircle-d065b385.js";import"./IconCircleCheckFilled-ef98efde.js";import"./AiAudio.vue_vue_type_style_index_0_lang-0c48023d.js";const xe={class:"aspect-square"},be=["src","poster"],Se={class:"d-flex align-center justify-center fill-height"},De={key:1,class:"h-full w-full bg-gray-100"},we={class:"box-list scrollbar-auto flex-1 pt-4 overflow-auto"},Ce=["onClick"],Te={class:"relative overflow-hidden"},Ie={class:"image-human overflow-hidden"},He=["src","alt"],Ue={class:"hv-center mt-2"},Ne={class:"line1"},Ee=J({__name:"DigitalHumanSelector",setup(V){Q();const h=X("provieDigitalHumanEdit"),f=I({list:[],formData:{name:""}}),{formData:D}=E(f),{selectedDigitalHuman:u}=E(h);function k(w){h.selectedDigitalHuman=w}const r=async()=>{await $.get({showLoading:!0,url:"/api/digitalhuman/person/list",data:{pageSize:20,page:1,...f.formData}}).then(([w,i])=>{i&&(f.list=i.list,f.list.length>0?k(f.list[0]):h.selectedDigitalHuman={name:"",cname:"",cover:"",video:"",mediaType:""})})};return O(()=>{r()}),(w,i)=>{const B=G("NoData");return m(),y("div",null,[d("div",xe,[s(u).video?(m(),y(K,{key:0},[s(u).mediaType=="video"?(m(),y("video",{key:0,style:{width:"100%",height:"100%"},src:s(u).video,controls:"",poster:s(u).cover,class:"block"},null,8,be)):s(u).mediaType=="image"?(m(),C(ce,{key:1,src:s(u).video},{placeholder:a(()=>[d("div",Se,[e(ue,{color:"primary",indeterminate:"",width:2,size:42})])]),_:1},8,["src"])):L("",!0)],64)):(m(),y("div",De))]),e(S,{class:"mt-5"},{default:a(()=>[e(n,null,{default:a(()=>[e(A,{density:"compact",modelValue:s(D).name,"onUpdate:modelValue":i[0]||(i[0]=t=>s(D).name=t),label:"搜索角色名称","hide-details":"",clearable:"",variant:"outlined",color:"red",onKeyup:W(r,["enter"]),"onClick:clear":r},null,8,["modelValue","onKeyup"])]),_:1})]),_:1}),d("div",we,[f.list.length?(m(!0),y(K,{key:0},ee(f.list,(t,H)=>(m(),C(me,{variant:"outlined",rounded:"sm",elevation:"0",class:"pa-2 bg-hover-secondary d-inline-block list-item ma-2 overflow-visible",pointer:""},{default:a(()=>{var x;return[d("div",{onClick:g=>k(t)},[d("div",Te,[e(de,{class:ae(s(R).mediaType[t.mediaType].className)},{default:a(()=>[p(z(s(R).mediaType[t.mediaType].text),1)]),_:2},1032,["class"]),d("div",Ie,[d("img",{src:t.cover,alt:t.cname},null,8,He)]),d("div",Ue,[d("div",Ne,z(t.cname),1)])]),t.name===((x=s(u))==null?void 0:x.name)?(m(),C(re,{key:0})):L("",!0)],8,Ce)]}),_:2},1024))),256)):(m(),C(B,{key:1},{default:a(()=>[p("暂无数据，请更换搜索条件")]),_:1}))])])}}});const Ge=Y(Ee,[["__scopeId","data-v-472de3c9"]]),Ke=V=>(oe("data-v-ce537ff9"),V=V(),se(),V),$e=Ke(()=>d("div",null,"请输入语音播放文本，文本内容小于500个字(包括标点符号)。",-1)),Ae={class:"generate-text"},Be={class:"flex-1"},Pe=J({__name:"digitalHumanEdit",setup(V){const{scrollRef:h,scrollToBottom:f}=pe(),D=te(),u=N(),k=N(),r=I({style:{},textKey:"",formData:{text:"",title:"",speakName:"",isGfpgan:!1},selectedSpeaker:{speakName:"",speakCname:"",headImg:"",speakDemo:"",gender:"",ageGroup:"",subTitle:""},selectedDigitalHuman:{name:"",cname:"",cover:"",video:"",mediaType:""},listSpeaker:[]}),{style:w,formData:i,selectedSpeaker:B}=E(r);le("provieDigitalHumanEdit",r);const t=I({provider:null,lang:null,gender:null,ageGroup:null,speakStyle:null,area:null}),H=N(),x=I({title:[c=>!!c||"请输入标题"],text:[c=>!!c||"请输入语音播放文本",c=>c.length<=500||"文本内容不能超过500个字"]}),g=()=>{H.value.reload({lang:t.lang,provider:t.provider,gender:t.gender,ageGroup:t.ageGroup,speakStyle:t.speakStyle,area:t.area})},P=async()=>{if(r.textKey){const c={model:"gpt-4-turbo-preview",maxTokens:512,temperature:0,topP:0,messages:[{role:"system",content:"你是一个文案专家，请根据输入的关键词，生成一段优秀的营销文案"},{role:"user",content:r.textKey}]};let l=!1;await $.post({url:"/channels/chat/completions",timeout:300*1e3,data:c,showLoading:"btn#btnGenerateText",onDownloadProgress:v=>{const _=v.target,{responseText:o}=_,q=o.lastIndexOf(`
`,o.length-2);let F=o;q!==-1&&(F=o.substring(q));try{const b=JSON.parse(F);if(b.success){const U=b.data;U&&U.fullContent&&(r.formData.text=U.fullContent,f())}else l||(M.error(b.message||"AI生成文案异常"),l=!0),console.error("AI生成文案异常：",b)}catch{}}})}},Z=async()=>{const{valid:c}=await u.value.validate();if(c){const[l,v]=await $.post({url:"/api/digitalhuman/synthesis/create",showSuccess:!0,showLoading:"btn#btnSubmit",data:{...r.formData,dhpName:r.selectedDigitalHuman.name}});v&&D.push("/digital-human/video-list/list")}else{let l="请处理页面标错的地方后，再尝试提交";M.warning(l)}};return O(()=>{h.value=k.value.$el.querySelector("textarea")}),(c,l)=>{const v=G("AiBtn"),_=G("Select");return m(),y(K,null,[e(fe,{backUrl:"/digital-human/video-list/list"},{default:a(()=>[p("创建视频")]),_:1}),e(S,null,{default:a(()=>[e(n,{cols:"12",md:"6"},{default:a(()=>[e(j,{title1:"人物视频"},{default:a(()=>[e(Ge)]),_:1})]),_:1}),e(n,{cols:"12",md:"6"},{default:a(()=>[e(j,{title:"开始数字人合成"},{default:a(()=>[e(_e,{ref_key:"refForm",ref:u,class:"my-form"},{default:a(()=>[e(S,null,{default:a(()=>[e(n,{cols:"12"},{default:a(()=>[e(T,{class:"mb-2 required"},{default:a(()=>[p("标题"),e(ne,{class:"ml-2"},{default:a(()=>[p("用于列表展示和搜索，能够快速了解基本信息")]),_:1})]),_:1}),e(A,{density:"compact",variant:"outlined",placeholder:"请输入标题","hide-details":"auto",rules:x.title,modelValue:s(i).title,"onUpdate:modelValue":l[0]||(l[0]=o=>s(i).title=o)},null,8,["rules","modelValue"])]),_:1}),e(n,{cols:"12"},{default:a(()=>[e(T,{class:"mb-2 required",style:{"white-space":"inherit"}},{default:a(()=>[$e]),_:1}),d("div",Ae,[e(S,null,{default:a(()=>[e(n,{cols:"12",class:"flex space-x-2"},{default:a(()=>[d("div",Be,[e(A,{density:"compact",variant:"outlined",placeholder:"请输入关键字","hide-details":"auto",modelValue:r.textKey,"onUpdate:modelValue":l[1]||(l[1]=o=>r.textKey=o),onKeyup:W(P,["enter"]),clearable:""},null,8,["modelValue","onKeyup"])]),e(v,{id:"btnGenerateText",color:"secondary",height:"40",onClick:P,disabled:!r.textKey},{default:a(()=>[p("AI生成文案")]),_:1},8,["disabled"])]),_:1})]),_:1})]),e(ge,{ref_key:"refTextarea",ref:k,modelValue:s(i).text,"onUpdate:modelValue":l[2]||(l[2]=o=>s(i).text=o),modelModifiers:{trim:!0},rules:x.text,placeholder:"请输入语音播放文本",counter:"",rows:"5",maxlength:"500"},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12"},{default:a(()=>[e(T,{class:"mb-2 required"},{default:a(()=>[p("是否超分")]),_:1}),e(ve,{modelValue:s(i).isGfpgan,"onUpdate:modelValue":l[3]||(l[3]=o=>s(i).isGfpgan=o),color:"primary","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(n,{cols:"12"},{default:a(()=>[e(T,{class:"mb-2 required"},{default:a(()=>[p("请选择需要合成的发声人")]),_:1}),e(ye,{class:"mb-3"},{default:a(()=>[e(Ve,{elevation:"1"},{default:a(()=>[e(he,null,{default:a(()=>[p("高级搜索")]),_:1}),e(ke,{class:"mt-4",eager:""},{default:a(()=>[e(S,null,{default:a(()=>[e(n,{cols:"4"},{default:a(()=>[e(_,{mapDictionary:{code:"speak_provider"},label:"请选择供应",modelValue:t.provider,"onUpdate:modelValue":l[4]||(l[4]=o=>t.provider=o),onChange:g},null,8,["modelValue"])]),_:1}),e(n,{cols:"4"},{default:a(()=>[e(_,{mapDictionary:{code:"speak_lang"},label:"请选择语言",modelValue:t.lang,"onUpdate:modelValue":l[5]||(l[5]=o=>t.lang=o),onChange:g},null,8,["modelValue"])]),_:1}),e(n,{cols:"4"},{default:a(()=>[e(_,{mapDictionary:{code:"speak_gender"},label:"请选择性别",modelValue:t.gender,"onUpdate:modelValue":l[6]||(l[6]=o=>t.gender=o),onChange:g},null,8,["modelValue"])]),_:1}),e(n,{cols:"4"},{default:a(()=>[e(_,{mapDictionary:{code:"speak_age_group"},label:"请选择年龄段",modelValue:t.ageGroup,"onUpdate:modelValue":l[7]||(l[7]=o=>t.ageGroup=o),onChange:g},null,8,["modelValue"])]),_:1}),e(n,{cols:"4"},{default:a(()=>[e(_,{mapDictionary:{code:"speak_style"},label:"请选择说话风格",modelValue:t.speakStyle,"onUpdate:modelValue":l[8]||(l[8]=o=>t.speakStyle=o),onChange:g},null,8,["modelValue"])]),_:1}),e(n,{cols:"4"},{default:a(()=>[e(_,{mapDictionary:{code:"speak_area"},label:"请选择适应范围",modelValue:t.area,"onUpdate:modelValue":l[9]||(l[9]=o=>t.area=o),onChange:g},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(ie,{ref_key:"refSpeakerSelector",ref:H,modelValue:s(i).speakName,"onUpdate:modelValue":l[10]||(l[10]=o=>s(i).speakName=o)},null,8,["modelValue"])]),_:1}),e(n,{cols:"12",class:"hv-center"},{default:a(()=>[e(v,{id:"btnSubmit",color:"secondary",width:"200",height:"48",size:"large",onClick:Z},{default:a(()=>[p("开始合成")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})],64)}}});const la=Y(Pe,[["__scopeId","data-v-ce537ff9"]]);export{la as default};
