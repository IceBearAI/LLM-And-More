import{_ as Re}from"./NavBack.vue_vue_type_script_setup_true_lang-ea36603e.js";import{ad as ke,i as Fe,c as j,o as oe,U as D,k as _,l as C,m as e,j as t,_ as f,$ as I,n as x,Y as $,W as c,bf as K,am as ne,an as se,d as E,b7 as J,x as L,r as P,bi as ae,b8 as R,K as Ae,Z as G,a6 as qe,F as H,z as xe,a1 as pe,bg as fe,bk as Ge,H as Y,L as je,aD as Ve,bl as Ee,w as ze,O as Ye,bm as We,bn as He,a2 as Oe,D as _e,a9 as ve}from"./utils-8a4540e3.js";import{_ as ye}from"./UiParentCard.vue_vue_type_script_setup_true_lang-a50df5aa.js";import{_ as X,ad as q,d as Je,V as Z,a4 as W,ah as Qe,p as re,m as ie,g as de,b as ue,ai as Ke,a as Ce,aj as Ze,ak as Xe,a5 as et,a6 as tt,o as at,t as lt,al as ot,x as nt,F as st,ae as rt,M as it}from"./index-b4ac7dfa.js";import{V as M}from"./VCol-b8625bbb.js";import{V as O}from"./VRow-a7542fa4.js";import{C as dt}from"./CustomUpload-9214a48d.js";import{_ as ut}from"./Explain.vue_vue_type_style_index_0_lang-addb7248.js";import{V as ct}from"./VTextarea-2463a3df.js";import{V as mt,a as pt,b as ft,c as _t}from"./VExpansionPanel-2587d006.js";import{V as vt,a as be}from"./VRadioGroup-cb60f9b8.js";import{V as yt}from"./VForm-b3ea2b89.js";import{i as bt}from"./index-8cd50de6.js";import{V as le}from"./VAlert-d47641dd.js";import{_ as ht}from"./ConfirmByInput.vue_vue_type_style_index_0_lang-70c6b095.js";import{_ as Ie}from"./ConfirmByClick.vue_vue_type_style_index_0_lang-a61f9cf3.js";import{_ as gt}from"./DialogLog.vue_vue_type_style_index_0_lang-b902e928.js";import{T as kt}from"./Text-0b0375d7.js";import{V as xt,a as he,b as Vt,c as ge}from"./VWindowItem-92a04ed0.js";import"./Confirm-6894798d.js";import"./TextLog-a2f60096.js";const z=s=>(ne("data-v-11edd06b"),s=s(),se(),s),Ct=z(()=>c("label",null,"供应",-1)),It=z(()=>c("label",null,"类型",-1)),wt=z(()=>c("label",null,"最长上下文",-1)),Tt=z(()=>c("label",null,"微调",-1)),Pt=z(()=>c("label",null,"参数量",-1)),Dt={style:{color:"#539bff"}},$t=z(()=>c("label",null,"创建时间",-1)),St=z(()=>c("label",null,"备注",-1)),Mt={__name:"ModelListDetailBaseInfo",setup(s){const{loadDictTree:b,getLabels:l}=ke(),r=Fe("provideModelListDetail"),m=j(()=>r.rawData),o=async()=>{await b(["model_type"])};return oe(()=>{o()}),(a,V)=>{const p=D("router-link"),h=D("el-tooltip");return _(),C(O,{class:"my-form waterfall"},{default:e(()=>[t(M,{xs:"12",sm:"6",md:"4",lg:"3"},{default:e(()=>[t(q,{"hide-details":""},{prepend:e(()=>[Ct]),default:e(()=>[f(" "+I(m.value.providerName),1)]),_:1})]),_:1}),t(M,{xs:"12",sm:"6",md:"4",lg:"3"},{default:e(()=>[t(q,{"hide-details":""},{prepend:e(()=>[It]),default:e(()=>[f(" "+I(x(l)([["model_type",m.value.modelType]])),1)]),_:1})]),_:1}),t(M,{xs:"12",sm:"6",md:"4",lg:"3"},{default:e(()=>[t(q,{"hide-details":""},{prepend:e(()=>[wt]),default:e(()=>[f(" "+I(m.value.maxTokens),1)]),_:1})]),_:1}),m.value.isFineTuning?(_(),C(M,{key:0,xs:"12",sm:"6",md:"4",lg:"3"},{default:e(()=>[t(q,{"hide-details":""},{prepend:e(()=>[Tt]),default:e(()=>[t(h,{content:"微调详情",placement:"top"},{default:e(()=>[t(p,{to:"/model/fine-tuning/detail?jobId="+m.value.jobId,class:"link"},{default:e(()=>[f(I(m.value.isFineTuning?"是":""),1)]),_:1},8,["to"])]),_:1})]),_:1})]),_:1})):$("",!0),t(M,{xs:"12",sm:"6",md:"4",lg:"3"},{default:e(()=>[t(q,{"hide-details":""},{prepend:e(()=>[Pt]),default:e(()=>[c("span",Dt,I(m.value.parameters)+"B",1)]),_:1})]),_:1}),t(M,{xs:"12",sm:"6",md:"4",lg:"3"},{default:e(()=>[t(q,{"hide-details":""},{prepend:e(()=>[$t]),default:e(()=>[f(" "+I(x(K).dateFormat(m.value.createdAt,"YYYY-MM-DD HH:mm:ss")),1)]),_:1})]),_:1}),t(M,{xs:"12",sm:"6",md:"4",lg:"3"},{default:e(()=>[t(q,{"hide-details":""},{prepend:e(()=>[St]),default:e(()=>[f(" "+I(m.value.remark),1)]),_:1})]),_:1})]),_:1})}}},Bt=X(Mt,[["__scopeId","data-v-11edd06b"]]),F=s=>(ne("data-v-63404a38"),s=s(),se(),s),Ut={class:"mx-auto mt-3",style:{width:"540px"}},Lt=F(()=>c("label",{class:"required"},"评测指标",-1)),Nt=F(()=>c("label",{class:"required"},"待评测数据集",-1)),Rt=F(()=>c("label",{class:"required"},"最大输出序列长度",-1)),Ft=F(()=>c("label",{class:"required"},"单卡Batch大小",-1)),At=F(()=>c("label",null,"备注",-1)),qt=F(()=>c("label",null,"调度标签",-1)),Gt=F(()=>c("label",null,"k8s集群",-1)),jt=F(()=>c("label",null,"推理类型",-1)),Et=F(()=>c("label",{class:"required"},"CPU数量",-1)),zt=F(()=>c("label",{class:"required"},"GPU数量",-1)),Yt=E({__name:"CreatePerformanceEvalPane",emits:["submit"],setup(s,{expose:b,emit:l}){const r=J(),m=L({operateType:"add"}),o=P(""),a=L({modelId:Number(r.query.jobId),fileId:"",evalTargetType:null,maxLength:512,batchSize:32,remark:"",label:null,k8sCluster:null,inferredType:"",cpu:0,gpu:0,maxGpuMemory:""}),V=l,p=P(),h=P(),v=L({fileId:[n=>!!n||"请选择微调文件"],evalTargetType:[n=>!!n||"请选择评测指标"],maxLength:[n=>!!n||"请输入最大输出序列长度"],batchSize:[n=>!!n||"请输入单卡Batch大小"],cpu:[n=>ae.validNumberInput(n,0,100,"请输入使用CPU数量",!0)],gpu:[n=>ae.validNumberInput(n,0,20,"请输入使用GPU数量",!0)],maxGpuMemory:[n=>ae.validNumberInput(n,1,80,"",!0)]}),k=({res:n})=>{n&&(a.fileId=n.fileId,o.value=n.filename)},u=()=>{o.value="",a.fileId=""},d=()=>{a.cpu!==1&&(a.cpu=1),a.gpu!==1&&(a.gpu=1)},g=async({valid:n,errors:i,showLoading:U})=>{if(n){const N={...a};a.inferredType==="cpu"?N.gpu=0:N.cpu=0,(N.gpu<2||!N.maxGpuMemory)&&delete N.maxGpuMemory;const[w,ee]=await R.post({showLoading:U,showSuccess:!0,url:"/evaluate/create",data:N});ee&&(p.value.hide(),V("submit"))}};return b({show({title:n,operateType:i}){p.value.show({title:n,refForm:h}),m.operateType=i,i=="add"&&(u(),a.evalTargetType=null,a.maxLength=512,a.batchSize=32,a.remark="",a.label=null,a.k8sCluster=null,a.inferredType="",a.cpu=0,a.gpu=0,a.maxGpuMemory="")}}),(n,i)=>{const U=D("Select"),N=D("Pane");return _(),C(N,{ref_key:"refPane",ref:p,onSubmit:g},{default:e(()=>[c("div",Ut,[t(yt,{ref_key:"refForm",ref:h,class:"my-form"},{default:e(()=>[t(U,{placeholder:"请选择评测指标",rules:v.evalTargetType,mapDictionary:{code:"model_evaluate_target_type"},modelValue:a.evalTargetType,"onUpdate:modelValue":i[0]||(i[0]=w=>a.evalTargetType=w)},{prepend:e(()=>[Lt]),_:1},8,["rules","modelValue"]),a.evalTargetType!=="five"?(_(),C(q,{key:0,rules:v.fileId,modelValue:a.fileId,"onUpdate:modelValue":i[1]||(i[1]=w=>a.fileId=w),"hide-details":"auto"},{prepend:e(()=>[Nt]),default:e(()=>[o.value?(_(),C(Je,{key:0,closable:"",color:"info","onClick:close":u},{default:e(()=>[f(I(o.value),1)]),_:1})):(_(),C(dt,{key:1,"file-type":[".txt",".json",".jsonl"],isSuffixValid:"",onAfterUpload:k},{trigger:e(()=>[t(Z,{color:"info",variant:"outlined"},{default:e(()=>[f("上传文件")]),_:1})]),_:1},8,["file-type"]))]),_:1},8,["rules","modelValue"])):$("",!0),t(W,{type:"number",placeholder:"请输入最大输出序列长度","hide-details":"auto",rules:v.maxLength,modelValue:a.maxLength,"onUpdate:modelValue":i[2]||(i[2]=w=>a.maxLength=w),modelModifiers:{number:!0}},{prepend:e(()=>[Rt]),_:1},8,["rules","modelValue"]),t(W,{type:"number",placeholder:"请输入单卡Batch大小","hide-details":"auto",rules:v.batchSize,modelValue:a.batchSize,"onUpdate:modelValue":i[3]||(i[3]=w=>a.batchSize=w),modelModifiers:{number:!0}},{prepend:e(()=>[Ft]),_:1},8,["rules","modelValue"]),t(ct,{modelValue:a.remark,"onUpdate:modelValue":i[4]||(i[4]=w=>a.remark=w),modelModifiers:{trim:!0},placeholder:"请输入你微调模型的备注",clearable:""},{prepend:e(()=>[At]),_:1},8,["modelValue"]),t(q,null,{default:e(()=>[t(mt,null,{default:e(()=>[t(pt,{elevation:"10"},{default:e(()=>[t(ft,{class:"text-h6"},{default:e(()=>[f("高级")]),_:1}),t(_t,{class:"mt-4",eager:""},{default:e(()=>[t(U,{placeholder:"请选择调度标签","hide-details":!1,mapDictionary:{code:"model_deploy_label"},modelValue:a.label,"onUpdate:modelValue":i[5]||(i[5]=w=>a.label=w)},{prepend:e(()=>[qt]),_:1},8,["modelValue"]),t(U,{placeholder:"请选择k8s集群","hide-details":!1,mapDictionary:{code:"k8s_cluster"},modelValue:a.k8sCluster,"onUpdate:modelValue":i[6]||(i[6]=w=>a.k8sCluster=w)},{prepend:e(()=>[Gt]),_:1},8,["modelValue"]),t(vt,{modelValue:a.inferredType,"onUpdate:modelValue":[i[7]||(i[7]=w=>a.inferredType=w),d],inline:"",color:"primary"},{prepend:e(()=>[jt]),default:e(()=>[t(be,{label:"CPU",value:"cpu"}),t(be,{label:"GPU",value:"gpu"})]),_:1},8,["modelValue"]),a.inferredType==="cpu"?(_(),C(W,{key:0,type:"number",placeholder:"请输入使用CPU数量",rules:v.cpu,modelValue:a.cpu,"onUpdate:modelValue":i[8]||(i[8]=w=>a.cpu=w),modelModifiers:{number:!0}},{prepend:e(()=>[Et]),_:1},8,["rules","modelValue"])):$("",!0),a.inferredType==="gpu"?(_(),C(W,{key:1,type:"number",placeholder:"请输入使用GPU数量",rules:v.gpu,modelValue:a.gpu,"onUpdate:modelValue":i[9]||(i[9]=w=>a.gpu=w),modelModifiers:{number:!0}},{prepend:e(()=>[zt]),_:1},8,["rules","modelValue"])):$("",!0),a.gpu>1?(_(),C(W,{key:2,type:"number",placeholder:"请输入GPU内存",rules:v.maxGpuMemory,modelValue:a.maxGpuMemory,"onUpdate:modelValue":i[10]||(i[10]=w=>a.maxGpuMemory=w),modelModifiers:{number:!0},max:"80","hide-details":"auto"},{prepend:e(()=>[c("label",null,[f("GPU内存 "),t(ut,null,{default:e(()=>[f("指定每个 GPU 用于存储模型权重的最大内存。这允许它为激活分配更多内存，因此您可以使用更长的上下文长度或更大的批量大小")]),_:1})])]),"append-inner":e(()=>[f(" GiB ")]),_:1},8,["rules","modelValue"])):$("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},512)])]),_:1},512)}}});const Wt=X(Yt,[["__scopeId","data-v-63404a38"]]);const Ht={__name:"GradeRadarChart",setup(s,{expose:b}){const l=P();var r=null;const m=({title:o,radar:a,seriesData:V})=>{r=bt(l.value);const p=V.map(h=>h.name);r.setOption({title:{text:o},legend:{icon:"circle",data:p},radar:a,series:[{type:"radar",data:V}]})};return Ae(()=>{r&&(r.dispose(),r=null)}),Qe(l,o=>{r==null||r.resize()}),b({initChart:m}),(o,a)=>(_(),G("div",{ref_key:"refChart",ref:l,class:"chart-item w-100 h-100"},null,512))}},Ot=X(Ht,[["__scopeId","data-v-8ceb45d1"]]),Jt=s=>(ne("data-v-33a4948e"),s=s(),se(),s),Qt={style:{height:"500px"}},Kt=Jt(()=>c("h5",{class:"text-h6 text-capitalize"},"建议进一步操作",-1)),Zt={class:"text-center mt-1"},Xt=E({__name:"ViewEvalDetailPane",setup(s,{expose:b}){const l=P(),r=P(),m=L({currentModelId:null,compare1ModelId:null,compare2ModelId:null}),o=P({}),a=[{key:"current",value:"currentModelId",disabled:!0},{key:"compare1",value:"compare1ModelId",disabled:!1},{key:"compare2",value:"compare2ModelId",disabled:!1}],V=L({id:""}),p=j(()=>o.value.current&&(o.value.current.riskOver||o.value.current.riskUnder)),h=()=>{const k={indicator:[{name:"中文能力",max:10,axisLabel:{show:!0}},{name:"推理能力",max:10},{name:"指令遵从能力",max:10},{name:"创新能力",max:10},{name:"阅读理解",max:10}]},u=[];o.value&&a.forEach(d=>{o.value[d.key].value&&u.push({name:o.value[d.key].name,value:o.value[d.key].value})}),r.value.initChart({title:"",radar:k,seriesData:u})},v=async(k=!1)=>{if(k)return;const[u,d]=await R.post({url:"/evaluate/fivegraph",showLoading:l.value.el,data:{currentModelId:m.currentModelId,compare1ModelId:m.compare1ModelId,compare2ModelId:m.compare2ModelId,currentModelEvaluateId:V.id}});d&&(o.value=d,h())};return b({show({title:k,modelId:u,id:d}){l.value.show({width:900,title:k,hasSubmitBtn:!1}),m.currentModelId=parseInt(u),m.compare1ModelId=null,m.compare2ModelId=null,V.id=d,v()}}),(k,u)=>{const d=D("Select"),g=D("Pane");return _(),C(g,{ref_key:"refPane",ref:l},{default:e(()=>[t(O,null,{default:e(()=>[t(M,{cols:p.value?7:12},{default:e(()=>[c("div",Qt,[t(Ot,{ref_key:"gradeRadarChartRef",ref:r},null,512)])]),_:1},8,["cols"]),p.value?(_(),C(M,{key:0,cols:"5"},{default:e(()=>[o.value.current.riskOver?(_(),C(le,{key:0,type:o.value.current.riskOver?"error":"success",variant:"tonal"},{default:e(()=>[f("过拟合风险")]),_:1},8,["type"])):$("",!0),o.value.current.riskUnder?(_(),C(le,{key:1,type:o.value.current.riskUnder?"error":"success",variant:"tonal",class:"mt-4"},{default:e(()=>[f("欠拟合风险")]),_:1},8,["type"])):$("",!0),t(le,{type:"info",variant:"tonal",class:"mt-4"},{default:e(()=>[Kt,c("div",null,I(o.value.current.remind),1)]),_:1})]),_:1})):$("",!0),t(M,{cols:"12"},{default:e(()=>[t(O,null,{default:e(()=>[(_(),G(H,null,qe(a,n=>t(M,{cols:"4"},{default:e(()=>{var i;return[t(d,{placeholder:"请选择模型",modelValue:m[n.value],"onUpdate:modelValue":U=>m[n.value]=U,disabled:n.disabled,clearable:!1,mapAPI:{url:"/channels/models",data:{pageSize:-1,providerName:"LocalAI",modelType:"text-generation",evalTag:"five"},labelField:"modelName",valueField:"id"},onChange:U=>v(n.disabled)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"]),c("div",Zt,I((i=o.value[n.key])==null?void 0:i.score),1)]}),_:2},1024)),64))]),_:1})]),_:1})]),_:1})]),_:1},512)}}});const ea=X(Xt,[["__scopeId","data-v-33a4948e"]]),ta={class:""},aa={class:"d-flex"},la={style:{width:"250px"},class:"mr-4"},oa={style:{width:"250px"}},na=c("span",null,"请先部署模型 ",-1),sa={key:1,class:"d-flex align-center justify-center"},ra=["onClick"],ia=["onClick"],da=c("span",{class:"text-primary"},"取消",-1),ua=c("br",null,null,-1),ca={class:"text-primary font-weight-black"},ma=c("br",null,null,-1),pa=E({__name:"TabModelEstimate",props:{showArrange:String,modelTitle:String,providerName:String},setup(s){const b=J(),{modelName:l,jobId:r}=b.query,{loadDictTree:m,getLabels:o}=ke(),a=P(),V=P(),p=P(),h=P(),v=P(),k=P(),u=L({style:{},formData:{modelName:"",evalTargetType:""},showTooltip:!1,timer:null,tableInfos:{list:[],total:0},currentJobId:""}),d=L({status:null,evalTargetType:null}),g=L({uuid:null}),n=P();xe(u);const i=()=>{V.value.show({title:"性能评估",operateType:"add"})},U=T=>{p.value.show({title:"详情",id:T.id,modelId:r})},N=T=>{u.currentJobId=T.uuid,v.value.show({width:"450px",confirmText:u.currentJobId})},w=T=>{g.uuid=T.uuid,k.value.show({width:"450px"})},ee=async(T={})=>{const[S,B]=await R.delete({...T,showSuccess:!0,url:`/evaluate/delete/${g.uuid}`});B&&(k.value.hide(),me())},Pe=async(T={})=>{const[S,B]=await R.put({...T,showSuccess:!0,url:`/evaluate/cancel/${u.currentJobId}`});B&&(v.value.hide(),me())},ce=async(T={})=>{await m(["model_evaluate_data_type"]);const[S,B]=await R.get({url:"/evaluate/list",showLoading:a.value.el,data:{modelId:r,...d,...T}});B?(u.tableInfos.total=B.total,u.tableInfos.list=B.list||[]):(u.tableInfos.list=[],u.tableInfos.total=0)},te=()=>{a.value.query({page:1})},me=()=>{a.value.query()},De=T=>{let S=[];return T.status=="waiting"||T.status=="running"?S.push({text:"取消",color:"",click(){N(T)}}):S.push({text:"删除",color:"error",click(){w(T)}}),S},$e=async T=>{u.currentJobId=T.uuid,n.value.show()},Se=async()=>{let[T,S]=await R.get({url:`/api/evaluate/${l}/eval-log/${u.currentJobId}`});if(S){const B=Object.keys(S).length===0?"":S;n.value.setContent(B)}};return oe(()=>{ce()}),(T,S)=>{const B=D("Select"),Q=D("el-tooltip"),Me=D("ButtonsInForm"),A=D("el-table-column"),Be=D("router-link"),Ue=D("ButtonsInTable"),Le=D("TableWithPager");return _(),G(H,null,[c("div",ta,[t(O,null,{default:e(()=>[t(M,{cols:"12",class:"d-flex justify-space-between align-center",style:{height:"76px"}},{default:e(()=>[c("div",aa,[c("div",la,[t(B,{onChange:te,label:"请选择评估状态",mapDictionary:{code:"model_eval_status"},modelValue:d.status,"onUpdate:modelValue":S[0]||(S[0]=y=>d.status=y)},null,8,["modelValue"])]),c("div",oa,[t(B,{onChange:te,label:"请选择指标",mapDictionary:{code:"model_evaluate_target_type"},modelValue:d.evalTargetType,"onUpdate:modelValue":S[1]||(S[1]=y=>d.evalTargetType=y)},null,8,["modelValue"])])]),t(Q,{ref:"tooltipRef",visible:u.showTooltip,"popper-options":{modifiers:[{name:"computeStyles",options:{adaptive:!1,enabled:!1}}]},"auto-close":1,"virtual-ref":h.value,"virtual-triggering":"","popper-class":"singleton-tooltip"},{content:e(()=>[na]),_:1},8,["visible","virtual-ref"]),t(Me,null,{default:e(()=>[s.providerName==="LocalAI"?(_(),C(Z,{key:0,color:"primary",onClick:i},{default:e(()=>[f("创建评估")]),_:1})):$("",!0)]),_:1})]),_:1}),t(M,{cols:"12"},{default:e(()=>[t(Le,{onQuery:ce,ref_key:"refTableWithPager",ref:a,infos:u.tableInfos},{default:e(()=>[t(A,{label:"指标","min-width":"100px"},{default:e(({row:y})=>[f(I(x(o)([["model_evaluate_target_type",y.evalTargetType]])),1)]),_:1}),t(A,{label:"评估状态","min-width":"120px"},{default:e(({row:y})=>[y.status==="failed"?(_(),C(Q,{key:0,content:y.statusMsg,placement:"top","raw-content":""},{default:e(()=>[c("span",{class:pe(`text-${x(fe).statusMap[y.status].color}`)},I(x(o)([["model_eval_status",y.status]])),3)]),_:2},1032,["content"])):(_(),G("div",sa,[c("span",{class:pe(`text-${x(fe).statusMap[y.status].color}`)},I(x(o)([["model_eval_status",y.status]])),3),["running","success"].includes(y.status)?(_(),G("div",{key:0,class:"link ml-1",onClick:Ne=>$e(y)},"(日志)",8,ra)):$("",!0)]))]),_:1}),t(A,{label:"webshell","min-width":"90px"},{default:e(({row:y})=>[y.status==="running"?(_(),C(Q,{key:0,content:"进入终端",placement:"top"},{default:e(()=>[t(Be,{class:"link",to:{path:"/model/terminal",query:{resourceType:"eval-job",serviceName:y.jobName}},target:"_blank"},{default:e(()=>[t(x(Ge),{class:"align-top",size:20})]),_:2},1032,["to"])]),_:2},1024)):$("",!0)]),_:1}),t(A,{label:"数据量","min-width":"100px"},{default:e(({row:y})=>[f(I(y.dataSize),1)]),_:1}),t(A,{label:"评估数据集","min-width":"120px"},{default:e(({row:y})=>[f(I(x(o)([["model_evaluate_data_type",y.dataType]])),1)]),_:1}),t(A,{label:"平均分","min-width":"100px"},{default:e(({row:y})=>[y.evalTargetType==="five"&&y.score>0?(_(),C(Q,{key:0,content:"点击可查看五维图指标详情",placement:"top"},{default:e(()=>[c("span",{class:"link",onClick:Ne=>U(y)},I(y.score),9,ia)]),_:2},1024)):(_(),G(H,{key:1},[f(I(y.score),1)],64))]),_:1}),t(A,{label:"备注","min-width":"200px","show-overflow-tooltip":""},{default:e(({row:y})=>[f(I(y.remark),1)]),_:1}),t(A,{label:"创建时间","min-width":"160px"},{default:e(({row:y})=>[f(I(x(K).dateFormat(y.createdAt,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),t(A,{label:"操作",width:"80px",fixed:"right"},{default:e(({row:y})=>[t(Ue,{buttons:De(y),onlyOne:""},null,8,["buttons"])]),_:1})]),_:1},8,["infos"])]),_:1})]),_:1})]),t(gt,{ref_key:"refDialogLog",ref:n,interval:20,onRefresh:Se},null,512),t(ht,{ref_key:"refConfirmAbort",ref:v,onSubmit:Pe},{text:e(()=>[f(" 此操作将会"),da,f("正在进行的模型评估"),ua,f(" 任务ID："),c("span",ca,I(u.currentJobId),1),ma,f(" 你还要继续吗？ ")]),_:1},512),t(Ie,{ref_key:"refConfirmDelete",ref:k,onSubmit:ee},{text:e(()=>[f("确定要删除该评估数据？")]),_:1},512),t(Wt,{ref_key:"createPerformanceEvalPaneRef",ref:V,onSubmit:te},null,512),t(ea,{ref_key:"viewEvalDetailPaneRef",ref:p},null,512)],64)}}});const fa=re({divider:[Number,String],...ie()},"VBreadcrumbsDivider"),_a=de()({name:"VBreadcrumbsDivider",props:fa(),setup(s,b){let{slots:l}=b;return ue(()=>{var r;return t("li",{class:["v-breadcrumbs-divider",s.class],style:s.style},[((r=l==null?void 0:l.default)==null?void 0:r.call(l))??s.divider])}),{}}}),va=re({active:Boolean,activeClass:String,activeColor:String,color:String,disabled:Boolean,title:String,...ie(),...Ke(),...Ce({tag:"li"})},"VBreadcrumbsItem"),ya=de()({name:"VBreadcrumbsItem",props:va(),setup(s,b){let{slots:l,attrs:r}=b;const m=Ze(s,r),o=j(()=>{var h;return s.active||((h=m.isActive)==null?void 0:h.value)}),a=j(()=>o.value?s.activeColor:s.color),{textColorClasses:V,textColorStyles:p}=Xe(a);return ue(()=>t(s.tag,{class:["v-breadcrumbs-item",{"v-breadcrumbs-item--active":o.value,"v-breadcrumbs-item--disabled":s.disabled,[`${s.activeClass}`]:o.value&&s.activeClass},V.value,s.class],style:[p.value,s.style],"aria-current":o.value?"page":void 0},{default:()=>{var h,v;return[m.isLink.value?t("a",{class:"v-breadcrumbs-item--link",href:m.href.value,"aria-current":o.value?"page":void 0,onClick:m.navigate},[((v=l.default)==null?void 0:v.call(l))??s.title]):((h=l.default)==null?void 0:h.call(l))??s.title]}})),{}}}),ba=re({activeClass:String,activeColor:String,bgColor:String,color:String,disabled:Boolean,divider:{type:String,default:"/"},icon:et,items:{type:Array,default:()=>[]},...ie(),...tt(),...at(),...Ce({tag:"ul"})},"VBreadcrumbs"),ha=de()({name:"VBreadcrumbs",props:ba(),setup(s,b){let{slots:l}=b;const{backgroundColorClasses:r,backgroundColorStyles:m}=lt(Y(s,"bgColor")),{densityClasses:o}=ot(s),{roundedClasses:a}=nt(s);st({VBreadcrumbsDivider:{divider:Y(s,"divider")},VBreadcrumbsItem:{activeClass:Y(s,"activeClass"),activeColor:Y(s,"activeColor"),color:Y(s,"color"),disabled:Y(s,"disabled")}});const V=j(()=>s.items.map(p=>typeof p=="string"?{item:{title:p},raw:p}:{item:p,raw:p}));return ue(()=>{const p=!!(l.prepend||s.icon);return t(s.tag,{class:["v-breadcrumbs",r.value,o.value,a.value,s.class],style:[m.value,s.style]},{default:()=>{var h;return[p&&t("li",{key:"prepend",class:"v-breadcrumbs__prepend"},[l.prepend?t(it,{key:"prepend-defaults",disabled:!s.icon,defaults:{VIcon:{icon:s.icon,start:!0}}},l.prepend):t(rt,{key:"prepend-icon",start:!0,icon:s.icon},null)]),V.value.map((v,k,u)=>{var n;let{item:d,raw:g}=v;return t(H,null,[((n=l.item)==null?void 0:n.call(l,{item:d,index:k}))??t(ya,je({key:k,disabled:k>=u.length-1},typeof d=="string"?{title:d}:d),{default:l.title?()=>{var i;return(i=l.title)==null?void 0:i.call(l,{item:d,index:k})}:void 0}),k<u.length-1&&t(_a,null,{default:l.divider?()=>{var i;return(i=l.divider)==null?void 0:i.call(l,{item:g,index:k})}:void 0})])}),(h=l.default)==null?void 0:h.call(l)]}})}),{}}}),ga=["onClick"],ka=E({__name:"FileBreadcrumb",setup(s){const b=J(),l=Ve(),{path:r}=b;b.query.jobId;const o=[{title:b.query.modelName}],a=j(()=>{const p=b.query.filePath;if(!p)return[];const h=[],v=p.split("/");let k="";for(let u=1;u<v.length;u++){if(!v[u])continue;k+=`/${v[u]}`;const d={title:v[u],filePath:k};h.push(d)}return h}),V=p=>{l.push({path:r,query:{...b.query,filePath:p.filePath}})};return(p,h)=>(_(),C(ha,{items:o.concat(a.value)},{title:e(({item:v})=>[c("a",{class:"hover:underline cursor-pointer",onClick:k=>V(v)},I(v.title),9,ga)]),_:1},8,["items"]))}}),we=["json","py","txt"],Te=["md"],xa={class:"file-preview"},Va=E({__name:"FilePreview",props:{fileType:{default:""},content:{default:""},fileInfo:{default:()=>({})}},setup(s){const b=s,l=j(()=>b.fileType||b.fileInfo.name.split(".").pop());return(r,m)=>{const o=D("CodeMirror");return _(),G("div",xa,[x(we).includes(l.value)?(_(),C(o,{key:0,"model-value":r.content,language:x(Ee)[l.value]||l.value,disabled:""},null,8,["model-value","language"])):$("",!0),x(Te).includes(l.value)?(_(),C(kt,{key:1,class:"min-h-[230px]",text:r.content,"msg-type":"answer"},null,8,["text"])):$("",!0)])}}});const Ca=["onClick"],Ia=E({__name:"FileList",setup(s){const b=J(),l=Ve(),{modelName:r}=b.query,m=P(),o=L({list:[],total:0}),a=L({fileContent:"",fileInfo:{}}),V=P("tree"),p=P(),h=j(()=>b.query.filePath||""),v=async(u={})=>{let d=!0;V.value==="tree"?d=m.value.el:V.value==="file"&&(d=p.value.$el);const[g,n]=await R.get({url:`/models/${r}/tree`,showLoading:d,data:{path:h.value}});n?(V.value=n.object,V.value==="tree"?o.list=n.tree||[]:V.value==="file"&&(a.fileInfo=n.fileInfo,a.fileContent=n.fileContent)):o.list=[]},k=u=>{const d=b.query,g=u.name.split(".").pop(),n=`${h.value}/${u.name}`,i=[...we,...Te];u.isDir||i.includes(g)?l.push({path:"/model/model-list/detail",query:{...d,filePath:n}}):Oe.warning("该文件类型暂不支持预览！")};return ze(h,u=>{v()}),oe(()=>{v()}),(u,d)=>{const g=D("el-table-column"),n=D("TableWithPager");return _(),C(O,null,{default:e(()=>[t(M,{cols:"12",class:"d-flex justify-space-between align-center"},{default:e(()=>[t(ka)]),_:1}),t(M,{cols:"12"},{default:e(()=>[V.value==="tree"?(_(),C(n,{key:0,onQuery:v,ref_key:"refTableWithPager",ref:m,infos:o,showPager:!1,border:!1,"header-cell-class-name":"","cell-class-name":""},{default:e(()=>[t(g,{label:"文件名","min-width":"220px"},{default:e(({row:i})=>[c("a",{class:"inline-flex items-center hover:underline cursor-pointer overflow-hidden",onClick:U=>k(i)},[(_(),C(Ye(i.isDir?x(We):x(He)),{class:"mr-2 shrink-0",size:18})),c("span",null,I(i.name),1)],8,Ca)]),_:1}),t(g,{label:"大小","min-width":"80px"},{default:e(({row:i})=>[f(I(x(K).getFileSize(i.size)),1)]),_:1}),t(g,{label:"更新时间","min-width":"165px"},{default:e(({row:i})=>[f(I(x(K).dateFormat(i.updatedAt,"YYYY-MM-DD HH:mm:ss")),1)]),_:1})]),_:1},8,["infos"])):V.value==="file"?(_(),C(Va,{key:1,ref_key:"filePreviewRef",ref:p,content:a.fileContent,"file-info":a.fileInfo},null,8,["content","file-info"])):$("",!0)]),_:1})]),_:1})}}});const wa=["innerHTML"],Oa=E({__name:"modelListDetail",setup(s){const b=J(),l=P(),r=L({tabIndex:b.query.filePath?3:2,style:{},formData:{},rawData:{modelName:"",deployStatus:"",providerName:""},confirmByClickInfo:{html:"",action:"",row:{}}}),{style:m,rawData:o,formData:a}=xe(r);_e("provideModelListDetail",r),_e("provideModelListDetailed",r),(async()=>{let{jobId:d}=b.query,[g,n]=await R.get({showLoading:!0,url:`/api/models/${d}`});n&&(r.rawData=n)})();const p=(d={})=>{let{action:g,row:n}=r.confirmByClickInfo;g=="deploy"?h(n,d):g=="undeploy"&&v(n,d)},h=async(d,g)=>{let[n,i]=await R.post({...g,showSuccess:!0,url:`/api/models/${d.id}/deploy`,data:{...r.formData,id:d.id}});i&&l.value.hide()},v=async(d,g)=>{let[n,i]=await R.post({...g,showSuccess:!0,url:`/api/models/${d.id}/undeploy`,data:{...r.formData,id:d.id}});i&&l.value.hide()},k=()=>{ve.assign(r.confirmByClickInfo,{html:"确认部署模型 <span class='text-primary mx-1  font-weight-black'>"+r.rawData.modelName+"</span>吗？",action:"deploy",row:r.rawData}),l.value.show({width:"350px"})},u=()=>{ve.assign(r.confirmByClickInfo,{html:"确认卸载模型 <span class='text-primary mx-1  font-weight-black'>"+r.rawData.modelName+"</span>吗？",action:"undeploy",row:r.rawData}),l.value.show({width:"350px"})};return(d,g)=>(_(),G(H,null,[t(Re,{backUrl:"/model/model-list/list"},{default:e(()=>[f("模型详情")]),_:1}),t(ye,{class:"mt-4"},{header:e(()=>[f(" 模型："+I(x(o).modelName),1)]),action:e(()=>[x(o).deployStatus=="success"||x(o).deployStatus=="running"?(_(),C(Z,{key:0,flat:"",color:"secondary",onClick:u},{default:e(()=>[f("卸载")]),_:1})):$("",!0),x(o).deployStatus=="failed"?(_(),C(Z,{key:1,flat:"",color:"secondary",onClick:k},{default:e(()=>[f("部署")]),_:1})):$("",!0)]),default:e(()=>[t(Bt)]),_:1}),t(ye,{class:"mt-5"},{header:e(()=>[t(xt,{modelValue:r.tabIndex,"onUpdate:modelValue":g[0]||(g[0]=n=>r.tabIndex=n),"align-tabs":"start",color:"primary"},{default:e(()=>[t(he,{value:2},{default:e(()=>[f("评估列表")]),_:1}),t(he,{value:3},{default:e(()=>[f("文件")]),_:1})]),_:1},8,["modelValue"])]),default:e(()=>[t(Vt,{modelValue:r.tabIndex,"onUpdate:modelValue":g[1]||(g[1]=n=>r.tabIndex=n)},{default:e(()=>[t(ge,{value:2},{default:e(()=>[t(pa,{showArrange:x(o).deployStatus,modelTitle:x(o).modelName,providerName:x(o).providerName},null,8,["showArrange","modelTitle","providerName"])]),_:1}),t(ge,{value:3},{default:e(()=>[t(Ia,{showArrange:x(o).deployStatus,modelTitle:x(o).modelName,providerName:x(o).providerName},null,8,["showArrange","modelTitle","providerName"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(Ie,{ref_key:"refConfirmByClick",ref:l,onSubmit:p},{text:e(()=>[c("div",{innerHTML:r.confirmByClickInfo.html},null,8,wa)]),_:1},512)],64))}});export{Oa as default};
