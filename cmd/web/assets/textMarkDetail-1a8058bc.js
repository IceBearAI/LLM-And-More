import{d as Q,i as Z,ac as z,au as E,at as O,r as W,x as q,z as Y,o as G,U as C,S as J,k as _,Z as T,j as n,m as t,_ as u,W as o,Q as B,$ as c,n as s,a3 as K,l as b,Y as h,F as X,av as x,a8 as $,a1 as tt}from"./utils-01c411e4.js";import{_ as et}from"./NavBack.vue_vue_type_script_setup_true_lang-5c808334.js";import{_ as at}from"./UiParentCard.vue_vue_type_script_setup_true_lang-76206b3a.js";import{Z as st,ae as L,L as ot,a0 as nt,V as lt,a3 as it}from"./index-bb5b6a82.js";import{V as M}from"./VRow-970d1eb0.js";import{V as p}from"./VCol-a8d2bf92.js";import{V as dt}from"./VForm-d3cbc9ba.js";import{V as f}from"./VTextarea-4511848c.js";const ut=o("label",null,"任务ID",-1),rt={class:"link"},ct=o("label",null,"任务名称",-1),pt={class:"v-box item-end"},mt={class:"pl-5"},_t={class:"link font-bold"},ft={class:"pl-8"},yt={class:"link font-bold"},bt={class:"px-5"},ht={class:"link font-bold"},xt={class:"px-5"},vt={class:"link font-bold"},gt={class:"px-5"},Vt={class:"link font-bold"},kt=["innerHTML"],Dt=o("label",{class:"required"},"Instruction",-1),wt=o("label",{class:"required"},"Document",-1),It=o("label",{class:"required"},"Question",-1),qt=o("label",{class:"required"},"Intent",-1),Ct=o("label",{class:"required"},"Input",-1),Tt=o("label",{class:"required"},"Output",-1),Bt={class:"flex justify-between mt-5"},$t=o("div",null,null,-1),Ht=Q({__name:"textMarkDetail",setup(Lt){const{t:U}=st(),F=Z("provideAspectPage"),{getLabels:S,loadDictTree:N}=z();N(["textannotation_type"]);const j=E(),R=O(),v=W();let V=!1;const a=q({style:{},annotationId:"",displayData:{name:"",annotationType:"",segmentContent:"",total:0,uncompleted:0,completed:0,abandoned:0},formData:{uuid:"",instruction:"",document:"",question:"",intent:"",input:"",output:""}}),{style:Mt,formData:i,displayData:r}=Y(a),m=q({instruction:[l=>!!l||"请输入信息"],question:[l=>!!l||"请输入信息"],intent:[l=>!!l||"请输入信息"],output:[l=>!!l||"请输入信息"],document:[l=>!!l||"请输入信息"],input:[l=>!!l||"请输入信息"]}),k=async()=>{const[l,e]=await x.get({showLoading:!0,url:`/api/mgr/annotation/task/${a.annotationId}/info`});e&&(a.displayData={...a.displayData,...e},a.displayData.uncompleted=e.total-e.completed-e.abandoned,it(document).scrollTop(0))},D=()=>{V&&F.methods.refreshListPage(),R.push("/sample-library/text-mark/list")},w=async()=>{v.value.resetValidation(),a.formData={uuid:"",instruction:"",document:"",question:"",intent:"",input:"",output:""};const[l,e]=await x.get({showLoading:!0,url:`/api/mgr/annotation/task/${a.annotationId}/segment/next`});e&&($.assign(a.formData,$.pick(e,["uuid","instruction","question","intent","output"])),e.segmentContent?a.displayData.segmentContent="<div>"+e.segmentContent.split(`
`).join("</div><div>")+"</div>":a.displayData.segmentContent="")},I=()=>{V=!0,a.displayData.uncompleted==1?D():(k(),w())},A=async()=>{const[l,e]=await x.put({showLoading:!0,showSuccess:!0,url:`/api/mgr/annotation/task/${a.annotationId}/segment/${a.formData.uuid}/abandoned`});e&&I()},P=async()=>{let{valid:l,errors:e}=await v.value.validate();if(l){const[y,g]=await x.post({showLoading:!0,showSuccess:!0,url:`/api/mgr/annotation/task/${a.annotationId}/segment/${a.formData.uuid}/mark`,data:a.formData});g&&I()}else{let y=U("pane.errorMsg");tt.warning(y)}};return G(()=>{let{annotationId:l}=j.query;a.annotationId=l,k(),w()}),(l,e)=>{const y=C("AiBtn"),g=C("ButtonsInForm"),H=J("copy");return _(),T(X,null,[n(et,{backUrl:"backCallback",onBack:D},{default:t(()=>[u("文本标注")]),_:1}),n(at,{class:"mt-4"},{default:t(()=>[o("div",null,[n(M,{class:"my-form waterfall"},{default:t(()=>[n(p,{cols:"12",md:"6"},{default:t(()=>[n(p,null,{default:t(()=>[n(L,{"hide-details":""},{prepend:t(()=>[ut]),default:t(()=>[B((_(),T("span",rt,[u(c(a.annotationId),1)])),[[H,a.annotationId]])]),_:1})]),_:1}),n(p,null,{default:t(()=>[n(L,{"hide-details":""},{prepend:t(()=>[ct]),default:t(()=>[u(" "+c(s(r).name),1)]),_:1})]),_:1})]),_:1}),n(p,{cols:"12",md:"6",class:"text-xl text-slate-500 flex justify-end"},{default:t(()=>[o("div",pt,[n(p,{class:"flex"},{default:t(()=>[o("div",mt,[u(" 标注进度："),B(o("span",null,[o("span",_t,c(s(r).completed+s(r).abandoned+1),1),u("/"+c(s(r).total),1)],512),[[K,a.displayData.total]])]),o("div",ft,[u(" 任务类型："),o("span",yt,c(s(S)([["textannotation_type",s(r).annotationType]])),1)])]),_:1}),n(p,{class:"ml-auto flex flex-wrap divide-x"},{default:t(()=>[o("div",bt,[u(" 已完成："),o("span",ht,c(s(r).completed),1)]),o("div",xt,[u(" 未完成："),o("span",vt,c(s(r).uncompleted),1)]),o("div",gt,[u(" 丢弃："),o("span",Vt,c(s(r).abandoned),1)])]),_:1})])]),_:1})]),_:1})]),n(ot,{class:"mb-5"}),n(M,null,{default:t(()=>[n(p,{cols:"12",md:"5"},{default:t(()=>[n(nt,{class:"h-full flex p-4 overflow-hidden min-h-[300px] max-h-[665px] text-[15px]",elevation:"3"},{default:t(()=>[o("div",{class:"flex-1 scrollbar-auto space-y-3 [line-height:1.4]",innerHTML:s(r).segmentContent},null,8,kt)]),_:1})]),_:1}),n(p,{cols:"12",md:"7"},{default:t(()=>[n(dt,{ref_key:"refForm",ref:v,class:"my-form space-y-4"},{default:t(()=>[n(f,{type:"textarea",placeholder:"请输入信息","hide-details":"auto",rules:m.instruction,"validate-on":"submit",modelValue:s(i).instruction,"onUpdate:modelValue":e[0]||(e[0]=d=>s(i).instruction=d),class:"block"},{prepend:t(()=>[Dt]),_:1},8,["rules","modelValue"]),["rag"].includes(a.displayData.annotationType)?(_(),b(f,{key:0,type:"textarea",placeholder:"请输入信息","hide-details":"auto",rules:m.document,"validate-on":"submit",modelValue:s(i).document,"onUpdate:modelValue":e[1]||(e[1]=d=>s(i).document=d),class:"block"},{prepend:t(()=>[wt]),_:1},8,["rules","modelValue"])):h("",!0),["faq","rag"].includes(a.displayData.annotationType)?(_(),b(f,{key:1,type:"text",placeholder:"请输入信息","hide-details":"auto",rules:m.question,"validate-on":"submit",modelValue:s(i).question,"onUpdate:modelValue":e[2]||(e[2]=d=>s(i).question=d),class:"block"},{prepend:t(()=>[It]),_:1},8,["rules","modelValue"])):h("",!0),["faq"].includes(a.displayData.annotationType)?(_(),b(f,{key:2,type:"text",placeholder:"请输入信息","hide-details":"auto",rules:m.intent,"validate-on":"submit",modelValue:s(i).intent,"onUpdate:modelValue":e[3]||(e[3]=d=>s(i).intent=d),class:"block"},{prepend:t(()=>[qt]),_:1},8,["rules","modelValue"])):h("",!0),["general"].includes(a.displayData.annotationType)?(_(),b(f,{key:3,type:"text",placeholder:"请输入信息","hide-details":"auto",clearable:"",rules:m.input,"validate-on":"submit",modelValue:s(i).input,"onUpdate:modelValue":e[4]||(e[4]=d=>s(i).input=d),class:"block"},{prepend:t(()=>[Ct]),_:1},8,["rules","modelValue"])):h("",!0),n(f,{type:"text",placeholder:"请输入信息","hide-details":"auto",clearable:"",rules:m.output,"validate-on":"submit",modelValue:s(i).output,"onUpdate:modelValue":e[5]||(e[5]=d=>s(i).output=d),class:"block"},{prepend:t(()=>[Tt]),_:1},8,["rules","modelValue"])]),_:1},512)]),_:1})]),_:1}),o("div",Bt,[$t,n(g,null,{default:t(()=>[n(lt,{class:"w-[120px] btn-danger",plain:"",onClick:A,disabled:!s(i).uuid},{default:t(()=>[u("丢弃")]),_:1},8,["disabled"]),n(y,{color:"secondary",class:"w-[120px]",onClick:P,disabled:!s(i).uuid},{default:t(()=>[u("提交")]),_:1},8,["disabled"])]),_:1})])]),_:1})],64)}}});export{Ht as default};
