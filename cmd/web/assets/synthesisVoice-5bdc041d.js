import{r as b,i as A,z as h,x as w,U as N,k as x,l as D,m as a,j as e,_ as u,n as l,at as M,c as q,W as C,Z as G,$ as j,Y as T,X as z,ad as E,b8 as H,D as Q,o as W,S as X,Q as P,a4 as Y,L as Z,F as J,b9 as K,a9 as I,a2 as O}from"./utils-91854e55.js";import{_ as U}from"./UiParentCard.vue_vue_type_script_setup_true_lang-72749ad5.js";import{_ as ee}from"./UiChildCard.vue_vue_type_script_setup_true_lang-d48df9f7.js";import{_ as ae}from"./NavBack.vue_vue_type_script_setup_true_lang-0ba665e2.js";import{S as le}from"./SpeakerSelector-e448250b.js";import{V as $}from"./VRow-a4b8abae.js";import{V as i}from"./VCol-4c3995c3.js";import{a3 as p,ad as te,a4 as R,_ as oe,N as se,af as re}from"./index-38e2b3cf.js";import{V as B}from"./VForm-24c895bc.js";import{_ as de}from"./Explain.vue_vue_type_style_index_0_lang-b72b33af.js";import{V as ne}from"./VTextarea-e715451f.js";import{V as ie}from"./VSlider-3a2354c4.js";import{V as ue}from"./VSwitch-2adb09ab.js";import{_ as me}from"./AiAudio.vue_vue_type_style_index_0_lang-52a6c53d.js";const pe={__name:"Left",setup(F,{expose:y}){const k=b(),g=b(),c=A("provideSynthesisVoice"),{formData:t}=h(c),_=w({selectedSpeaker:{}}),d=w({provider:[f=>!!f||"请选择供应"],lang:[f=>!!f||"请选择语言"],speakName:[f=>!!f||"请选择发声人"]}),m=()=>{g.value.reload({lang:t.value.lang,provider:t.value.provider,gender:t.value.gender,ageGroup:t.value.ageGroup,speakStyle:t.value.speakStyle,area:t.value.area})};return y({validate(){return k.value.validate()}}),(f,o)=>{const r=N("Select");return x(),D(B,{ref_key:"refForm",ref:k,class:"my-form"},{default:a(()=>[e($,null,{default:a(()=>[e(i,{cols:"4"},{default:a(()=>[e(p,{class:"mb-2"},{default:a(()=>[u("供应")]),_:1}),e(r,{mapDictionary:{code:"speak_provider"},placeholder:"请选择供应",modelValue:l(t).provider,"onUpdate:modelValue":o[0]||(o[0]=s=>l(t).provider=s),onChange:m},null,8,["modelValue"])]),_:1}),e(i,{cols:"4"},{default:a(()=>[e(p,{class:"mb-2"},{default:a(()=>[u("语言")]),_:1}),e(r,{mapDictionary:{code:"speak_lang"},placeholder:"请选择语言",modelValue:l(t).lang,"onUpdate:modelValue":o[1]||(o[1]=s=>l(t).lang=s),infos:l(c).selectedLanguage,"onUpdate:infos":o[2]||(o[2]=s=>l(c).selectedLanguage=s),onChange:m},null,8,["modelValue","infos"])]),_:1}),e(i,{cols:"4"},{default:a(()=>[e(p,{class:"mb-2"},{default:a(()=>[u("性别")]),_:1}),e(r,{mapDictionary:{code:"speak_gender"},placeholder:"请选择性别",modelValue:l(t).gender,"onUpdate:modelValue":o[3]||(o[3]=s=>l(t).gender=s),onChange:m},null,8,["modelValue"])]),_:1}),e(i,{cols:"4"},{default:a(()=>[e(p,{class:"mb-2"},{default:a(()=>[u("年龄段")]),_:1}),e(r,{mapDictionary:{code:"speak_age_group"},placeholder:"请选择年龄段",modelValue:l(t).ageGroup,"onUpdate:modelValue":o[4]||(o[4]=s=>l(t).ageGroup=s),onChange:m},null,8,["modelValue"])]),_:1}),e(i,{cols:"4"},{default:a(()=>[e(p,{class:"mb-2"},{default:a(()=>[u("说话风格")]),_:1}),e(r,{mapDictionary:{code:"speak_style"},placeholder:"请选择说话风格",modelValue:l(t).speakStyle,"onUpdate:modelValue":o[5]||(o[5]=s=>l(t).speakStyle=s),onChange:m},null,8,["modelValue"])]),_:1}),e(i,{cols:"4"},{default:a(()=>[e(p,{class:"mb-2"},{default:a(()=>[u("适应范围")]),_:1}),e(r,{mapDictionary:{code:"speak_area"},placeholder:"请选择适应范围",modelValue:l(t).area,"onUpdate:modelValue":o[6]||(o[6]=s=>l(t).area=s),onChange:m},null,8,["modelValue"])]),_:1}),e(i,{cols:"12"},{default:a(()=>[e(p,{class:"mb-2 required"},{default:a(()=>[u("请选择需要合成的发声人")]),_:1}),e(te,{rules:d.speakName,modelValue:l(t).speakName,"onUpdate:modelValue":o[9]||(o[9]=s=>l(t).speakName=s)},{default:a(()=>[e(le,{ref_key:"refSpeakerSelector",ref:g,modelValue:l(t).speakName,"onUpdate:modelValue":o[7]||(o[7]=s=>l(t).speakName=s),infos:_.selectedSpeaker,"onUpdate:infos":o[8]||(o[8]=s=>_.selectedSpeaker=s)},null,8,["modelValue","infos"])]),_:1},8,["rules","modelValue"])]),_:1})]),_:1})]),_:1},512)}}},fe={key:0,class:"text-primary font-weight-bold"},ce={style:{width:"300px"}},_e={__name:"Right",setup(F,{expose:y}){const{tenantId:k}=M().userInfo,g=b(),c=A("provideSynthesisVoice"),{formData:t}=h(c),_=w({speedConfig:{min:.5,max:2,step:.1}}),{speedConfig:d}=h(_),m=w({title:[o=>!!o||"请输入标题"],text:[o=>!!o||"请输入语音播放文本"],speed:[o=>{if(o){let{min:r,max:s}=_.speedConfig;return o<r?"语速不能低于"+r+"倍":o>s?"语速不能高于"+s+"倍":!0}else return"请设置语速"}]}),f=q(()=>{let{label:o}=c.selectedLanguage;return o?o.trim().replace(/([^(（]+)(.*)$/,"$1"):""});return y({validate(){return g.value.validate()}}),(o,r)=>{const s=N("Select");return x(),D(B,{ref_key:"refForm",ref:g,class:"my-form"},{default:a(()=>[e($,null,{default:a(()=>[e(i,{cols:"12"},{default:a(()=>[e(p,{class:"mb-2 required"},{default:a(()=>[u("标题"),e(de,{class:"ml-2"},{default:a(()=>[u("用于列表展示和搜索，能够快速了解基本信息")]),_:1})]),_:1}),e(R,{density:"compact",variant:"outlined",placeholder:"请输入标题","hide-details":"auto",rules:m.title,modelValue:l(t).title,"onUpdate:modelValue":r[0]||(r[0]=n=>l(t).title=n),modelModifiers:{trim:!0},clearable:""},null,8,["rules","modelValue"])]),_:1}),e(i,{cols:"12"},{default:a(()=>[e(p,{class:"mb-2 required",style:{"white-space":"inherit"}},{default:a(()=>[C("div",null,[u(" 请输入"),f.value?(x(),G("span",fe,"「 "+j(f.value)+" 」",1)):T("",!0),u("语音播放文本，文本内容小于200个字(包括标点符号)。 ")])]),_:1}),e(ne,{modelValue:l(t).text,"onUpdate:modelValue":r[1]||(r[1]=n=>l(t).text=n),modelModifiers:{trim:!0},rules:m.text,placeholder:"语音播放文本",counter:"",rows:"5",maxlength:"200"},null,8,["modelValue","rules"])]),_:1}),e(i,{cols:"12"},{default:a(()=>[e(p,{class:"mb-2"},{default:a(()=>[u("语气")]),_:1}),e(s,{mapDictionary:{code:"speak_tone"},placeholder:"请选择语气",modelValue:l(t).tone,"onUpdate:modelValue":r[2]||(r[2]=n=>l(t).tone=n)},null,8,["modelValue"])]),_:1}),e(i,{cols:"12"},{default:a(()=>[e(p,{class:"mb-2 required"},{default:a(()=>[u("语速")]),_:1}),C("div",ce,[e(ie,{density:"compact",modelValue:l(t).speed,"onUpdate:modelValue":r[4]||(r[4]=n=>l(t).speed=n),color:"primary",max:l(d).max,min:l(d).min,step:l(d).step,"thumb-label":"",rules:m.speed,"hide-details":"auto"},{append:a(()=>[e(R,{modelValue:l(t).speed,"onUpdate:modelValue":r[3]||(r[3]=n=>l(t).speed=n),modelModifiers:{number:!0},type:"number",density:"compact",max:l(d).max,min:l(d).min,step:l(d).step,style:{width:"80px"}},null,8,["modelValue","max","min","step"])]),_:1},8,["modelValue","max","min","step","rules"])])]),_:1}),l(k)==="5f9b3b3d-9b9c-4e1a-8e1a-5a4b4b4b4b4b"?(x(),D(i,{key:0,cols:"12"},{default:a(()=>[e(p,{class:"mb-2"},{default:a(()=>[u("设置为样音")]),_:1}),e(ue,{modelValue:l(t).setDemo,"onUpdate:modelValue":r[5]||(r[5]=n=>l(t).setDemo=n),color:"primary","hide-details":"auto"},null,8,["modelValue"])]),_:1})):T("",!0),z(o.$slots,"default")]),_:3})]),_:3},512)}}};const ge={class:"hv-center py-3"},Ve={__name:"synthesisVoice",setup(F){const{mappings:y,loadDictTree:k}=E(),g=H(),c=b(),t=b(),_=b(),d=w({style:{showPreview:!1,loadingPreview:!1},formData:{provider:"",lang:"",gender:"",ageGroup:"",speakStyle:"",area:"",speakName:"",text:"",title:"",speed:1,tone:null,setDemo:!1},selectedLanguage:{label:"",value:""},selectedSpeaker:{speakName:"",speakCname:"",headImg:"",speakDemo:"",gender:"",ageGroup:"",subTitle:""},selectedDigitalHuman:{name:"",cname:"",cover:"",video:""},audioInfo:{src:"",gender:"",type:"complex"}}),{style:m,formData:f,selectedSpeaker:o}=h(d);Q("provideSynthesisVoice",d);const r=n=>{d.style.loadingPreview=!0,d.style.showPreview=!0,setTimeout(()=>{re.scrollTo(_.value.$el,500),I.assign(d.audioInfo,{src:n.s3Url,gender:n.gender})},100),setTimeout(()=>{d.style.loadingPreview=!1},500)},s=async()=>{const{valid:n}=await c.value.validate(),{valid:S}=await t.value.validate();if(n&&S){const[V,v]=await K.post({showLoading:"btn#btnSubmit",showSuccess:!0,url:"/api/voice/tts",data:I.omit(d.formData,["provider","lang","gender","ageGroup","speakStyle","area"])});v?r(v):d.style.showPreview=!1}else{let V="请处理页面标错的地方后，再尝试提交";O.warning(V)}};return W(async()=>{var v,L;await k(["speak_provider","speak_lang"]);let{provider:n,lang:S,speakName:V}=g.query;n&&((v=y.speak_provider)!=null&&v[n])&&(d.formData.provider=n),S&&((L=y.speak_lang)!=null&&L[S])&&(d.formData.lang=S),V&&(d.formData.speakName=V)}),(n,S)=>{const V=N("AiBtn"),v=X("loading");return x(),G(J,null,[e(ae,{backUrl:"/voice-print/synthesis/voice-list"},{default:a(()=>[u("创建TTS")]),_:1}),e($,{class:"mt-1"},{default:a(()=>[e(i,{cols:"12",md:"6"},{default:a(()=>[e(U,null,{default:a(()=>[e(pe,{ref_key:"refFormLeft",ref:c},null,512)]),_:1})]),_:1}),e(i,{cols:"12",md:"6"},{default:a(()=>[e(U,null,{default:a(()=>[e(_e,{ref_key:"refFormRight",ref:t},{default:a(()=>[e(i,{cols:"12",class:"mt-4"},{default:a(()=>[C("div",ge,[e(V,{id:"btnSubmit",color:"secondary",width:"200",height:"48",size:"large",onClick:s},{default:a(()=>[u("开始合成")]),_:1})])]),_:1})]),_:1},512)]),_:1})]),_:1}),e(se,null,{default:a(()=>[P(e(i,{cols:"12"},{default:a(()=>[e(U,null,{default:a(()=>[e(i,{cols:"12",class:"pt-10"},{default:a(()=>[P((x(),D(ee,{title:"合成音频"},{default:a(()=>[e(me,Z({...d.audioInfo},{ref_key:"refAiAudio",ref:_}),null,16)]),_:1})),[[v,l(m).loadingPreview]])]),_:1})]),_:1})]),_:1},512),[[Y,l(m).showPreview]])]),_:1})]),_:1})],64)}}},Le=oe(Ve,[["__scopeId","data-v-e72f27ad"]]);export{Le as default};
