import{_ as z}from"./BaseBreadcrumb.vue_vue_type_style_index_0_lang-18e452f2.js";import{_ as J}from"./UiParentCard.vue_vue_type_script_setup_true_lang-f4692398.js";import{A as G}from"./AlertBlock-50b3d44f.js";import{x,z as W,r as L,a8 as H,U as $,k as S,l as O,m as t,W as I,j as e,_ as u,$ as l,n as d,av as y,ac as X,o as ee,Z as U,L as ae,F as N,a5 as te,aB as oe}from"./utils-5e5ddd14.js";import"./ChipBoolean-b18fcd7d.js";import{_ as Y}from"./AiAudio.vue_vue_type_style_index_0_lang-c986ba9f.js";import{_ as le,Z as q,a4 as D,K as ne,V as se,I as re,f as ie,i as ue}from"./index-322628a8.js";import{V as de}from"./VForm-799cb0e3.js";import{V as B}from"./VRow-fd84878d.js";import{V as m}from"./VCol-9cc1d0ca.js";import{V as F}from"./VTextarea-a79462f7.js";import{_ as ge}from"./ConfirmByClick.vue_vue_type_style_index_0_lang-75f2ee8d.js";import"./IconInfoCircle-bce0295e.js";import"./VAlert-55714c9a.js";import"./Confirm-e151dc0b.js";const me={class:"mx-auto mt-10",style:{width:"500px"}},fe={class:"ml-1"},ce={__name:"PaneAudioMark",emits:["submit"],setup(E,{expose:C,emit:M}){const{t:V}=q(),f=x({rawData:{},formData:{taggedContent:"",taggedLanguage:""}}),{formData:r,rawData:c}=W(f),A=M,p=L(),w=L(),v=x({taggedContent:[n=>!!n||V("audioMark.pane.ruleTaggedContent")],taggedLanguage:[n=>!!n||V("audioMark.pane.ruleTaggedLanguage")]}),T=async({valid:n,showLoading:s})=>{if(n){const[k,_]=await y.put({url:`/api/voice/audio/${f.rawData.id}`,showLoading:s,showSuccess:!0,data:{...f.formData}});_&&(p.value.hide(),A("submit"))}};return C({show({infos:n}){p.value.show({title:V("audioAnnotation"),refForm:w});let s=H.cloneDeep(n);f.rawData=s;let{taggedContent:k,taggedLanguage:_}=s;k||(k=s.originalContent),_||(_=s.originalLanguage),H.assign(f.formData,{taggedContent:k,taggedLanguage:_})}}),(n,s)=>{const k=$("Select"),_=$("Pane");return S(),O(_,{ref_key:"refPane",ref:p,onSubmit:T},{default:t(()=>[I("div",me,[e(de,{ref_key:"refForm",ref:w,class:"my-form"},{default:t(()=>[e(B,null,{default:t(()=>[e(m,{cols:"12"},{default:t(()=>[e(D,{class:"mb-2"},{default:t(()=>[u(l(n.$t("audioMark.audio")),1)]),_:1}),e(Y,{type:"complex",src:d(c).audioUrl},null,8,["src"])]),_:1}),e(m,{cols:"12",class:"mt-5"},{default:t(()=>[e(D,{class:"mb-2"},{default:t(()=>[u(l(n.$t("audioMark.pane.originalContent"))+" ",1),I("span",fe,"("+l(n.$t("options.markLanguage."+d(c).originalLanguage))+")",1)]),_:1}),e(F,{modelValue:d(c).originalContent,"onUpdate:modelValue":s[0]||(s[0]=h=>d(c).originalContent=h),readonly:""},null,8,["modelValue"])]),_:1}),e(m,{cols:"12"},{default:t(()=>[e(D,{class:"mb-2 required"},{default:t(()=>[u(l(n.$t("audioMark.pane.taggedContent")),1)]),_:1}),e(F,{modelValue:d(r).taggedContent,"onUpdate:modelValue":s[1]||(s[1]=h=>d(r).taggedContent=h),modelModifiers:{trim:!0},placeholder:"请输入",rules:v.taggedContent},null,8,["modelValue","rules"])]),_:1}),e(m,{cols:"12"},{default:t(()=>[e(D,{class:"mb-2 required"},{default:t(()=>[u(l(n.$t("audioMark.pane.taggedLanguage")),1)]),_:1}),e(k,{mapDictionary:{code:"audio_tagged_lang",i18nKey:"markLanguage"},modelValue:d(r).taggedLanguage,"onUpdate:modelValue":s[2]||(s[2]=h=>d(r).taggedLanguage=h),rules:v.taggedLanguage},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512)])]),_:1},512)}}},pe=le(ce,[["__scopeId","data-v-4b2e89cc"]]),_e=["onClick"],xe={__name:"audioMark",setup(E){X();const{t:C}=q(),M=L(),V=L(),f=L(),r=x({style:{},formData:{taggedStatus:!1,originalLanguage:null},selectedInfo:{},tableInfos:{list:[],total:""}}),{formData:c,tableInfos:A}=W(r),p=()=>{M.value.query({page:1})},w=async(a={})=>{const[i,g]=await y.get({url:"/api/voice/audio",showLoading:M.value.el,data:{...r.formData,...a}});g?(r.tableInfos.list=g.list,r.tableInfos.total=g.total):(r.tableInfos.list=[],r.tableInfos.total=0)},v=a=>{V.value.show({infos:a})},T=a=>{r.selectedInfo=a,f.value.show({width:"400px"})},n=async()=>{const[a,i]=await y.delete({showSuccess:!0,url:`/api/voice/audio/${r.selectedInfo.id}`});i&&(f.value.hide(),p())},s=async a=>{await y.put({url:`/api/voice/audio/${a.id}`,showLoading:!0,showSuccess:!0,data:{taggedContent:a.taggedContent||a.originalContent,taggedLanguage:a.taggedLanguage||a.originalLanguage}})},k=a=>{let i=[];return i.push({text:C("audioMark.tableHeader.mark"),color:"info",click(){v(a)}}),a.taggedStatus==!1&&i.push({text:C("audioMark.tableHeader.confirm"),color:"info",click(){s(a)}}),i.push({text:C("audioMark.tableHeader.discard"),color:"info",click(){T(a)}}),i},_=()=>{let a=[];return a.push({text:"CSV",minTitle:"csv"}),a.push({text:"JSONL",minTitle:"jsonl"}),a},h=L({title:"audioAnnotation"}),K=L([{text:"audioManagement",disabled:!1,href:"#"},{text:"audioAnnotation",disabled:!0,href:"#"}]),Q=async a=>{const[i,g]=await y.post({showSuccess:!0,url:"/api/voice/audio/export",data:{format:a.minTitle}});g&&y.downloadByUrl({fileUrl:g.url,suffixName:g.format})};return ee(()=>{p()}),(a,i)=>{const g=$("Select"),R=$("el-tooltip"),b=$("el-table-column"),j=$("ButtonsInTable"),Z=$("TableWithPager");return S(),U(N,null,[e(z,{title:a.$t(h.value.title),breadcrumbs:K.value},null,8,["title","breadcrumbs"]),e(B,null,{default:t(()=>[e(m,null,{default:t(()=>[e(J,null,{default:t(()=>[e(B,null,{default:t(()=>[e(m,{cols:"12",lg:"3",md:"4",sm:"6"},{default:t(()=>[e(g,{modelValue:d(c).taggedStatus,"onUpdate:modelValue":i[0]||(i[0]=o=>d(c).taggedStatus=o),label:a.$t("audioMark.taggedStatus"),mapDictionary:{code:"boolean"},onChange:p},null,8,["modelValue","label"])]),_:1}),e(m,{cols:"12",lg:"3",md:"4",sm:"6"},{default:t(()=>[e(g,{modelValue:d(c).originalLanguage,"onUpdate:modelValue":i[1]||(i[1]=o=>d(c).originalLanguage=o),label:a.$t("language"),mapDictionary:{code:"audio_tagged_lang",i18nKey:"markLanguage"},onChange:p},null,8,["modelValue","label"])]),_:1}),e(m,{cols:"12",lg:"3",md:"4",sm:"6"},{default:t(()=>[e(ne,null,{activator:t(({props:o})=>[e(se,ae({color:"primary"},o),{default:t(()=>[u(l(a.$t("audioMark.tableHeader.exportBtn")),1)]),_:2},1040)]),default:t(()=>[e(re,null,{default:t(()=>[(S(!0),U(N,null,te(_(),(o,P)=>(S(),O(ue,{key:P,value:P},{default:t(()=>[e(ie,{onClick:be=>Q(o)},{default:t(()=>[u(l(o.text),1)]),_:2},1032,["onClick"])]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1}),e(m,{cols:"12"},{default:t(()=>[e(G,null,{default:t(()=>[u(l(a.$t("audioMark.alertBlock")),1)]),_:1})]),_:1}),e(m,{cols:"12"},{default:t(()=>[e(Z,{onQuery:w,ref_key:"refTableWithPager",ref:M,infos:r.tableInfos},{default:t(()=>[e(b,{label:a.$t("fileName"),width:"200px",fixed:"left"},{default:t(({row:o})=>[e(R,{effect:"dark",content:a.$t("audioMark.tableHeader.audioNameTip"),placement:"top"},{default:t(()=>[I("span",{class:"link",onClick:P=>v(o)},l(o.audioName),9,_e)]),_:2},1032,["content"])]),_:1},8,["label"]),e(b,{label:a.$t("language"),width:"110px","show-overflow-tooltip":""},{default:t(({row:o})=>[I("span",null,l(a.$t("options.markLanguage."+o.originalLanguage)),1)]),_:1},8,["label"]),e(b,{label:a.$t("tryListening"),"min-width":"330px"},{default:t(({row:o})=>[e(Y,{type:"simple",src:o.audioUrl},null,8,["src"])]),_:1},8,["label"]),e(b,{label:a.$t("audioMark.tableHeader.originalContent"),"min-width":"200px","show-overflow-tooltip":""},{default:t(({row:o})=>[u(l(o.originalContent),1)]),_:1},8,["label"]),e(b,{label:a.$t("audioMark.tableHeader.taggedContent"),"min-width":"200px","show-overflow-tooltip":""},{default:t(({row:o})=>[u(l(o.taggedContent),1)]),_:1},8,["label"]),e(b,{label:a.$t("audioMark.tableHeader.taggedLanguage"),"min-width":"150px"},{default:t(({row:o})=>[u(l(o.taggedLanguage?a.$t("options.markLanguage."+o.taggedLanguage,""):""),1)]),_:1},8,["label"]),e(b,{label:a.$t("audioMark.tableHeader.updatedAt"),"min-width":"200px"},{default:t(({row:o})=>[u(l(o.taggedStatus?d(oe).dateFormat(o.updatedAt,"YYYY-MM-DD HH:mm:ss"):""),1)]),_:1},8,["label"]),e(b,{label:a.$t("audioMark.tableHeader.lastOperator"),"min-width":"150px"},{default:t(({row:o})=>[u(l(o.lastOperator),1)]),_:1},8,["label"]),e(b,{label:a.$t("operation"),"min-width":"140px",fixed:"right"},{default:t(({row:o})=>[e(j,{onlyOne:!0,buttons:k(o)},null,8,["buttons"])]),_:1},8,["label"])]),_:1},8,["infos"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(pe,{ref_key:"refPaneAudioMark",ref:V,onSubmit:p},null,512),e(ge,{ref_key:"refConfirmDelete",ref:f,onSubmit:n},{text:t(()=>[u(l(a.$t("audioMark['confirm delete']"))+"？",1)]),_:1},512)],64)}}};export{xe as default};
