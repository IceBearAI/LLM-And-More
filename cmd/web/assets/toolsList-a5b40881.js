import{d as Q,x as k,r as V,c as Z,U as g,k as f,l as $,m as l,W as u,j as t,_ as p,Z as S,F as M,a6 as G,n as q,bs as X,bU as ee,Y as te,b9 as Y,am as le,an as oe,ad as ae,o as se,bf as ne,$ as w,bg as re}from"./utils-5f930323.js";import{_ as de}from"./BaseBreadcrumb.vue_vue_type_style_index_0_lang-e4abdd62.js";import{_ as ue}from"./UiParentCard.vue_vue_type_script_setup_true_lang-4369d2cd.js";import{A as ie}from"./AlertBlock-eb4a6850.js";import{_ as ce}from"./ConfirmByInput.vue_vue_type_style_index_0_lang-79ed702e.js";import{_ as L}from"./Explain.vue_vue_type_style_index_0_lang-86bc965d.js";import{a4 as P,ad as W,V as H,_ as me}from"./index-1ef416e3.js";import{V as O}from"./VTextarea-63ea126d.js";import{V as E}from"./VRow-3347130d.js";import{V as x}from"./VCol-f4c3210b.js";import{V as pe}from"./VForm-5e264cc2.js";import"./VAlert-628a3f7c.js";import"./Confirm-946e9e71.js";const _=C=>(le("data-v-a44ccdd3"),C=C(),oe(),C),_e={class:"mx-auto mt-3",style:{width:"750px"}},fe={class:"required"},he={class:"required"},ye=_(()=>u("div",{style:{"max-width":"365px"}},[p(" 工具的描述，给个案例"),u("br"),p("例："),u("br"),p('对于生成一张图片很有帮助。 输入应该是相要生成的图片的描述。输入参考: {"prompt": "图片描述", "model": "dall-e-3"} 结果里的url是图片地址。 ')],-1)),be=_(()=>u("label",{class:"required"},"工具类型",-1)),Ve=_(()=>u("label",{class:"required"},"http地址",-1)),ge=_(()=>u("label",{class:"required"},"method",-1)),ve=_(()=>u("label",null,"body",-1)),ke=_(()=>u("label",null,"Key",-1)),xe=_(()=>u("label",null,"Value",-1)),Te=_(()=>u("label",{class:"mt-n1"},"header",-1)),we=_(()=>u("label",{class:"required"},"编程语言",-1)),Ce=_(()=>u("label",{class:"required"},"代码",-1)),Ie=_(()=>u("label",null,"备注",-1)),Ue=Q({__name:"CreateToolPane",emits:["submit"],setup(C,{expose:A,emit:N}){const B={name:"",description:"",toolType:null,metadata:"",remark:""},R=N,y=k({operateType:"add"}),r=V({...B}),n=k({url:"",method:null,body:"",headerValues:[{key:"",value:""}]}),c=k({language:null,code:""}),v=V(),b=V(),h=k({name:[a=>/^[a-zA-Z0-9-_]+$/.test(a)||"只允许字母、数字、“-” 、“_”"],description:[a=>!!a||"请输入工具描述"],toolType:[a=>!!a||"请选择工具类型"],url:[a=>!!a||"请输入url"],method:[a=>!!a||"请选择请求方式"],language:[a=>!!a||"请选择编程语言"],code:[a=>!!a||"请输入代码"],content:[a=>!!a||"请输入脚本模版"]});Z(()=>y.operateType==="edit");const j=()=>{n.headerValues.push({key:"",value:""})},z=a=>{n.headerValues.splice(a,1)},I=()=>{let a=null;if(r.value.toolType==="function"){const e=n.headerValues.reduce((o,d)=>(d.key&&d.value&&(o[d.key]=d.value),o),{});a={url:n.url,method:n.method,body:n.body,header:e}}else r.value.toolType==="code_interpreter"?a=c:a={};return JSON.stringify(a)},U=async({valid:a,showLoading:e})=>{if(a){const o={url:"",method:""};y.operateType=="add"?(o.url="/tools/create",o.method="post"):(o.url=`/tools/${r.value.toolId}`,o.method="put");const d=I(),[m,s]=await Y[o.method]({showLoading:e,showSuccess:!0,url:o.url,data:{...r.value,metadata:d}});s&&(v.value.hide(),R("submit"))}},K=a=>{try{const e=a.toolType,o=JSON.parse(a.metadata);if(e==="function"){const d=Object.keys(o.header).map(m=>({key:m,value:o.header[m]}));n.url=o.url,n.method=o.method,n.body=o.body,n.headerValues=d.length===0?[{key:"",value:""}]:d}else e==="code_interpreter"&&(c.language=o.language,c.code=o.code)}catch(e){console.log(e)}},D=()=>{r.value={...B},n.url="",n.method=null,n.body="",n.headerValues=[{key:"",value:""}],c.language=null,c.code=""};return A({show({title:a,operateType:e,infos:o}){v.value.show({title:a,refForm:b}),y.operateType=e,y.operateType==="add"?D():(K(o),r.value={...o})}}),(a,e)=>{const o=g("Select"),d=g("CodeMirror"),m=g("Pane");return f(),$(m,{ref_key:"refPane",ref:v,onSubmit:U},{default:l(()=>[u("div",_e,[t(pe,{ref_key:"refForm",ref:b,class:"my-form"},{default:l(()=>[t(P,{type:"text",placeholder:"只允许字母、数字、“-” 、“_”","hide-details":"auto",clearable:"",rules:h.name,modelValue:r.value.name,"onUpdate:modelValue":e[0]||(e[0]=s=>r.value.name=s)},{prepend:l(()=>[u("label",fe,[p("工具名称 "),t(L,null,{default:l(()=>[p("工具名称，通常为函数名")]),_:1})])]),_:1},8,["rules","modelValue"]),t(O,{modelValue:r.value.description,"onUpdate:modelValue":e[1]||(e[1]=s=>r.value.description=s),modelModifiers:{trim:!0},rules:h.description,"hide-details":"auto",placeholder:"请输入工具描述"},{prepend:l(()=>[u("label",he,[p("工具描述 "),t(L,null,{default:l(()=>[ye]),_:1})])]),_:1},8,["modelValue","rules"]),t(o,{placeholder:"请选择工具类型",rules:h.toolType,mapDictionary:{code:"assistant_tool_type"},modelValue:r.value.toolType,"onUpdate:modelValue":e[2]||(e[2]=s=>r.value.toolType=s)},{prepend:l(()=>[be]),_:1},8,["rules","modelValue"]),r.value.toolType==="function"?(f(),S(M,{key:0},[t(P,{type:"text",placeholder:"请输入url","hide-details":"auto",clearable:"",rules:h.url,modelValue:n.url,"onUpdate:modelValue":e[3]||(e[3]=s=>n.url=s)},{prepend:l(()=>[Ve]),_:1},8,["rules","modelValue"]),t(o,{placeholder:"请选择请求方式",rules:h.method,mapDictionary:{code:"http_method"},modelValue:n.method,"onUpdate:modelValue":e[4]||(e[4]=s=>n.method=s)},{prepend:l(()=>[ge]),_:1},8,["rules","modelValue"]),t(W,{"hide-details":"auto",modelValue:n.body,"onUpdate:modelValue":e[6]||(e[6]=s=>n.body=s),"center-affix":!1},{prepend:l(()=>[ve]),default:l(()=>[t(d,{modelValue:n.body,"onUpdate:modelValue":e[5]||(e[5]=s=>n.body=s),placeholder:"请输入"},null,8,["modelValue"])]),_:1},8,["modelValue"]),t(W,{"hide-details":"",class:"header-input mb-0","center-affix":!1},{prepend:l(()=>[Te]),default:l(()=>[(f(!0),S(M,null,G(n.headerValues,(s,F)=>(f(),$(E,{class:"form-item-inner w-100 ml-n5 mb-4","no-gutters":""},{default:l(()=>[t(x,{cols:"5"},{default:l(()=>[t(P,{type:"text","hide-details":"auto",placeholder:"请输入Key",clearable:"",modelValue:s.key,"onUpdate:modelValue":T=>s.key=T},{prepend:l(()=>[ke]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(x,{cols:"5"},{default:l(()=>[t(P,{"hide-details":"auto",type:"text",placeholder:"请输入Value",clearable:"",modelValue:s.value,"onUpdate:modelValue":T=>s.value=T},{prepend:l(()=>[xe]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(x,{cols:"2",class:"mt-1"},{default:l(()=>[F===0?(f(),$(H,{key:0,class:"ml-3",icon:"",flat:"",color:"info",size:"x-small"},{default:l(()=>[t(q(X),{"stroke-width":"1.5",size:20,onClick:j})]),_:1})):(f(),$(H,{key:1,icon:"",flat:"",class:"ml-3",color:"error",size:"x-small",onClick:T=>z(F)},{default:l(()=>[t(q(ee),{"stroke-width":"1.5",size:20})]),_:2},1032,["onClick"]))]),_:2},1024)]),_:2},1024))),256))]),_:1})],64)):r.value.toolType==="code_interpreter"?(f(),S(M,{key:1},[t(o,{placeholder:"请选择编程语言",rules:h.language,mapDictionary:{code:"programming_language"},modelValue:c.language,"onUpdate:modelValue":e[7]||(e[7]=s=>c.language=s)},{prepend:l(()=>[we]),_:1},8,["rules","modelValue"]),t(W,{"hide-details":"auto",rules:h.code,modelValue:c.code,"onUpdate:modelValue":e[9]||(e[9]=s=>c.code=s),"center-affix":!1},{prepend:l(()=>[Ce]),default:l(()=>[t(d,{modelValue:c.code,"onUpdate:modelValue":e[8]||(e[8]=s=>c.code=s),language:c.language,placeholder:"请输入"},null,8,["modelValue","language"])]),_:1},8,["rules","modelValue"])],64)):te("",!0),t(O,{modelValue:r.value.remark,"onUpdate:modelValue":e[10]||(e[10]=s=>r.value.remark=s),modelModifiers:{trim:!0},placeholder:"请输入备注"},{prepend:l(()=>[Ie]),_:1},8,["modelValue"])]),_:1},512)])]),_:1},512)}}});const De=me(Ue,[["__scopeId","data-v-a44ccdd3"]]),$e=["onClick"],Pe=["onClick"],Se={class:"text-primary font-weight-black"},Me=u("br",null,null,-1),Oe=Q({__name:"toolsList",setup(C){const{getLabels:A,loadDictTree:N}=ae();N(["assistant_tool_type"]);const B=V({title:"工具列表"}),R=V([{text:"AI助手",disabled:!1,href:"#"},{text:"工具列表",disabled:!0,href:"#"}]),y=k({name:""}),r=k({list:[],total:0}),n=V(),c=V(),v=V(),b=k({name:"",toolId:""}),h=e=>{let o=[];return o.push({text:"编辑",color:"info",click(){D(e)}}),o.push({text:"删除",color:"error",click(){j(e)}}),o},j=e=>{b.toolId=e.toolId,b.name=e.name,v.value.show({width:"450px",confirmText:b.name})},z=async(e={})=>{const[o,d]=await Y.delete({...e,showSuccess:!0,url:`/tools/${b.toolId}`});d&&(v.value.hide(),I())},I=async(e={})=>{const[o,d]=await Y.get({url:"/tools/list",showLoading:c.value.el,data:{...y,...e}});d?(r.list=d.list||[],r.total=d.total):(r.list=[],r.total=0)},U=()=>{c.value.query({page:1})},K=()=>{n.value.show({title:"创建工具",operateType:"add"})},D=e=>{n.value.show({title:"编辑工具",infos:e,operateType:"edit"})},a=e=>e.map(o=>o.name).join("<br/>");return se(()=>{I()}),(e,o)=>{const d=g("ButtonsInForm"),m=g("el-table-column"),s=g("el-tooltip"),F=g("ButtonsInTable"),T=g("TableWithPager");return f(),S(M,null,[t(de,{title:B.value.title,breadcrumbs:R.value},null,8,["title","breadcrumbs"]),t(ue,null,{default:l(()=>[t(E,null,{default:l(()=>[t(x,{cols:"12",lg:"3",md:"4",sm:"6"},{default:l(()=>[t(P,{modelValue:y.name,"onUpdate:modelValue":o[0]||(o[0]=i=>y.name=i),label:"请输入工具名称","hide-details":"",clearable:"",onKeyup:ne(U,["enter"]),"onClick:clear":U},null,8,["modelValue","onKeyup"])]),_:1}),t(x,{cols:"12",lg:"3",md:"4",sm:"6"},{default:l(()=>[t(d,null,{default:l(()=>[t(H,{color:"primary",onClick:K},{default:l(()=>[p("创建工具")]),_:1})]),_:1})]),_:1}),t(x,{cols:"12"},{default:l(()=>[t(ie,null,{default:l(()=>[p("修改之后将实时生效，请谨慎操作！")]),_:1})]),_:1}),t(x,{cols:"12"},{default:l(()=>[t(T,{onQuery:I,ref_key:"tableWithPagerRef",ref:c,infos:r},{default:l(()=>[t(m,{label:"工具ID","min-width":"220px"},{default:l(({row:i})=>[u("a",{href:"javascript: void(0)",class:"link",onClick:J=>D(i)},w(i.toolId),9,$e)]),_:1}),t(m,{label:"工具名称","min-width":"200px","show-overflow-tooltip":"","class-name":"link-ellipsis-color"},{default:l(({row:i})=>[u("a",{href:"javascript: void(0)",class:"link",onClick:J=>D(i)},w(i.name),9,Pe)]),_:1}),t(m,{label:"工具描述",prop:"description","min-width":"300px","show-overflow-tooltip":""}),t(m,{label:"工具类型",width:"100px"},{default:l(({row:i})=>[p(w(q(A)([["assistant_tool_type",i.toolType]])),1)]),_:1}),t(m,{label:"被助手使用",prop:"assistant","min-width":"110px"},{default:l(({row:i})=>[i.assistants.length>0?(f(),$(s,{key:0,content:a(i.assistants),placement:"top","raw-content":""},{default:l(()=>[p(w(i.assistants.length),1)]),_:2},1032,["content"])):(f(),S(M,{key:1},[p(" 0 ")],64))]),_:1}),t(m,{label:"备注",prop:"remark","min-width":"200px"}),t(m,{label:"更新时间","min-width":"165px"},{default:l(({row:i})=>[p(w(q(re).dateFormat(i.updatedAt,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),t(m,{label:"操作人",prop:"operator","min-width":"180px","show-overflow-tooltip":""}),t(m,{label:"操作",width:"120px",fixed:"right"},{default:l(({row:i})=>[t(F,{buttons:h(i)},null,8,["buttons"])]),_:1})]),_:1},8,["infos"])]),_:1})]),_:1})]),_:1}),t(ce,{ref_key:"refConfirmDelete",ref:v,onSubmit:z},{text:l(()=>[p(" 您将要删除 "),u("span",Se,w(b.name),1),p(" 工具"),Me,p(" 确定要继续吗？ ")]),_:1},512),t(De,{ref_key:"createToolPaneRef",ref:n,onSubmit:U},null,512)],64)}}});export{Oe as default};
