import{d as R,k as m,l as M,m as e,j as t,_ as i,$ as _,n as k,bg as Q,am as te,an as se,W as a,at as ce,c as pe,U as B,Z as S,a1 as j,X as fe,bS as me,bO as _e,r as g,x as Y,a6 as oe,V as he,F as z,a2 as ve,b9 as L,b8 as ae,o as le,bf as be,bK as Z,Q as J,a4 as ee}from"./utils-d360fd38.js";import{_ as ye}from"./NavBack.vue_vue_type_script_setup_true_lang-bc31ea81.js";import{_ as N}from"./UiParentCard.vue_vue_type_script_setup_true_lang-f0de3c2a.js";import{ad as E,_ as G,I as xe,V as X,a4 as O,bh as we,d as ge}from"./index-8b7fa986.js";import{V as D}from"./VCol-dc51774a.js";import{V as ne}from"./VRow-92b162a6.js";import{_ as re}from"./ConfirmByClick.vue_vue_type_style_index_0_lang-9ff2c807.js";import{u as ke}from"./useScroll-3dc56607.js";import{d as $e}from"./favicon-7b746610.js";import{T as Ce}from"./Text-4710d390.js";import{V as W}from"./VTextarea-cca1525d.js";import{V as ie}from"./VForm-1f16fcb0.js";import{A as Te}from"./AlertBlock-f3f39cbb.js";import"./Confirm-dc38596b.js";import"./VAlert-24aead77.js";const U=c=>(te("data-v-defe08aa"),c=c(),se(),c),Ie=U(()=>a("label",null,"创建人",-1)),Ve=U(()=>a("label",null,"总会话",-1)),De=U(()=>a("label",null,"创建时间",-1)),Se=U(()=>a("label",null,"更新时间",-1)),Ae=U(()=>a("label",null,"备注",-1)),Be=R({__name:"DetailBaseInfo",props:{info:{default:()=>({})}},setup(c){const o=c;return(y,h)=>(m(),M(ne,{class:"my-form waterfall"},{default:e(()=>[t(D,{xs:"12",sm:"6",md:"4",lg:"3"},{default:e(()=>[t(E,{"hide-details":""},{prepend:e(()=>[Ie]),default:e(()=>[i(" "+_(o.info.creator),1)]),_:1})]),_:1}),t(D,{xs:"12",sm:"6",md:"4",lg:"3"},{default:e(()=>[t(E,{"hide-details":""},{prepend:e(()=>[Ve]),default:e(()=>[i(" "+_(o.info.samples),1)]),_:1})]),_:1}),t(D,{xs:"12",sm:"6",md:"4",lg:"3"},{default:e(()=>[t(E,{"hide-details":""},{prepend:e(()=>[De]),default:e(()=>[i(" "+_(k(Q).dateFormat(o.info.createdAt,"YYYY-MM-DD HH:mm:ss")),1)]),_:1})]),_:1}),t(D,{xs:"12",sm:"6",md:"4",lg:"3"},{default:e(()=>[t(E,{"hide-details":""},{prepend:e(()=>[Se]),default:e(()=>[i(" "+_(k(Q).dateFormat(o.info.updatedAt,"YYYY-MM-DD HH:mm:ss")),1)]),_:1})]),_:1}),t(D,{xs:"12",sm:"6",md:"4",lg:"3"},{default:e(()=>[t(E,{"hide-details":""},{prepend:e(()=>[Ae]),default:e(()=>[i(" "+_(o.info.remark),1)]),_:1})]),_:1})]),_:1}))}});const Ye=G(Be,[["__scopeId","data-v-defe08aa"]]),Me=["src"],qe={key:1,class:"message-avatar__text"},Fe={class:"overflow-hidden"},Ee={class:"h-box"},Re=R({__name:"Message",props:{msgType:{default:"question"},text:{default:""}},emits:["click:edit","click:delete"],setup(c,{emit:o}){const y=o,h=ce(),x=pe(()=>{const n=h.userInfo.username;return n?n[0].toUpperCase():"Y"});return(n,v)=>{const d=B("el-popover");return m(),S("div",{class:j([{"flex-row-reverse":n.msgType==="answer"},"pa-5 d-flex w-100 position-relative"])},[a("div",{class:j(["d-flex align-center justify-center flex-shrink-0 align-self-start",n.msgType==="answer"?"ml-2":"mr-2"])},[n.msgType==="answer"?(m(),M(xe,{key:0},{default:e(()=>[a("img",{class:"rounded-circle",src:k($e),alt:"avatar",width:"40"},null,8,Me)]),_:1})):(m(),S("div",qe,_(x.value),1))],2),a("div",Fe,[n.$slots.text?fe(n.$slots,"text",{key:0},void 0,!0):(m(),M(d,{key:1,placement:n.msgType==="question"?"bottom-start":"bottom-end","show-arrow":!1,width:"auto","popper-class":"text-popover",offset:5,"show-after":500,teleported:!1},{reference:e(()=>[a("div",{class:j(["d-flex",{"flex-row-reverse":n.msgType==="question"}])},[t(Ce,{text:n.text,"msg-type":"answer"},null,8,["text"])],2)]),default:e(()=>[a("div",Ee,[a("div",{class:"operate-btn hv-center",onClick:v[0]||(v[0]=p=>y("click:edit"))},[t(k(me),{size:20})]),a("div",{class:"operate-btn hv-center",onClick:v[1]||(v[1]=p=>y("click:delete"))},[t(k(_e),{size:20})])])]),_:1},8,["placement"]))])],2)}}});const Ue=G(Re,[["__scopeId","data-v-39eff8ea"]]),de=c=>(te("data-v-16fbf8f5"),c=c(),se(),c),Pe={class:"d-flex flex-column h-100"},Qe={class:"flex-1 position-relative"},ze={class:"qa-item"},Le={key:1,class:"no-data text-medium-emphasis"},He={class:"footer"},Ke=de(()=>a("label",{class:"required"},"问",-1)),je=de(()=>a("label",{class:"required"},"答",-1)),We=R({__name:"CreateQA",props:{uuid:String},emits:["submit"],setup(c,{expose:o,emit:y}){const h=c,x=y,{scrollRef:n,scrollToBottom:v}=ke(),d=g([]),p=Y({operateType:"add",datasetSampleId:""}),$=g(""),w=g(""),r=g(),f=g(),V=Y({question:[l=>!!l||"请输入用户问"],answer:[l=>!!l||"请输入客服回答"]}),P=g(""),q=l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),u())},u=async()=>{const{valid:l}=await f.value.validate();l&&(d.value.push({isEdit:!1,role:"user",content:$.value},{isEdit:!1,role:"assistant",content:w.value}),v(),$.value="",w.value="")},C=l=>{P.value=l.content,l.isEdit=!0},T=(l,s)=>{l||(s.content||(s.content=P.value),s.isEdit=!1)},I=(l,s)=>{s.role==="user"?d.value.splice(l,2):d.value.splice(l-1,2)},H=async({showLoading:l})=>{if(d.value.length===0){ve.warning("问答数据不能为空");return}const s={url:"",method:""};p.operateType=="add"?(s.url=`/datasets/${h.uuid}/samples`,s.method="post"):(s.url=`/api/datasets/${h.uuid}/samples/${p.datasetSampleId}`,s.method="put");const[A,K]=await L[s.method]({showLoading:l,showSuccess:!0,url:s.url,data:{messages:d.value}});K&&(r.value.hide(),x("submit"))};return o({show({title:l,operateType:s,infos:A}){r.value.show({title:l,confirmText:"save"}),p.operateType=s,p.operateType==="add"?($.value="",w.value="",d.value=[]):(p.datasetSampleId=A.uuid,d.value=A.messages)}}),(l,s)=>{const A=B("perfect-scrollbar"),K=B("Pane");return m(),M(K,{ref_key:"refPane",ref:r,onSubmit:H},{default:e(()=>[a("div",Pe,[a("div",Qe,[d.value.length>0?(m(),M(A,{key:0,ref_key:"scrollRef",ref:n,class:"h-100"},{default:e(()=>[(m(!0),S(z,null,oe(d.value,(b,ue)=>(m(),S("div",ze,[t(Ue,{"msg-type":b.role==="user"?"question":"answer",text:b.content,"onClick:edit":F=>C(b),"onClick:delete":F=>I(ue,b)},he({_:2},[b.isEdit?{name:"text",fn:e(()=>[t(W,{autofocus:"",style:{width:"350px"},"hide-details":"","no-resize":"","auto-grow":"",rows:1,"max-rows":4,modelValue:b.content,"onUpdate:modelValue":F=>b.content=F,"onUpdate:focused":F=>T(F,b)},null,8,["modelValue","onUpdate:modelValue","onUpdate:focused"])]),key:"0"}:void 0]),1032,["msg-type","text","onClick:edit","onClick:delete"])]))),256))]),_:1},512)):(m(),S("div",Le,"暂无问答数据"))]),a("div",He,[t(N,null,{default:e(()=>[t(ie,{ref_key:"refForm",ref:f,class:"my-form"},{default:e(()=>[t(W,{modelValue:$.value,"onUpdate:modelValue":s[0]||(s[0]=b=>$.value=b),"hide-details":"auto",density:"default",placeholder:"用户问","no-resize":"","auto-grow":"",rows:1,"max-rows":4,rules:V.question,"validate-on":"submit",onKeypress:q},{prepend:e(()=>[Ke]),_:1},8,["modelValue","rules"]),t(W,{class:"mb-0",modelValue:w.value,"onUpdate:modelValue":s[1]||(s[1]=b=>w.value=b),"hide-details":"auto",density:"default",placeholder:"客服回答","no-resize":"","auto-grow":"",rows:1,"max-rows":4,rules:V.answer,"validate-on":"submit",onKeypress:q},{prepend:e(()=>[je]),"append-inner":e(()=>[t(X,{color:"primary",size:"small",flat:"",onClick:u},{default:e(()=>[i("追加")]),_:1})]),_:1},8,["modelValue","rules"])]),_:1},512)]),_:1})])])]),_:1},512)}}});const Ne=G(We,[["__scopeId","data-v-16fbf8f5"]]),Oe=["onClick"],Ge=["onClick"],Xe=a("span",{class:"font-weight-bold"},"这是进行一项操作时必须了解的重要信息",-1),Ze=a("br",null,null,-1),Je={class:"text-primary ml-1"},et=a("br",null,null,-1),tt=R({__name:"DetailTableInfo",setup(c){const o=ae(),{uuid:y}=o.query,h=Y({name:""}),x=Y({list:[],total:0}),n=g(),v=g(),d=g(),p=Y({title:"",id:""}),$=u=>{let C=[];return C.push({text:"废弃",color:"error",click(){w(u)}}),C},w=u=>{p.title=u.title,p.id=u.uuid,d.value.show({width:"450px"})},r=async(u={})=>{const[C,T]=await L.delete({...u,showSuccess:!0,url:`/api/datasets/${y}/samples/${p.id}`});T&&(d.value.hide(),f())},f=async(u={})=>{const[C,T]=await L.get({url:`/api/datasets/${y}/samples`,showLoading:v.value.el,data:{...h,...u}});T?(x.list=T.list||[],x.total=T.total):(x.list=[],x.total=0)},V=()=>{v.value.query({page:1})},P=()=>{n.value.show({title:"添加问答",operateType:"add"})},q=u=>{n.value.show({title:"编辑问答",infos:{uuid:u.uuid,messages:u.messages},operateType:"edit"})};return le(()=>{f()}),(u,C)=>{const T=B("ButtonsInForm"),I=B("el-table-column"),H=B("ButtonsInTable"),l=B("TableWithPager");return m(),S(z,null,[t(ne,null,{default:e(()=>[t(D,{cols:"12",lg:"3",md:"4",sm:"6"},{default:e(()=>[t(O,{modelValue:h.name,"onUpdate:modelValue":C[0]||(C[0]=s=>h.name=s),label:"请输入关键字","hide-details":"",clearable:"",onKeyup:be(V,["enter"]),"onClick:clear":V},null,8,["modelValue","onKeyup"])]),_:1}),t(D,{cols:"12",lg:"3",md:"4",sm:"6"},{default:e(()=>[t(T,null,{default:e(()=>[t(X,{color:"primary",onClick:P},{default:e(()=>[i("添加问答")]),_:1})]),_:1})]),_:1}),t(D,{cols:"12"},{default:e(()=>[t(l,{onQuery:f,ref_key:"tableWithPagerRef",ref:v,infos:x},{default:e(()=>[t(I,{label:"ID","min-width":"200px","show-overflow-tooltip":"","class-name":"link-ellipsis-color"},{default:e(({row:s})=>[a("a",{href:"javascript: void(0)",class:"link",onClick:A=>q(s)},_(s.uuid),9,Oe)]),_:1}),t(I,{label:"问题","min-width":"200px","show-overflow-tooltip":"","class-name":"link-ellipsis-color"},{default:e(({row:s})=>[a("a",{href:"javascript: void(0)",class:"link",onClick:A=>q(s)},_(s.title),9,Ge)]),_:1}),t(I,{label:"对话轮次",prop:"turns",width:"180px"}),t(I,{label:"更新时间","min-width":"165px"},{default:e(({row:s})=>[i(_(k(Q).dateFormat(s.updatedAt,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),t(I,{label:"添加时间","min-width":"165px"},{default:e(({row:s})=>[i(_(k(Q).dateFormat(s.createdAt,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),t(I,{label:"操作人",prop:"creatorEmail","min-width":"150px","show-overflow-tooltip":""}),t(I,{label:"操作",width:"80px",fixed:"right"},{default:e(({row:s})=>[t(H,{onlyOne:!0,buttons:$(s)},null,8,["buttons"])]),_:1})]),_:1},8,["infos"])]),_:1})]),_:1}),t(re,{ref_key:"refConfirmDiscard",ref:d,onSubmit:r},{text:e(()=>[Xe,Ze,i(" 您将要废弃"),a("span",Je,_(p.title),1),et,i(" 确定要继续吗？ ")]),_:1},512),t(Ne,{ref_key:"createQAPaneRef",ref:n,onSubmit:V,uuid:k(y)},null,8,["uuid"])],64)}}}),st={style:{display:"flex"}},ot={class:"toolTip"},at={class:"iconToolTip"},lt={style:{display:"flex"}},nt={class:"toolTip"},rt={class:"iconToolTipRole"},kt=R({__name:"textSampleDetail",setup(c){const o=Y({formData:{name:""},radioCheck:0,showIcon:!1,showIconRole:!1,subTitle:"",exportList:[{text:"导出jsonl",minTitle:"jsonl",subTitle:"将导出成alpaca的训练格式文件，可在创建微调时上传该文件进行训练。"},{text:"生成微调数据集",minTitle:"data",subTitle:"将直接生成微调数据集，在创建微调时可以直接选择该数据集"}]}),y=ae(),h=g(),{uuid:x}=y.query,n=g({}),v=async()=>{let[w,r]=await L.get({showLoading:!0,url:`/api/datasets/${x}`});r&&(n.value=r)},d=()=>{h.value.show({width:"550px"})},p=(w={})=>{o.subTitle=o.exportList[o.radioCheck].subTitle},$=(w={})=>{o.subTitle=o.exportList[o.radioCheck].subTitle};return le(()=>{o.subTitle=o.exportList[o.radioCheck].subTitle,v()}),(w,r)=>(m(),S(z,null,[t(ye,{backUrl:"/sample-library/text-sample/list"},{default:e(()=>[i("样本详情")]),_:1}),t(N,{class:"mt-4"},{header:e(()=>[i(" 名称："+_(n.value.name),1)]),action:e(()=>[t(X,{color:"primary",onClick:d},{default:e(()=>[i("导出数据集")]),_:1})]),default:e(()=>[t(Ye,{info:n.value},null,8,["info"])]),_:1}),t(N,{class:"mt-5"},{default:e(()=>[t(tt)]),_:1}),t(re,{ref_key:"refConfirmByClick",ref:h,onSubmit:p},{text:e(()=>[a("div",null,[t(Te,{class:"mb-6"},{default:e(()=>[i("该操作"+_(o.subTitle)+" ",1)]),_:1}),t(ie,{ref:"refForm",class:"my-form"},{default:e(()=>[t(O,{type:"text",placeholder:"eg: 普泽AI客服","hide-details":"auto",clearable:""},{prepend:e(()=>[a("label",st,[i("角色 "),a("div",ot,[t(k(Z),{size:16,color:"#bbb",pointer:"",class:"iconTool",onMouseenter:r[0]||(r[0]=f=>o.showIcon=!0),onMouseleave:r[1]||(r[1]=f=>o.showIcon=!1)}),J(a("div",at,"AI角色",512),[[ee,o.showIcon]])])])]),_:1}),t(O,{type:"text",placeholder:"eg: 普泽基金的研究人员","hide-details":"auto",clearable:""},{prepend:e(()=>[a("label",lt,[i("作者 "),a("div",nt,[t(k(Z),{size:16,color:"#bbb",pointer:"",class:"iconTool",onMouseenter:r[2]||(r[2]=f=>o.showIconRole=!0),onMouseleave:r[3]||(r[3]=f=>o.showIconRole=!1)}),J(a("div",rt,"AI的制作人及使用的数据等",512),[[ee,o.showIconRole]])])])]),_:1})]),_:1},512),t(we,{mandatory:"","selected-class":"text-primary",style:{"margin-left":"20%"},modelValue:o.radioCheck,"onUpdate:modelValue":r[4]||(r[4]=f=>o.radioCheck=f),onClick:$},{default:e(()=>[(m(!0),S(z,null,oe(o.exportList,(f,V)=>(m(),M(ge,{key:V,filter:"",variant:"outlined"},{default:e(()=>[i(_(f.text),1)]),_:2},1024))),128))]),_:1},8,["modelValue"])])]),_:1},512)],64))}});export{kt as default};
