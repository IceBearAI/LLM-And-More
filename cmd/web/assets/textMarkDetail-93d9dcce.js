import{d as Q,i as Z,ac as z,au as O,at as W,r as D,x as T,z as Y,o as G,U as L,k as y,Z as J,j as n,m as e,_ as u,W as s,$ as m,n as o,Q as K,a3 as X,l as h,Y as g,F as tt,av as b,a8 as B,a1 as et}from"./utils-1e76329d.js";import{_ as at}from"./NavBack.vue_vue_type_script_setup_true_lang-edfc09c4.js";import{_ as ot}from"./UiParentCard.vue_vue_type_script_setup_true_lang-df0964eb.js";import{Z as st,ae as nt,V as M,L as lt,a0 as it,a3 as dt}from"./index-9385247e.js";import{_ as ut}from"./ModelSelect.vue_vue_type_script_setup_true_lang-de688e9f.js";import{V as U}from"./VRow-7ad57f36.js";import{V as p}from"./VCol-1b05b78c.js";import{V as rt}from"./VForm-acd39db9.js";import{V as _}from"./VTextarea-afb7bb72.js";const ct=s("label",null,"任务名称",-1),pt=s("label",null,"模型",-1),mt={class:"v-box item-end"},ft={class:"pl-5"},_t={class:"link font-bold"},yt={class:"pl-8"},bt={class:"link font-bold"},ht={class:"px-5"},gt={class:"link font-bold"},vt={class:"px-5"},xt={class:"link font-bold"},Vt={class:"px-5"},kt={class:"link font-bold"},Dt=["innerHTML"],wt=s("label",{class:"required"},"Instruction",-1),qt=s("label",{class:"required"},"Document",-1),Ct=s("label",{class:"required"},"Question",-1),It=s("label",{class:"required"},"Intent",-1),$t=s("label",{class:"required"},"Input",-1),Tt=s("label",{class:"required"},"Output",-1),Lt={class:"flex justify-between mt-5"},Bt=s("div",null,null,-1),Qt=Q({__name:"textMarkDetail",setup(Mt){const{t:F}=st(),N=Z("provideAspectPage"),{getLabels:S,loadDictTree:A}=z();A(["textannotation_type"]);const j=O(),R=W(),v=D();let w=!1;const a=T({style:{},annotationId:"",displayData:{name:"",annotationType:"",segmentContent:"",total:0,uncompleted:0,completed:0,abandoned:0},formData:{uuid:"",instruction:"",document:"",question:"",intent:"",input:"",output:""}}),{style:Ut,formData:i,displayData:r}=Y(a),f=T({instruction:[l=>!!l||"请输入信息"],question:[l=>!!l||"请输入信息"],intent:[l=>!!l||"请输入信息"],output:[l=>!!l||"请输入信息"],document:[l=>!!l||"请输入信息"],input:[l=>!!l||"请输入信息"]}),x=D(""),V=D(!1),q=async()=>{const[l,t]=await b.get({showLoading:!0,url:`/api/mgr/annotation/task/${a.annotationId}/info`});t&&(a.displayData={...a.displayData,...t},a.displayData.uncompleted=t.total-t.completed-t.abandoned,dt(document).scrollTop(0))},C=()=>{w&&N.methods.refreshListPage(),R.push("/sample-library/text-mark/list")},I=async()=>{v.value.resetValidation(),a.formData={uuid:"",instruction:"",document:"",question:"",intent:"",input:"",output:""};const[l,t]=await b.get({showLoading:!0,url:`/api/mgr/annotation/task/${a.annotationId}/segment/next`});t&&(B.assign(a.formData,B.pick(t,["uuid","instruction","question","intent","output"])),t.segmentContent?a.displayData.segmentContent="<div>"+t.segmentContent.split(`
`).join("</div><div>")+"</div>":a.displayData.segmentContent="")},$=()=>{w=!0,a.displayData.uncompleted==1?C():(q(),I())},P=async()=>{const[l,t]=await b.put({showLoading:!0,showSuccess:!0,url:`/api/mgr/annotation/task/${a.annotationId}/segment/${a.formData.uuid}/abandoned`});t&&$()},E=async()=>{let{valid:l,errors:t}=await v.value.validate();if(l){const[c,k]=await b.post({showLoading:!0,showSuccess:!0,url:`/api/mgr/annotation/task/${a.annotationId}/segment/${a.formData.uuid}/mark`,data:a.formData});k&&$()}else{let c=F("pane.errorMsg");et.warning(c)}},H=async()=>{V.value=!0;const[l,t]=await b.post({timeout:60*1e3,showLoading:!1,showSuccess:!1,url:`/api/mgr/annotation/task/${a.annotationId}/segment/${a.formData.uuid}/generation/annotation`,data:{modelName:x.value}});t&&["instruction","document","question","intent","input","output"].forEach(c=>{t[c]&&(a.formData[c]=t[c])}),V.value=!1};return G(()=>{let{annotationId:l}=j.query;a.annotationId=l,q(),I()}),(l,t)=>{const c=L("AiBtn"),k=L("ButtonsInForm");return y(),J(tt,null,[n(at,{backUrl:"backCallback",onBack:C},{default:e(()=>[u("文本标注")]),_:1}),n(ot,{class:"mt-4"},{default:e(()=>[s("div",null,[n(U,{class:"my-form waterfall"},{default:e(()=>[n(p,{cols:"12",md:"6"},{default:e(()=>[n(p,null,{default:e(()=>[n(nt,{"hide-details":""},{prepend:e(()=>[ct]),default:e(()=>[u(" "+m(o(r).name),1)]),_:1})]),_:1}),n(p,{class:"d-flex align-center"},{default:e(()=>[n(ut,{defaultFirstValue:"",modelValue:x.value,"onUpdate:modelValue":t[0]||(t[0]=d=>x.value=d),"hide-details":"auto"},{prepend:e(()=>[pt]),_:1},8,["modelValue"]),n(M,{loading:V.value,class:"ml-3",color:"info",onClick:H},{default:e(()=>[u("AI标注")]),_:1},8,["loading"])]),_:1})]),_:1}),n(p,{cols:"12",md:"6",class:"text-xl text-slate-500 flex justify-end"},{default:e(()=>[s("div",mt,[n(p,{class:"flex"},{default:e(()=>[s("div",ft,[u(" 标注进度："),K(s("span",null,[s("span",_t,m(o(r).completed+o(r).abandoned+1),1),u("/"+m(o(r).total),1)],512),[[X,a.displayData.total]])]),s("div",yt,[u(" 任务类型："),s("span",bt,m(o(S)([["textannotation_type",o(r).annotationType]])),1)])]),_:1}),n(p,{class:"ml-auto flex flex-wrap divide-x"},{default:e(()=>[s("div",ht,[u(" 已完成："),s("span",gt,m(o(r).completed),1)]),s("div",vt,[u(" 未完成："),s("span",xt,m(o(r).uncompleted),1)]),s("div",Vt,[u(" 丢弃："),s("span",kt,m(o(r).abandoned),1)])]),_:1})])]),_:1})]),_:1})]),n(lt,{class:"mb-5"}),n(U,null,{default:e(()=>[n(p,{cols:"12",md:"5"},{default:e(()=>[n(it,{class:"h-full flex p-4 overflow-hidden min-h-[300px] max-h-[665px] text-[15px]",elevation:"3"},{default:e(()=>[s("div",{class:"flex-1 scrollbar-auto space-y-3 [line-height:1.4]",innerHTML:o(r).segmentContent},null,8,Dt)]),_:1})]),_:1}),n(p,{cols:"12",md:"7"},{default:e(()=>[n(rt,{ref_key:"refForm",ref:v,class:"my-form space-y-4"},{default:e(()=>[n(_,{type:"textarea",placeholder:"请输入信息","hide-details":"auto",rules:f.instruction,"validate-on":"submit",modelValue:o(i).instruction,"onUpdate:modelValue":t[1]||(t[1]=d=>o(i).instruction=d),class:"block"},{prepend:e(()=>[wt]),_:1},8,["rules","modelValue"]),["rag"].includes(a.displayData.annotationType)?(y(),h(_,{key:0,type:"textarea",placeholder:"请输入信息","hide-details":"auto",rules:f.document,"validate-on":"submit",modelValue:o(i).document,"onUpdate:modelValue":t[2]||(t[2]=d=>o(i).document=d),class:"block"},{prepend:e(()=>[qt]),_:1},8,["rules","modelValue"])):g("",!0),["faq","rag"].includes(a.displayData.annotationType)?(y(),h(_,{key:1,type:"text",placeholder:"请输入信息","hide-details":"auto",rules:f.question,"validate-on":"submit",modelValue:o(i).question,"onUpdate:modelValue":t[3]||(t[3]=d=>o(i).question=d),class:"block"},{prepend:e(()=>[Ct]),_:1},8,["rules","modelValue"])):g("",!0),["faq"].includes(a.displayData.annotationType)?(y(),h(_,{key:2,type:"text",placeholder:"请输入信息","hide-details":"auto",rules:f.intent,"validate-on":"submit",modelValue:o(i).intent,"onUpdate:modelValue":t[4]||(t[4]=d=>o(i).intent=d),class:"block"},{prepend:e(()=>[It]),_:1},8,["rules","modelValue"])):g("",!0),["general"].includes(a.displayData.annotationType)?(y(),h(_,{key:3,type:"text",placeholder:"请输入信息","hide-details":"auto",clearable:"",rules:f.input,"validate-on":"submit",modelValue:o(i).input,"onUpdate:modelValue":t[5]||(t[5]=d=>o(i).input=d),class:"block"},{prepend:e(()=>[$t]),_:1},8,["rules","modelValue"])):g("",!0),n(_,{type:"text",placeholder:"请输入信息","hide-details":"auto",clearable:"",rules:f.output,"validate-on":"submit",modelValue:o(i).output,"onUpdate:modelValue":t[6]||(t[6]=d=>o(i).output=d),class:"block"},{prepend:e(()=>[Tt]),_:1},8,["rules","modelValue"])]),_:1},512)]),_:1})]),_:1}),s("div",Lt,[Bt,n(k,null,{default:e(()=>[n(M,{class:"w-[120px] btn-danger",plain:"",onClick:P,disabled:!o(i).uuid},{default:e(()=>[u("丢弃")]),_:1},8,["disabled"]),n(c,{color:"secondary",class:"w-[120px]",onClick:E,disabled:!o(i).uuid},{default:e(()=>[u("提交")]),_:1},8,["disabled"])]),_:1})])]),_:1})],64)}}});export{Qt as default};
