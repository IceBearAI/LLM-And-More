import{d as M,x as P,r as _,bk as A,c as H,U as V,k as C,l as q,m as t,W as d,j as e,a1 as j,Y as W,b9 as R,am as Z,an as G,ad as J,o as O,Z as X,bf as ee,_ as y,$,n as Y,bg as ae,F as te}from"./utils-d360fd38.js";import{_ as le}from"./BaseBreadcrumb.vue_vue_type_style_index_0_lang-5c17211d.js";import{_ as oe}from"./UiParentCard.vue_vue_type_script_setup_true_lang-f0de3c2a.js";import{A as se}from"./AlertBlock-f3f39cbb.js";import{_ as ne}from"./ConfirmByInput.vue_vue_type_style_index_0_lang-247bc568.js";import{a4 as U,_ as ue,V as re}from"./index-8b7fa986.js";import{V as E}from"./VSwitch-75718bfc.js";import{V as de}from"./VForm-1f16fcb0.js";import{C as ie}from"./ChipBoolean-979c0c50.js";import{C as me}from"./ChipStatus-40656f5a.js";import{V as pe}from"./VRow-92b162a6.js";import{V as I}from"./VCol-dc51774a.js";import"./VAlert-24aead77.js";import"./Confirm-dc38596b.js";const w=k=>(Z("data-v-dac6a0b7"),k=k(),G(),k),ce={class:"mx-auto mt-3",style:{width:"600px"}},_e=w(()=>d("label",{class:"required"},"昵称",-1)),fe=w(()=>d("label",{class:"required"},"邮箱",-1)),be=w(()=>d("label",null,"ldap用户",-1)),ve=w(()=>d("label",{class:"required"},"绑定租户",-1)),he=w(()=>d("label",{class:"required"},"默认语言",-1)),Ve=w(()=>d("label",null,"启用",-1)),ge=M({__name:"CreateUserPane",emits:["submit"],setup(k,{expose:S,emit:D}){const T={nickname:"",email:"",isLdap:!1,password:"",language:null,tenantPublicTenantIdItems:null},L=D,i=P({operateType:"add"}),a=_({...T}),f=_(),b=_(),c=P({nickname:[n=>!!n||"请输入昵称"],email:[n=>A.isEmail({value:n,required:!0})],password:[n=>A.isPassword({value:n,required:!x.value})],tenantPublicTenantIdItems:[n=>n&&n.length>0||"请选择租户"],language:[n=>!!n||"请选择默认语言"]}),m=_(!1),x=H(()=>i.operateType==="edit"),F=async({valid:n,showLoading:l})=>{if(n){const o={url:"",method:""};i.operateType=="add"?(o.url="/accounts",o.method="post"):(o.url=`/accounts/${a.value.id}`,o.method="put");const[g,s]=await R[o.method]({showLoading:l,showSuccess:!0,url:o.url,data:a.value});s&&(f.value.hide(),L("submit"))}};return S({show({title:n,operateType:l,infos:o}){f.value.show({title:n,refForm:b}),i.operateType=l,i.operateType==="add"?a.value={...T}:(a.value.id=o.id,a.value.nickname=o.nickname,a.value.email=o.email,a.value.isLdap=o.isLdap,a.value.language=o.language,a.value.tenantPublicTenantIdItems=o.tenants.map(g=>g.publicTenantId),a.value.status=o.status)}}),(n,l)=>{const o=V("Select"),g=V("Pane");return C(),q(g,{ref_key:"refPane",ref:f,onSubmit:F},{default:t(()=>[d("div",ce,[e(de,{ref_key:"refForm",ref:b,class:"my-form"},{default:t(()=>[e(U,{type:"text",placeholder:"请输入昵称","hide-details":"auto",clearable:"",rules:c.nickname,modelValue:a.value.nickname,"onUpdate:modelValue":l[0]||(l[0]=s=>a.value.nickname=s)},{prepend:t(()=>[_e]),_:1},8,["rules","modelValue"]),e(U,{type:"text",placeholder:"请输入邮箱","hide-details":"auto",clearable:"",rules:c.email,modelValue:a.value.email,"onUpdate:modelValue":l[1]||(l[1]=s=>a.value.email=s)},{prepend:t(()=>[fe]),_:1},8,["rules","modelValue"]),e(E,{modelValue:a.value.isLdap,"onUpdate:modelValue":l[2]||(l[2]=s=>a.value.isLdap=s),color:"primary","hide-details":"auto"},{prepend:t(()=>[be]),_:1},8,["modelValue"]),a.value.isLdap?W("",!0):(C(),q(U,{key:0,"append-inner-icon":m.value?"mdi-eye":"mdi-eye-off",type:m.value?"text":"password","onClick:appendInner":l[3]||(l[3]=s=>m.value=!m.value),placeholder:"大写英文字母+小写英文字母+数字+特殊字符，8-20位","hide-details":"auto",rules:c.password,modelValue:a.value.password,"onUpdate:modelValue":l[4]||(l[4]=s=>a.value.password=s)},{prepend:t(()=>[d("label",{class:j({required:!x.value})},"密码",2)]),_:1},8,["append-inner-icon","type","rules","modelValue"])),e(o,{rules:c.tenantPublicTenantIdItems,modelValue:a.value.tenantPublicTenantIdItems,"onUpdate:modelValue":l[5]||(l[5]=s=>a.value.tenantPublicTenantIdItems=s),mapAPI:{url:"/tenants",data:{pageSize:-1},labelField:"name",valueField:"publicTenantId"},"hide-details":"auto",multiple:"",placeholder:"请选择租户"},{prepend:t(()=>[ve]),_:1},8,["rules","modelValue"]),e(o,{placeholder:"请选择默认语言",rules:c.language,mapDictionary:{code:"system_language"},modelValue:a.value.language,"onUpdate:modelValue":l[6]||(l[6]=s=>a.value.language=s)},{prepend:t(()=>[he]),_:1},8,["rules","modelValue"]),x.value?(C(),q(E,{key:1,modelValue:a.value.status,"onUpdate:modelValue":l[7]||(l[7]=s=>a.value.status=s),color:"primary","hide-details":"auto"},{prepend:t(()=>[Ve]),_:1},8,["modelValue"])):W("",!0)]),_:1},512)])]),_:1},512)}}});const ye=ue(ge,[["__scopeId","data-v-dac6a0b7"]]),we={class:"text-primary font-weight-black"},ke=d("br",null,null,-1),Ae=M({__name:"userList",setup(k){const{loadDictTree:S,getLabels:D}=J(),T=_({title:"用户列表"}),L=_([{text:"系统管理",disabled:!1,href:"#"},{text:"用户列表",disabled:!0,href:"#"}]),i=P({email:"",isLdap:null}),a=P({list:[],total:0}),f=_(),b=_(),c=_(),m=P({nickname:"",id:""}),x=r=>{let p=[];return p.push({text:"删除",color:"error",click(){F(r)}}),p.push({text:"编辑",color:"info",click(){N(r)}}),p},F=r=>{m.nickname=r.nickname,m.id=r.id,c.value.show({width:"450px",confirmText:m.nickname})},n=async(r={})=>{const[p,v]=await R.delete({...r,showSuccess:!0,url:`/accounts/${m.id}`});v&&(c.value.hide(),g())},l=async(r={})=>{await S(["system_language"]);const[p,v]=await R.get({url:"/accounts",showLoading:b.value.el,data:{...i,...r}});v?(a.list=v.list||[],a.total=v.total):(a.list=[],a.total=0)},o=()=>{b.value.query({page:1})},g=()=>{b.value.query()},s=()=>{f.value.show({title:"添加用户",operateType:"add"})},N=r=>{f.value.show({title:"编辑用户",infos:r,operateType:"edit"})};return O(()=>{l()}),(r,p)=>{const v=V("Select"),Q=V("ButtonsInForm"),h=V("el-table-column"),K=V("ButtonsInTable"),z=V("TableWithPager");return C(),X(te,null,[e(le,{title:T.value.title,breadcrumbs:L.value},null,8,["title","breadcrumbs"]),e(oe,null,{default:t(()=>[e(pe,null,{default:t(()=>[e(I,{cols:"12",lg:"3",md:"4",sm:"6"},{default:t(()=>[e(U,{modelValue:i.email,"onUpdate:modelValue":p[0]||(p[0]=u=>i.email=u),label:"请输入邮箱","hide-details":"",clearable:"",onKeyup:ee(o,["enter"]),"onClick:clear":o},null,8,["modelValue","onKeyup"])]),_:1}),e(I,{cols:"12",lg:"3",md:"4",sm:"6"},{default:t(()=>[e(v,{onChange:o,label:"请选择是否是ldap用户",mapDictionary:{code:"boolean"},modelValue:i.isLdap,"onUpdate:modelValue":p[1]||(p[1]=u=>i.isLdap=u)},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",lg:"3",md:"4",sm:"6"},{default:t(()=>[e(Q,null,{default:t(()=>[e(re,{color:"primary",onClick:s},{default:t(()=>[y("添加用户")]),_:1})]),_:1})]),_:1}),e(I,{cols:"12"},{default:t(()=>[e(se,null,{default:t(()=>[y("修改之后将实时生效，请谨慎操作！")]),_:1})]),_:1}),e(I,{cols:"12"},{default:t(()=>[e(z,{onQuery:l,ref_key:"tableWithPagerRef",ref:b,infos:a},{default:t(()=>[e(h,{label:"昵称",prop:"nickname","min-width":"200px","show-overflow-tooltip":""}),e(h,{label:"邮箱",prop:"email","min-width":"180px","show-overflow-tooltip":""}),e(h,{label:"ldap用户","min-width":"100px"},{default:t(({row:u})=>[e(ie,{modelValue:u.isLdap,"onUpdate:modelValue":B=>u.isLdap=B},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(h,{label:"是否启用","min-width":"100px"},{default:t(({row:u})=>[e(me,{modelValue:u.status,"onUpdate:modelValue":B=>u.status=B},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(h,{label:"默认语言","min-width":"110px","show-overflow-tooltip":""},{default:t(({row:u})=>[d("span",null,$(Y(D)([["system_language",u.language]])),1)]),_:1}),e(h,{label:"创建时间","min-width":"165px"},{default:t(({row:u})=>[y($(Y(ae).dateFormat(u.createdAt,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),e(h,{label:"操作",width:"120px",fixed:"right"},{default:t(({row:u})=>[e(K,{buttons:x(u)},null,8,["buttons"])]),_:1})]),_:1},8,["infos"])]),_:1})]),_:1})]),_:1}),e(ne,{ref_key:"refConfirmDelete",ref:c,onSubmit:n},{text:t(()=>[y(" 您将要删除 "),d("span",we,$(m.nickname),1),y(" 用户"),ke,y(" 确定要继续吗？ ")]),_:1},512),e(ye,{ref_key:"createUserPaneRef",ref:f,onSubmit:o},null,512)],64)}}});export{Ae as default};
