import{d as I,x as w,r as c,bk as R,c as U,U as y,k as E,l as W,m as t,W as v,j as e,b9 as S,am as Q,an as Y,o as K,Z as M,bf as j,_ as b,$ as N,n as H,bg as L,F as z}from"./utils-91854e55.js";import{_ as Z}from"./BaseBreadcrumb.vue_vue_type_style_index_0_lang-a832ed83.js";import{_ as G}from"./UiParentCard.vue_vue_type_script_setup_true_lang-72749ad5.js";import{A as J}from"./AlertBlock-3609563e.js";import{_ as O}from"./ConfirmByInput.vue_vue_type_style_index_0_lang-01977ff8.js";import{a4 as B,_ as X,V as ee}from"./index-38e2b3cf.js";import{V as te}from"./VForm-24c895bc.js";import{V as ae}from"./VRow-a4b8abae.js";import{V as k}from"./VCol-4c3995c3.js";import"./VAlert-a7fd619f.js";import"./Confirm-b054f614.js";const D=x=>(Q("data-v-40777d36"),x=x(),Y(),x),le={class:"mx-auto mt-3",style:{width:"600px"}},oe=D(()=>v("label",{class:"required"},"名称",-1)),ne=D(()=>v("label",{class:"required"},"联系人邮箱",-1)),se=D(()=>v("label",{class:"required"},"模型",-1)),re=I({__name:"CreateTenantPane",emits:["submit"],setup(x,{expose:P,emit:C}){const h={name:"",contactEmail:"",modelNames:null},p=C,d=w({operateType:"add"}),a=c({...h}),f=c(),i=c(),V=w({name:[o=>!!o||"请输入名称"],contactEmail:[o=>R.isEmail({value:o,required:!0})],modelNames:[o=>o&&o.length>0||"请选择模型"]});U(()=>d.operateType==="edit");const F=async({valid:o,showLoading:n})=>{if(o){const l={url:"",method:""};d.operateType=="add"?(l.url="/tenants",l.method="post"):(l.url=`/tenants/${a.value.id}`,l.method="put");const[T,r]=await S[l.method]({showLoading:n,showSuccess:!0,url:l.url,data:a.value});r&&(f.value.hide(),p("submit"))}};return P({show({title:o,operateType:n,infos:l}){f.value.show({title:o,refForm:i}),d.operateType=n,d.operateType==="add"?a.value={...h}:a.value={...l}}}),(o,n)=>{const l=y("Select"),T=y("Pane");return E(),W(T,{ref_key:"refPane",ref:f,onSubmit:F},{default:t(()=>[v("div",le,[e(te,{ref_key:"refForm",ref:i,class:"my-form"},{default:t(()=>[e(B,{type:"text",placeholder:"请输入名称","hide-details":"auto",clearable:"",rules:V.name,modelValue:a.value.name,"onUpdate:modelValue":n[0]||(n[0]=r=>a.value.name=r)},{prepend:t(()=>[oe]),_:1},8,["rules","modelValue"]),e(B,{type:"text",placeholder:"请输入联系人邮箱","hide-details":"auto",clearable:"",rules:V.contactEmail,modelValue:a.value.contactEmail,"onUpdate:modelValue":n[1]||(n[1]=r=>a.value.contactEmail=r)},{prepend:t(()=>[ne]),_:1},8,["rules","modelValue"]),e(l,{rules:V.modelNames,modelValue:a.value.modelNames,"onUpdate:modelValue":n[2]||(n[2]=r=>a.value.modelNames=r),mapAPI:{url:"/channels/models",data:{pageSize:-1},labelField:"modelName",valueField:"modelName"},"hide-details":"auto",multiple:"",placeholder:"请选择模型"},{prepend:t(()=>[se]),_:1},8,["rules","modelValue"])]),_:1},512)])]),_:1},512)}}});const de=X(re,[["__scopeId","data-v-40777d36"]]),ie={class:"text-primary font-weight-black"},me=v("br",null,null,-1),ge=I({__name:"tenantList",setup(x){const P=c({title:"租户列表"}),C=c([{text:"系统管理",disabled:!1,href:"#"},{text:"租户列表",disabled:!0,href:"#"}]),h=w({name:""}),p=w({list:[],total:0}),d=c(),a=c(),f=c(),i=w({name:"",id:""}),V=s=>{let m=[];return s.publicTenantId!=="5f9b3b3d-9b9c-4e1a-8e1a-5a4b4b4b4b4b"&&m.push({text:"删除",color:"error",click(){F(s)}}),m.push({text:"编辑",color:"info",click(){$(s)}}),m},F=s=>{i.name=s.name,i.id=s.id,f.value.show({width:"450px",confirmText:i.name})},o=async(s={})=>{const[m,_]=await S.delete({...s,showSuccess:!0,url:`/tenants/${i.id}`});_&&(f.value.hide(),T())},n=async(s={})=>{const[m,_]=await S.get({url:"/tenants",showLoading:a.value.el,data:{...h,...s}});_?(p.list=_.list||[],p.total=_.total):(p.list=[],p.total=0)},l=()=>{a.value.query({page:1})},T=()=>{a.value.query()},r=()=>{d.value.show({title:"添加租户",operateType:"add"})},$=s=>{d.value.show({title:"编辑租户",infos:s,operateType:"edit"})};return K(()=>{n()}),(s,m)=>{const _=y("ButtonsInForm"),g=y("el-table-column"),q=y("ButtonsInTable"),A=y("TableWithPager");return E(),M(z,null,[e(Z,{title:P.value.title,breadcrumbs:C.value},null,8,["title","breadcrumbs"]),e(G,null,{default:t(()=>[e(ae,null,{default:t(()=>[e(k,{cols:"12",lg:"3",md:"4",sm:"6"},{default:t(()=>[e(B,{modelValue:h.name,"onUpdate:modelValue":m[0]||(m[0]=u=>h.name=u),label:"请输入名称","hide-details":"",clearable:"",onKeyup:j(l,["enter"]),"onClick:clear":l},null,8,["modelValue","onKeyup"])]),_:1}),e(k,{cols:"12",lg:"3",md:"4",sm:"6"},{default:t(()=>[e(_,null,{default:t(()=>[e(ee,{color:"primary",onClick:r},{default:t(()=>[b("添加租户")]),_:1})]),_:1})]),_:1}),e(k,{cols:"12"},{default:t(()=>[e(J,null,{default:t(()=>[b("修改之后将实时生效，请谨慎操作！")]),_:1})]),_:1}),e(k,{cols:"12"},{default:t(()=>[e(A,{onQuery:n,ref_key:"tableWithPagerRef",ref:a,infos:p},{default:t(()=>[e(g,{label:"名称",prop:"name","min-width":"200px","show-overflow-tooltip":""}),e(g,{label:"联系人邮箱",prop:"contactEmail","min-width":"200px"}),e(g,{label:"模型","min-width":"200px","show-overflow-tooltip":""},{default:t(({row:u})=>[b(N(u.modelNames?u.modelNames.join("，"):"--"),1)]),_:1}),e(g,{label:"创建时间","min-width":"165px"},{default:t(({row:u})=>[b(N(H(L).dateFormat(u.createdAt,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),e(g,{label:"操作",width:"120px",fixed:"right"},{default:t(({row:u})=>[e(q,{buttons:V(u)},null,8,["buttons"])]),_:1})]),_:1},8,["infos"])]),_:1})]),_:1})]),_:1}),e(O,{ref_key:"refConfirmDelete",ref:f,onSubmit:o},{text:t(()=>[b(" 您将要删除 "),v("span",ie,N(i.name),1),b(" 租户"),me,b(" 确定要继续吗？ ")]),_:1},512),e(de,{ref_key:"createTenantPaneRef",ref:d,onSubmit:l},null,512)],64)}}});export{ge as default};
