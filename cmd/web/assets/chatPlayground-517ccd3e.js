import{u as te}from"./useScroll-6ef8887d.js";import{_ as ae}from"./BaseBreadcrumb.vue_vue_type_style_index_0_lang-02f17eb8.js";import{d as Z,au as oe,r as m,x as se,c as le,k as g,l as M,m as r,j as e,_ as x,Z as $,a5 as G,F as A,$ as ne,W as f,U as re,Y as J,av as O,al as ue,am as de}from"./utils-fc8ebe1f.js";import{_ as me}from"./ModelSelect.vue_vue_type_script_setup_true_lang-86baaacc.js";import{a4 as U,a5 as z,ah as ce,L as W,a0 as ie,_ as pe}from"./index-b84f97ad.js";import{V as Y}from"./VSlider-bf749123.js";import{V as L}from"./VSheet-127cc921.js";import{S as fe,M as he}from"./index-159f965b.js";import{_ as _e}from"./ConfirmByClick.vue_vue_type_style_index_0_lang-18c58b80.js";import{V as ge}from"./VAlert-2b69a982.js";import{V as ve}from"./VTextarea-e2668a01.js";import"./favicon-8a59fd6b.js";import"./Confirm-dfed4e97.js";const ye=f("h6",{class:"text-h6 mb-3"},"会话设置",-1),xe=Z({__name:"Config",emits:["change:model"],setup(V,{expose:I,emit:w}){const N=w,B=oe(),{modelName:i}=B.query,a=m(10),p=m(i?{modelName:i}:null),d=se({maxTokens:512,temperature:0,topP:0}),S=le(()=>{var n;return[{key:"maxTokens",title:"最大响应数",max:((n=p.value)==null?void 0:n.maxTokens)??0,min:0,step:1},{key:"temperature",title:"温度",max:1,min:0,step:.1},{key:"topP",title:"TopP",max:1,min:0,step:.1}]}),T=u=>{N("change:model",u);const n=u.maxTokens;d.maxTokens=d.maxTokens>n?n:512};return I({getData:()=>{var u;return{sendHistoryCount:a.value,data:{model:(u=p.value)==null?void 0:u.modelName,...d}}}}),(u,n)=>(g(),M(L,null,{default:r(()=>[e(U,{class:"mb-2 font-weight-medium"},{default:r(()=>[x("模型")]),_:1}),e(me,{modelValue:p.value,"onUpdate:modelValue":[n[0]||(n[0]=t=>p.value=t),T],"default-first-value":"","return-object":""},null,8,["modelValue"]),e(L,null,{default:r(()=>[ye,e(U,{class:"mb-2 font-weight-medium"},{default:r(()=>[x("包含过去的消息")]),_:1}),e(Y,{modelValue:a.value,"onUpdate:modelValue":n[2]||(n[2]=t=>a.value=t),color:"primary",max:20,min:0,step:"1","hide-details":"","thumb-label":""},{append:r(()=>[e(z,{modelValue:a.value,"onUpdate:modelValue":n[1]||(n[1]=t=>a.value=t),modelModifiers:{number:!0},"hide-details":"","single-line":"",density:"compact",type:"number",max:20,min:0,style:{width:"80px"}},null,8,["modelValue"])]),_:1},8,["modelValue"]),(g(!0),$(A,null,G(S.value,t=>(g(),$(A,null,[e(U,{class:"mb-2 font-weight-medium"},{default:r(()=>[x(ne(t.title),1)]),_:2},1024),e(Y,{modelValue:d[t.key],"onUpdate:modelValue":k=>d[t.key]=k,color:"primary",max:t.max,min:t.min,step:t.step,"hide-details":"","thumb-label":""},{append:r(()=>[e(z,{modelValue:d[t.key],"onUpdate:modelValue":k=>d[t.key]=k,modelModifiers:{number:!0},"hide-details":"","single-line":"",density:"compact",type:"number",max:t.max,min:t.min,step:t.step,style:{width:"80px"}},null,8,["modelValue","onUpdate:modelValue","max","min","step"])]),_:2},1032,["modelValue","onUpdate:modelValue","max","min","step"])],64))),256))]),_:1})]),_:1}))}}),R=V=>(ue("data-v-e1ad5637"),V=V(),de(),V),Ve={class:"chat-playground d-flex"},Te={class:"left-part pa-4 d-none d-md-block"},be=R(()=>f("h4",{class:"text-h6 mb-6"},"助理设置",-1)),ke={class:"middle-part"},Ce=R(()=>f("h4",{class:"text-h6 pa-4"},"聊天会话",-1)),we={class:"right-part pa-4"},Se=R(()=>f("h4",{class:"text-h6 mb-6"},"配置",-1)),Pe=Z({__name:"chatPlayground",setup(V){const{scrollRef:I,scrollToBottom:w,scrollToBottomIfAtBottom:N}=te(),B=m({title:"聊天操场"}),i=m(""),a=m([]),p=m(""),d=m(!1),S=m(),T=m(),b=m(""),u=m([]),n=()=>{const o=p.value;p.value="",t("text",o)},t=async(o,l,c={})=>{let s=l;const v=k(s);q({content:s,contentType:o,createdAt:new Date,ext:c,msgType:"question"}),w(),d.value=!0,q({loading:!0,content:"",contentType:"text",createdAt:new Date,msgType:"answer"}),w();try{await O.post({url:"/channels/chat/completions",timeout:300*1e3,data:v,onDownloadProgress:h=>{const P=h.target,{responseText:y}=P,j=y.lastIndexOf(`
`,y.length-2);let E=y;j!==-1&&(E=y.substring(j));try{const C=JSON.parse(E),D=a.value.length-1;if(C.success){const _=C.data;H(D,{loading:!0,content:_.fullContent,contentType:_.contentType??"text",createdAt:_.createdAt,msgType:"answer"})}else{const _=a.value[D];if(_.content&&_.content!==""){F(D,{content:`${_.content}
[${C.message}]`,loading:!0});return}H(D,{loading:!0,content:C.message,contentType:"text",createdAt:new Date,msgType:"answer"})}N()}catch{}}})}catch(h){console.log(h)}finally{F(a.value.length-1,{loading:!1}),d.value=!1}},k=o=>{const l=S.value.getData(),c=l.data,s=l.sendHistoryCount*2;let v=[];const h=[{role:"system",content:i.value}];return s!==0&&(v=a.value.slice(-s)),v.forEach(P=>{const y=P.msgType==="question"?"user":"assistant";h.push({role:y,content:P.content})}),h.push({role:"user",content:o}),c.messages=h,c},q=o=>{a.value.push(o)},H=(o,l)=>{a.value[o]=l},F=(o,l)=>{a.value[o]={...a.value[o],...l}},K=()=>{T.value.show({width:"400px"})},Q=()=>{a.value=[],T.value.hide()},X=async o=>{const[l,c]=await O.get({url:`/api/models/${o.modelName}/info`});if(c)if(c.fineTuned){const s=c.fineTuned.systemPrompts||[];u.value=s,b.value=s[0],i.value=s[0]}else u.value=[],b.value="",i.value=""},ee=o=>{i.value=o};return(o,l)=>{const c=re("perfect-scrollbar");return g(),$(A,null,[e(ae,{title:B.value.title},null,8,["title"]),e(ie,{elevation:"10"},{default:r(()=>[f("div",Ve,[f("div",Te,[be,e(ge,{class:"mb-3 text-body-2",color:"textPrimary",variant:"tonal"},{default:r(()=>[x(" 系统消息包含在提示的开头，用于为模型提供上下文、说明或与用例相关的其他信息。 可以使用系统消息来描述助手的个性，定义模型应回答和不应回答的内容，以及定义模型响应的格式。 ")]),_:1}),e(L,null,{default:r(()=>[u.value.length>1?(g(),M(ce,{key:0,class:"mb-3 pt-2",modelValue:b.value,"onUpdate:modelValue":[l[0]||(l[0]=s=>b.value=s),ee],clearable:!1,"hide-details":"",items:u.value,label:"请选择系统提示词"},null,8,["modelValue","items"])):J("",!0),e(U,{class:"mb-2 font-weight-medium"},{default:r(()=>[x("系统消息")]),_:1}),e(ve,{modelValue:i.value,"onUpdate:modelValue":l[1]||(l[1]=s=>i.value=s),variant:"outlined",placeholder:"可以给定助理角色及相关要求，不要超过2000个字",rows:"5","no-resize":"",color:"primary","row-height":"25",shaped:"","hide-details":""},null,8,["modelValue"])]),_:1})]),f("div",ke,[Ce,e(W),e(c,{ref_key:"scrollRef",ref:I,class:"middle-part__list"},{default:r(()=>[a.value.length>0?(g(!0),$(A,{key:0},G(a.value,(s,v)=>(g(),M(he,{key:v,"chat-item":s},null,8,["chat-item"]))),128)):J("",!0)]),_:1},512),e(W),e(fe,{modelValue:p.value,"onUpdate:modelValue":l[2]||(l[2]=s=>p.value=s),onSubmit:n,onClear:K,"send-loading":d.value},null,8,["modelValue","send-loading"])]),f("div",we,[Se,e(xe,{ref_key:"configRef",ref:S,"onChange:model":X},null,512)])])]),_:1}),e(_e,{ref_key:"refConfirmDelete",ref:T,onSubmit:Q},{text:r(()=>[x("确定清空会话？")]),_:1},512)],64)}}});const je=pe(Pe,[["__scopeId","data-v-e1ad5637"]]);export{je as default};
